<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù‚Ù‡ÙˆØ© Ø§Ù„Ø´Ø§Ù… | Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø®Ø§ØµØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Room Page Specific Styles */
        .page-header {
            background: var(--gradient);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .page-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -20%;
            width: 60%;
            height: 200%;
            background: rgba(255,255,255,0.05);
            transform: rotate(30deg);
        }

        .page-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .page-header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        /* Tabs */
        .tabs-container {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: var(--card-bg);
            padding: 8px;
            border-radius: 15px;
            border: 1px solid var(--border);
        }

        .tab-btn {
            flex: 1;
            padding: 15px 25px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .tab-btn:hover {
            color: var(--text);
            background: var(--card-hover);
        }

        .tab-btn.active {
            background: var(--gradient);
            color: white;
            box-shadow: 0 5px 20px rgba(139, 69, 19, 0.3);
        }
        
        /* Ø¹Ù†Ø§ØµØ± Ù…Ø®ØµØµØ© Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø· */
        .admin-only.hidden {
            display: none !important;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Rooms Grid */
        .rooms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .room-card {
            background: var(--card-bg);
            border-radius: 25px;
            border: 1px solid var(--border);
            overflow: hidden;
            transition: all 0.4s ease;
        }

        .room-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(139, 69, 19, 0.2);
            border-color: var(--primary);
        }

        .room-image {
            height: 200px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .room-image .room-icon {
            font-size: 5rem;
            opacity: 0.9;
        }

        .room-status {
            position: absolute;
            top: 15px;
            left: 15px;
            padding: 8px 18px;
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 700;
            backdrop-filter: blur(10px);
        }

        .room-status.available {
            background: rgba(34, 197, 94, 0.9);
            color: white;
        }

        .room-status.booked {
            background: rgba(239, 68, 68, 0.9);
            color: white;
        }

        .room-status.maintenance {
            background: rgba(245, 158, 11, 0.9);
            color: white;
        }

        .room-capacity {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(10px);
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .room-details {
            padding: 25px;
        }

        .room-name {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .room-amenities {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .amenity-tag {
            background: var(--bg-secondary);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .room-price {
            display: flex;
            align-items: baseline;
            gap: 5px;
            margin-bottom: 20px;
        }

        .room-price .amount {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--gold);
        }

        .room-price .unit {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .room-actions {
            display: flex;
            gap: 10px;
        }

        .room-actions .btn {
            flex: 1;
        }

        /* Booking Form */
        .booking-section {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }

        @media (max-width: 1024px) {
            .booking-section {
                grid-template-columns: 1fr;
            }
        }

        .booking-form-container {
            background: var(--card-bg);
            border-radius: 25px;
            border: 1px solid var(--border);
            padding: 30px;
        }

        .booking-form-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .booking-form-title i {
            color: var(--gold);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 600px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .form-input, .form-select {
            width: 100%;
            padding: 15px 20px;
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(139, 69, 19, 0.1);
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text);
        }

        /* Booking Summary */
        .booking-summary {
            background: var(--card-bg);
            border-radius: 25px;
            border: 1px solid var(--border);
            padding: 30px;
            height: fit-content;
            position: sticky;
            top: 30px;
        }

        .summary-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-label {
            color: var(--text-secondary);
        }

        .summary-value {
            font-weight: 600;
        }

        .summary-total {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .summary-total .label {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .summary-total .amount {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--gold);
        }

        /* Reservations Table */
        .reservations-container {
            background: var(--card-bg);
            border-radius: 25px;
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .reservations-header {
            padding: 25px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .reservations-title {
            font-size: 1.3rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .filter-group {
            display: flex;
            gap: 10px;
        }

        .filter-select {
            padding: 10px 18px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-family: inherit;
        }

        .reservations-table {
            width: 100%;
            border-collapse: collapse;
        }

        .reservations-table th,
        .reservations-table td {
            padding: 18px 25px;
            text-align: right;
        }

        .reservations-table th {
            background: var(--bg-secondary);
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .reservations-table tr {
            border-bottom: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .reservations-table tr:hover {
            background: var(--card-hover);
        }

        .reservation-status {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .reservation-status.confirmed {
            background: rgba(34, 197, 94, 0.15);
            color: var(--success);
        }

        .reservation-status.pending {
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning);
        }

        .reservation-status.cancelled {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        .reservation-status.completed {
            background: rgba(139, 69, 19, 0.15);
            color: var(--primary);
        }

        .action-btn {
            width: 35px;
            height: 35px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn.edit {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
        }

        .action-btn.delete {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        /* Room Management Modal */
        .room-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .room-modal.active {
            display: flex;
        }

        .room-modal-content {
            background: var(--card-bg);
            border-radius: 25px;
            width: 100%;
            max-width: 550px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlide 0.4s ease;
        }

        @keyframes modalSlide {
            from { opacity: 0; transform: translateY(-30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .room-modal-header {
            padding: 25px 30px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .room-modal-header h3 {
            font-size: 1.4rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .room-modal-close {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            border: none;
            background: var(--bg);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .room-modal-close:hover {
            background: var(--danger);
            color: white;
        }

        .room-modal-body {
            padding: 30px;
        }

        .room-modal-footer {
            padding: 20px 30px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* Emoji Grid for Room Icons */
        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .emoji-option {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            border: 2px solid var(--border);
            background: var(--bg);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .emoji-option:hover {
            border-color: var(--primary);
            background: var(--card-hover);
            transform: scale(1.1);
        }

        .emoji-option.selected {
            border-color: var(--gold);
            background: rgba(218, 165, 32, 0.15);
        }

        /* Stats */
        .rooms-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .room-stat-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid var(--border);
            text-align: center;
            transition: all 0.3s ease;
        }

        .room-stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .room-stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }

        .room-stat-card.total .room-stat-icon {
            background: rgba(139, 69, 19, 0.15);
            color: var(--primary);
        }

        .room-stat-card.available .room-stat-icon {
            background: rgba(34, 197, 94, 0.15);
            color: var(--success);
        }

        .room-stat-card.booked .room-stat-icon {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        .room-stat-card.revenue .room-stat-icon {
            background: rgba(218, 165, 32, 0.15);
            color: var(--gold);
        }

        .room-stat-value {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .room-stat-label {
            color: var(--text-secondary);
        }

        /* Orders Badge */
        .orders-badge {
            background: var(--danger);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-right: 5px;
        }

        /* Order Card */
        .order-card {
            background: var(--card-bg);
            border-radius: 20px;
            border: 1px solid var(--border);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .order-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        .order-card-header {
            padding: 15px 20px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-card-header .room-name {
            font-weight: 700;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .order-card-header .order-status {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .order-status.pending { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .order-status.preparing { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .order-status.ready { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .order-status.paid { background: rgba(139, 92, 246, 0.2); color: #8b5cf6; }

        .order-card-body {
            padding: 20px;
        }

        .order-items-list {
            margin-bottom: 15px;
        }

        .order-item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .order-item-row:last-child {
            border-bottom: none;
        }

        .order-item-name {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .order-card-footer {
            padding: 15px 20px;
            background: var(--bg-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-total {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--gold);
        }

        .order-actions {
            display: flex;
            gap: 8px;
        }

        .order-actions .btn {
            padding: 8px 15px;
            font-size: 0.85rem;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 30px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--text);
        }

        /* Toast */
        .toast-container {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 2000;
        }

        .toast {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
            animation: toastIn 0.4s ease;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .toast.success { border-right: 4px solid var(--success); }
        .toast.error { border-right: 4px solid var(--danger); }

        @keyframes toastIn {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar"></aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <h1>ğŸ’¨ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø®Ø§ØµØ©</h1>
            <p>Ø¥Ø¯Ø§Ø±Ø© ÙˆØ­Ø¬Ø² Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø´ÙŠØ´Ø© VIP</p>
        </div>

        <!-- Tabs -->
        <div class="tabs-container">
            <button class="tab-btn active" onclick="switchTab('rooms', this)">
                <i class="fas fa-door-open"></i>
                Ø§Ù„ØºØ±Ù Ø§Ù„Ù…ØªØ§Ø­Ø©
            </button>
            <button class="tab-btn" onclick="switchTab('booking', this)">
                <i class="fas fa-calendar-plus"></i>
                Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯
            </button>
            <button class="tab-btn admin-only" id="tab-reservations-btn" onclick="switchTab('reservations', this)">
                <i class="fas fa-list-alt"></i>
                Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª
            </button>
            <button class="tab-btn" id="tab-manage-btn" onclick="switchTab('manage', this)">
                <i class="fas fa-cog"></i>
                Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØºØ±Ù
            </button>
            <button class="tab-btn" id="tab-orders-btn" onclick="switchTab('room-orders', this)">
                <i class="fas fa-shopping-cart"></i>
                Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØºØ±Ù
                <span id="room-orders-badge" class="orders-badge" style="display:none;">0</span>
            </button>
        </div>

        <!-- Tab: Rooms -->
        <div id="tab-rooms" class="tab-content active">
            <!-- Stats -->
            <div class="rooms-stats">
                <div class="room-stat-card total">
                    <div class="room-stat-icon"><i class="fas fa-door-closed"></i></div>
                    <div class="room-stat-value" id="stat-total-rooms">0</div>
                    <div class="room-stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØºØ±Ù</div>
                </div>
                <div class="room-stat-card available">
                    <div class="room-stat-icon"><i class="fas fa-check-circle"></i></div>
                    <div class="room-stat-value" id="stat-available-rooms">0</div>
                    <div class="room-stat-label">Ù…ØªØ§Ø­Ø© Ù„Ù„Ø­Ø¬Ø²</div>
                </div>
                <div class="room-stat-card booked">
                    <div class="room-stat-icon"><i class="fas fa-clock"></i></div>
                    <div class="room-stat-value" id="stat-booked-rooms">0</div>
                    <div class="room-stat-label">Ù…Ø­Ø¬ÙˆØ²Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>
                </div>
                <div class="room-stat-card revenue">
                    <div class="room-stat-icon"><i class="fas fa-coins"></i></div>
                    <div class="room-stat-value" id="stat-rooms-revenue">0</div>
                    <div class="room-stat-label">Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ… (Ø±.Ø¹)</div>
                </div>
            </div>

            <!-- Rooms Grid -->
            <div class="rooms-grid" id="rooms-grid">
                <!-- Rooms loaded dynamically -->
            </div>
        </div>

        <!-- Tab: Booking -->
        <div id="tab-booking" class="tab-content">
            <div class="booking-section">
                <div class="booking-form-container">
                    <h3 class="booking-form-title">
                        <i class="fas fa-calendar-check"></i>
                        Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø¬Ø²
                    </h3>
                    <form id="booking-form" onsubmit="submitBooking(event)">
                        <div class="form-group">
                            <label class="form-label">Ø§Ø®ØªØ± Ø§Ù„ØºØ±ÙØ©</label>
                            <select class="form-select" id="booking-room" required onchange="updateBookingSummary()">
                                <option value="">-- Ø§Ø®ØªØ± ØºØ±ÙØ© --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø§Ø³Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <input type="text" class="form-input" id="booking-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¬Ø²</label>
                            <select class="form-select" id="booking-type" required onchange="updateBookingSummary()">
                                <option value="free">Ù…Ø¬Ø§Ù†ÙŠ (Ø¨Ù†Ø§Øª)</option>
                                <option value="paid">3 Ø±ÙŠØ§Ù„ (ÙˆÙ„Ø§Ø¯)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
                            <textarea class="form-input" id="booking-notes" rows="3" placeholder="Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª Ø®Ø§ØµØ©..."></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center; padding: 18px;">
                            <i class="fas fa-check"></i>
                            ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²
                        </button>
                    </form>
                </div>

                <div class="booking-summary">
                    <h4 class="summary-title">
                        <i class="fas fa-receipt" style="color: var(--gold);"></i>
                        Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø¬Ø²
                    </h4>
                    <div class="summary-item">
                        <span class="summary-label">Ø§Ù„ØºØ±ÙØ©</span>
                        <span class="summary-value" id="summary-room">--</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¬Ø²</span>
                        <span class="summary-value" id="summary-type">--</span>
                    </div>
                    <div class="summary-total">
                        <span class="label">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</span>
                        <span class="amount" id="summary-total">0 Ø±.Ø¹</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Reservations -->
        <div id="tab-reservations" class="tab-content">
            <div class="reservations-container">
                <div class="reservations-header">
                    <h3 class="reservations-title">
                        <i class="fas fa-calendar-alt" style="color: var(--gold);"></i>
                        Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª
                    </h3>
                    <div class="filter-group">
                        <select class="filter-select" id="filter-status" onchange="filterReservations()">
                            <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                            <option value="confirmed">Ù…Ø¤ÙƒØ¯</option>
                            <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                            <option value="cancelled">Ù…Ù„ØºÙŠ</option>
                        </select>
                        <input type="date" class="filter-select" id="filter-date" onchange="filterReservations()">
                    </div>
                </div>
                <table class="reservations-table">
                    <thead>
                        <tr>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²</th>
                            <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                            <th>Ø§Ù„ØºØ±ÙØ©</th>
                            <th>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¬Ø²</th>
                            <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="reservations-tbody">
                        <!-- Reservations loaded dynamically -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tab: Manage Rooms -->
        <div id="tab-manage" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h3 style="font-size: 1.4rem; font-weight: 700;">
                    <i class="fas fa-cogs" style="color: var(--gold);"></i>
                    Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØºØ±Ù
                </h3>
                <button class="btn btn-primary" onclick="openRoomModal()">
                    <i class="fas fa-plus"></i>
                    Ø¥Ø¶Ø§ÙØ© ØºØ±ÙØ©
                </button>
            </div>
            <div class="rooms-grid" id="manage-rooms-grid">
                <!-- Rooms for management loaded dynamically -->
            </div>
        </div>

        <!-- Tab: Room Orders -->
        <div id="tab-room-orders" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
                <h3 style="font-size: 1.4rem; font-weight: 700;">
                    <i class="fas fa-shopping-cart" style="color: var(--gold);"></i>
                    Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØºØ±Ù
                </h3>
                <div style="display: flex; gap: 10px;">
                    <select class="filter-select" id="filter-room-orders" onchange="filterRoomOrders()">
                        <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØºØ±Ù</option>
                    </select>
                    <select class="filter-select" id="filter-order-status" onchange="filterRoomOrders()">
                        <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                        <option value="pending">Ø¬Ø¯ÙŠØ¯</option>
                        <option value="preparing">Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±</option>
                        <option value="ready">Ø¬Ø§Ù‡Ø²</option>
                        <option value="paid">Ù…Ø¯ÙÙˆØ¹</option>
                    </select>
                </div>
            </div>
            
            <!-- Room Orders Stats -->
            <div class="rooms-stats" style="margin-bottom: 25px;">
                <div class="room-stat-card" style="background: linear-gradient(135deg, #3b82f6, #2563eb);">
                    <div class="room-stat-icon"><i class="fas fa-receipt"></i></div>
                    <div class="room-stat-value" id="stat-room-orders-count">0</div>
                    <div class="room-stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
                </div>
                <div class="room-stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                    <div class="room-stat-icon"><i class="fas fa-spinner"></i></div>
                    <div class="room-stat-value" id="stat-pending-orders">0</div>
                    <div class="room-stat-label">Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</div>
                </div>
                <div class="room-stat-card" style="background: linear-gradient(135deg, #10b981, #059669);">
                    <div class="room-stat-icon"><i class="fas fa-check-circle"></i></div>
                    <div class="room-stat-value" id="stat-completed-orders">0</div>
                    <div class="room-stat-label">Ø·Ù„Ø¨Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©</div>
                </div>
                <div class="room-stat-card" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                    <div class="room-stat-icon"><i class="fas fa-coins"></i></div>
                    <div class="room-stat-value" id="stat-orders-total">0</div>
                    <div class="room-stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Ø±.Ø¹)</div>
                </div>
            </div>

            <!-- Room Orders Grid -->
            <div class="rooms-grid" id="room-orders-grid" style="grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));">
                <!-- Room orders loaded dynamically -->
            </div>
        </div>
    </main>

    <!-- Room Modal -->
    <div class="room-modal" id="room-modal" onclick="closeRoomModal(event)">
        <div class="room-modal-content" onclick="event.stopPropagation()">
            <div class="room-modal-header">
                <h3 id="room-modal-title"><i class="fas fa-door-open"></i> Ø¥Ø¶Ø§ÙØ© ØºØ±ÙØ©</h3>
                <button class="room-modal-close" onclick="closeRoomModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="room-modal-body">
                <form id="room-form">
                    <input type="hidden" id="room-id">
                    <div class="form-group">
                        <label class="form-label">Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©</label>
                        <input type="text" class="form-input" id="room-name" required placeholder="Ù…Ø«Ø§Ù„: 1ØŒ 2ØŒ VIP 1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                        <select class="form-select" id="room-status" required>
                            <option value="available">Ù…ØªØ§Ø­Ø©</option>
                            <option value="booked">Ù…Ø­Ø¬ÙˆØ²Ø©</option>
                            <option value="maintenance">ØµÙŠØ§Ù†Ø©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØºØ±ÙØ©</label>
                        <input type="hidden" id="room-icon" value="ğŸ›‹ï¸">
                        <div class="emoji-grid" id="room-emoji-grid"></div>
                    </div>
                </form>
            </div>
            <div class="room-modal-footer">
                <button class="btn btn-secondary" onclick="closeRoomModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="saveRoom()">
                    <i class="fas fa-save"></i>
                    Ø­ÙØ¸
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBD3RarLj_696emYW84zZ1tliP_Th1z6mM",
            authDomain: "sham-coffee.firebaseapp.com",
            databaseURL: "https://sham-coffee-default-rtdb.firebaseio.com",
            projectId: "sham-coffee",
            storageBucket: "sham-coffee.firebasestorage.app",
            messagingSenderId: "483086837036",
            appId: "1:483086837036:web:2a6bf9084050ef399ef889"
        };
        firebase.initializeApp(firebaseConfig);
    </script>
    <script src="js/common.js"></script>
    <script src="js/sidebar.js"></script>
    <script>
        // Data
        let rooms = [];
        let reservations = [];
        let roomOrders = [];

        // Firebase paths
        function getRestaurantId() {
            const restaurantId = localStorage.getItem('restaurant_id') || 
                                localStorage.getItem('current_restaurant_id');
            return restaurantId || 'sham-coffee-1';
        }
        const RESTAURANT_ID = getRestaurantId();
        const ROOMS_PATH = `restaurant-system/restaurants/${RESTAURANT_ID}/rooms`;
        const RESERVATIONS_PATH = `restaurant-system/restaurants/${RESTAURANT_ID}/reservations`;
        const ORDERS_PATH = `restaurant-system/restaurants/${RESTAURANT_ID}/orders`;

        // Room icons (for private cafe rooms)
        const roomIcons = ['ğŸ›‹ï¸', 'â˜•', 'ğŸª‘', 'ğŸšª', 'ğŸ‘‘', 'ğŸ’', 'âœ¨', 'ğŸŒŸ', 'ğŸ¯', 'ğŸ­', 'ğŸª', 'ğŸŒ´', 'ğŸ®', 'ğŸ•¯ï¸', 'ğŸ¶', 'ğŸŒ™'];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initFirebaseListeners();
            loadRoomEmojis();
            checkUserRole();
        });
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ù„Ù…Ø¯ÙŠØ±
        function checkUserRole() {
            const userRole = localStorage.getItem('userRole') || 'worker';
            const isAdmin = userRole === 'admin' || localStorage.getItem('isAdmin') === 'true' || localStorage.getItem('admin_logged_in') === 'true';
            
            if (!isAdmin) {
                // Ø¥Ø®ÙØ§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù€ tabs Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·
                document.querySelectorAll('.admin-only').forEach(el => {
                    el.style.display = 'none';
                });
            }
            // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØºØ±Ù Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¢Ù†
        }

        function initFirebaseListeners() {
            // Listen to rooms
            firebase.database().ref(ROOMS_PATH).on('value', snapshot => {
                rooms = [];
                if (snapshot.exists()) {
                    snapshot.forEach(child => {
                        rooms.push({ id: child.key, ...child.val() });
                    });
                }
                renderRooms();
                loadRoomDropdown();
                updateStats();
            });

            // Listen to reservations
            firebase.database().ref(RESERVATIONS_PATH).on('value', snapshot => {
                reservations = [];
                if (snapshot.exists()) {
                    snapshot.forEach(child => {
                        reservations.push({ id: child.key, ...child.val() });
                    });
                }
                renderReservations();
                updateStats();
            });

            // Listen to room orders
            firebase.database().ref(ORDERS_PATH).on('value', snapshot => {
                roomOrders = [];
                if (snapshot.exists()) {
                    snapshot.forEach(child => {
                        const order = { id: child.key, ...child.val() };
                        // ÙÙ‚Ø· Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØºØ±Ù
                        const isRoom = order.locationType === 'room' || 
                                      (order.roomNumber && order.roomNumber !== null) ||
                                      (order.roomId && order.roomId !== null) ||
                                      (order.customerName && typeof order.customerName === 'string' && order.customerName.includes('ØºØ±ÙØ©'));
                        
                        const isTable = order.locationType === 'table' || 
                                       (order.tableNumber && order.tableNumber !== null && order.tableNumber !== 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' && !String(order.tableNumber).includes('ØºØ±ÙØ©'));
                        
                        if (isRoom && !isTable) {
                            roomOrders.push(order);
                        }
                    });
                }
                renderRoomOrders();
                updateRoomOrdersStats();
                loadRoomOrdersFilter();
            });
        }

        // Tab switching
        function switchTab(tabId, clickedElement) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            
            // Find the clicked tab button
            let tabBtn = null;
            if (clickedElement) {
                // Use provided element or find parent
                let element = clickedElement;
                while (element && !element.classList.contains('tab-btn')) {
                    element = element.parentElement;
                }
                tabBtn = element;
            }
            
            // If not found, find by tabId
            if (!tabBtn) {
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    if (btn.getAttribute('onclick') && btn.getAttribute('onclick').includes(`'${tabId}'`)) {
                        tabBtn = btn;
                    }
                });
            }
            
            if (tabBtn) {
                tabBtn.classList.add('active');
            }
            
            const tabContent = document.getElementById(`tab-${tabId}`);
            if (tabContent) {
                tabContent.classList.add('active');
            }
        }

        // Render rooms
        function renderRooms() {
            const grid = document.getElementById('rooms-grid');
            const manageGrid = document.getElementById('manage-rooms-grid');

            // ØªØµÙÙŠØ© Ø§Ù„ØºØ±Ù Ø§Ù„ØªÙŠ Ù„Ù‡Ø§ Ø§Ø³Ù… ØµØ­ÙŠØ­ ÙÙ‚Ø·
            const validRooms = rooms.filter(room => room.name && room.name !== 'undefined' && room.name.trim() !== '');
            
            // Ø­Ø°Ù Ø§Ù„ØºØ±Ù Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù… Ù…Ù† Firebase ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            rooms.forEach(room => {
                if (!room.name || room.name === 'undefined' || room.name.trim() === '') {
                    firebase.database().ref(`${ROOMS_PATH}/${room.id}`).remove();
                }
            });

            if (validRooms.length === 0) {
                const emptyHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <i class="fas fa-door-open"></i>
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ ØºØ±Ù</h3>
                        <p>Ø£Ø¶Ù ØºØ±Ù Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØºØ±Ù</p>
                    </div>
                `;
                grid.innerHTML = emptyHTML;
                manageGrid.innerHTML = emptyHTML;
                return;
            }

            grid.innerHTML = validRooms.map(room => createRoomCard(room, false)).join('');
            manageGrid.innerHTML = validRooms.map(room => createRoomCard(room, true)).join('');
        }

        function createRoomCard(room, isManage = false) {
            const statusText = {
                available: 'Ù…ØªØ§Ø­Ø©',
                booked: 'Ù…Ø­Ø¬ÙˆØ²Ø©',
                maintenance: 'ØµÙŠØ§Ù†Ø©'
            };

            return `
                <div class="room-card">
                    <div class="room-image">
                        <span class="room-icon">${room.icon || 'ğŸ›‹ï¸'}</span>
                        <span class="room-status ${room.status || 'available'}">${statusText[room.status || 'available'] || 'Ù…ØªØ§Ø­Ø©'}</span>
                    </div>
                    <div class="room-details">
                        <h3 class="room-name">${room.name}</h3>
                        <div class="room-actions">
                            ${isManage ? `
                                <button class="btn btn-secondary" onclick="editRoom('${room.id}')">
                                    <i class="fas fa-edit"></i>
                                    ØªØ¹Ø¯ÙŠÙ„
                                </button>
                                <button class="btn btn-danger" onclick="deleteRoom('${room.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : `
                                <button class="btn btn-primary" onclick="bookRoom('${room.id}')" ${room.status !== 'available' ? 'disabled style="opacity:0.5"' : ''}>
                                    <i class="fas fa-calendar-check"></i>
                                    Ø§Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†
                                </button>
                            `}
                        </div>
                    </div>
                </div>
            `;
        }

        // Room dropdown for booking
        function loadRoomDropdown() {
            const select = document.getElementById('booking-room');
            if (!select) return;
            select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± ØºØ±ÙØ© --</option>';
            // ØªØµÙÙŠØ© Ø§Ù„ØºØ±Ù Ø§Ù„ØµØ§Ù„Ø­Ø© ÙˆØ§Ù„Ù…ØªØ§Ø­Ø© ÙÙ‚Ø·
            rooms.filter(r => r.status === 'available' && r.name && r.name !== 'undefined' && r.name.trim() !== '').forEach(room => {
                select.innerHTML += `<option value="${room.id}">${room.name}</option>`;
            });
        }

        // Update booking summary
        function updateBookingSummary() {
            const roomSelect = document.getElementById('booking-room');
            const bookingType = document.getElementById('booking-type')?.value || 'free';

            if (!roomSelect || !roomSelect.value) {
                document.getElementById('summary-room').textContent = '--';
                document.getElementById('summary-type').textContent = '--';
                document.getElementById('summary-total').textContent = '0 Ø±.Ø¹';
                return;
            }

            const selectedOption = roomSelect.options[roomSelect.selectedIndex];
            const roomName = selectedOption.text || '--';

            document.getElementById('summary-room').textContent = roomSelect.value ? roomName : '--';
            
            let total = 0;
            let typeText = '';
            if (bookingType === 'free') {
                typeText = 'Ù…Ø¬Ø§Ù†ÙŠ (Ø¨Ù†Ø§Øª)';
                total = 0;
            } else {
                typeText = '3 Ø±ÙŠØ§Ù„ (ÙˆÙ„Ø§Ø¯)';
                total = 3;
            }
            
            document.getElementById('summary-type').textContent = typeText;
            document.getElementById('summary-total').textContent = total.toFixed(2) + ' Ø±.Ø¹';
        }


        // Book room (quick action)
        function bookRoom(roomId) {
            document.getElementById('booking-room').value = roomId;
            updateBookingSummary();
            switchTab('booking');
            document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
            document.querySelector('.tab-btn:nth-child(1)').classList.remove('active');
        }

        // Submit booking
        function submitBooking(e) {
            e.preventDefault();

            const roomId = document.getElementById('booking-room').value;
            const room = rooms.find(r => r.id === roomId);
            if (!room) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØºØ±ÙØ©', 'error');
                return;
            }

            const bookingType = document.getElementById('booking-type').value;
            const customerName = document.getElementById('booking-name').value.trim() || 'Ø¹Ù…ÙŠÙ„';
            const notes = document.getElementById('booking-notes').value.trim();
            
            let total = 0;
            let bookingTypeText = '';
            if (bookingType === 'free') {
                bookingTypeText = 'Ù…Ø¬Ø§Ù†ÙŠ (Ø¨Ù†Ø§Øª)';
                total = 0;
            } else {
                bookingTypeText = '3 Ø±ÙŠØ§Ù„ (ÙˆÙ„Ø§Ø¯)';
                total = 3;
            }

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ù„/Ø§Ù„Ø£Ø¯Ù…Ù†
            const workerName = localStorage.getItem('worker_name') || localStorage.getItem('admin_name') || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const workerId = localStorage.getItem('worker_id') || localStorage.getItem('admin_username') || '';

            const reservation = {
                roomId,
                roomName: room.name,
                roomIcon: room.icon || 'ğŸ›‹ï¸',
                customerName: customerName,
                bookingType: bookingTypeText,
                notes: notes,
                total: parseFloat(total.toFixed(2)),
                status: 'confirmed',
                createdAt: firebase.database.ServerValue.TIMESTAMP,
                createdAtISO: new Date().toISOString(),
                createdBy: {
                    name: workerName,
                    id: workerId
                },
                source: 'rooms-page'
            };

            // Save reservation
            firebase.database().ref(RESERVATIONS_PATH).push(reservation)
                .then(() => {
                    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØºØ±ÙØ© Ø¥Ù„Ù‰ Ù…Ø­Ø¬ÙˆØ²Ø©
                    return firebase.database().ref(`${ROOMS_PATH}/${roomId}`).update({ 
                        status: 'booked',
                        currentReservation: {
                            customerName: customerName,
                            bookingType: bookingTypeText,
                            startTime: new Date().toISOString()
                        }
                    });
                })
                .then(() => {
                    showToast('ØªÙ… Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­! âœ…', 'success');
                    document.getElementById('booking-form').reset();
                    updateBookingSummary();
                    switchTab('reservations');
                    // Activate correct tab
                    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                    document.querySelector('.tab-btn:nth-child(3)').classList.add('active');
                })
                .catch(err => showToast(err.message, 'error'));
        }

        // Render reservations
        function renderReservations() {
            const tbody = document.getElementById('reservations-tbody');
            
            if (reservations.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <i class="fas fa-calendar-times" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª
                        </td>
                    </tr>
                `;
                return;
            }

            const statusFilter = document.getElementById('filter-status').value;
            const dateFilter = document.getElementById('filter-date').value;

            let filtered = reservations;
            if (statusFilter !== 'all') {
                filtered = filtered.filter(r => r.status === statusFilter);
            }
            if (dateFilter) {
                filtered = filtered.filter(r => r.checkin === dateFilter || r.checkout === dateFilter);
            }

            tbody.innerHTML = filtered.map((res, i) => {
                const statusText = {
                    confirmed: 'Ù…Ø¤ÙƒØ¯',
                    pending: 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
                    cancelled: 'Ù…Ù„ØºÙŠ',
                    completed: 'Ù…ÙƒØªÙ…Ù„'
                };
                return `
                    <tr>
                        <td>#${String(i + 1).padStart(4, '0')}</td>
                        <td>
                            <strong>${res.customerName || 'Ø¹Ù…ÙŠÙ„'}</strong>
                            ${res.bookingType ? `<br><small style="color: var(--text-secondary);">${res.bookingType}</small>` : ''}
                        </td>
                        <td>${res.roomName || res.room || '--'}</td>
                        <td>${res.bookingType || '--'}</td>
                        <td><strong>${res.total ? parseFloat(res.total).toFixed(2) : '0.00'} Ø±.Ø¹</strong></td>
                        <td><span class="reservation-status ${res.status || 'confirmed'}">${statusText[res.status] || 'Ù…Ø¤ÙƒØ¯'}</span></td>
                        <td>
                            <button class="action-btn edit" onclick="completeReservation('${res.id}')" title="Ø¥ØªÙ…Ø§Ù…" style="background: rgba(34, 197, 94, 0.15); color: var(--success);">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteReservation('${res.id}')" title="Ø­Ø°Ù">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function filterReservations() {
            renderReservations();
        }

        function deleteReservation(id) {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø² Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')) return;
            
            const res = reservations.find(r => r.id === id);
            firebase.database().ref(`${RESERVATIONS_PATH}/${id}`).remove()
                .then(() => {
                    // Make room available again
                    if (res && res.roomId) {
                        return firebase.database().ref(`${ROOMS_PATH}/${res.roomId}`).update({ status: 'available' });
                    }
                })
                .then(() => {
                    showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø²', 'success');
                    // Remove from local array
                    reservations = reservations.filter(r => r.id !== id);
                    renderReservations();
                })
                .catch(err => showToast(err.message, 'error'));
        }
        
        function cancelReservation(id) {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²ØŸ')) return;
            
            const res = reservations.find(r => r.id === id);
            firebase.database().ref(`${RESERVATIONS_PATH}/${id}`).update({ status: 'cancelled' })
                .then(() => {
                    // Make room available again
                    if (res && res.roomId) {
                        return firebase.database().ref(`${ROOMS_PATH}/${res.roomId}`).update({ status: 'available' });
                    }
                })
                .then(() => showToast('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø²', 'success'))
                .catch(err => showToast(err.message, 'error'));
        }

        function editReservation(id) {
            showToast('Ù…ÙŠØ²Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'info');
        }

        function completeReservation(id) {
            if (!confirm('Ù‡Ù„ ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²ØŸ')) return;
            firebase.database().ref(`${RESERVATIONS_PATH}/${id}`).update({ status: 'completed' })
                .then(() => showToast('ØªÙ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø­Ø¬Ø²', 'success'))
                .catch(err => showToast(err.message, 'error'));
        }

        // Room Modal
        function loadRoomEmojis() {
            const grid = document.getElementById('room-emoji-grid');
            grid.innerHTML = roomIcons.map(icon => 
                `<div class="emoji-option" onclick="selectRoomIcon('${icon}', this)">${icon}</div>`
            ).join('');
            // Select first by default
            grid.querySelector('.emoji-option')?.classList.add('selected');
        }

        function selectRoomIcon(icon, el) {
            document.querySelectorAll('#room-emoji-grid .emoji-option').forEach(e => e.classList.remove('selected'));
            el.classList.add('selected');
            document.getElementById('room-icon').value = icon;
        }

        function openRoomModal(editMode = false) {
            document.getElementById('room-modal').classList.add('active');
            if (!editMode) {
                document.getElementById('room-form').reset();
                document.getElementById('room-id').value = '';
                document.getElementById('room-modal-title').innerHTML = '<i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ØºØ±ÙØ©';
                document.getElementById('room-status').value = 'available';
                document.getElementById('room-icon').value = 'ğŸ›‹ï¸';
                document.querySelectorAll('#room-emoji-grid .emoji-option').forEach(e => e.classList.remove('selected'));
                document.querySelector('#room-emoji-grid .emoji-option')?.classList.add('selected');
            }
        }

        function closeRoomModal(e) {
            if (e && e.target !== e.currentTarget) return;
            document.getElementById('room-modal').classList.remove('active');
        }

        function editRoom(id) {
            const room = rooms.find(r => r.id === id);
            if (!room) return;

            document.getElementById('room-id').value = room.id;
            document.getElementById('room-name').value = room.name;
            document.getElementById('room-status').value = room.status || 'available';
            document.getElementById('room-icon').value = room.icon || 'ğŸ›‹ï¸';
            document.getElementById('room-modal-title').innerHTML = '<i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØºØ±ÙØ©';

            // Select correct emoji
            document.querySelectorAll('#room-emoji-grid .emoji-option').forEach(el => {
                el.classList.toggle('selected', el.textContent === (room.icon || 'ğŸ›‹ï¸'));
            });

            openRoomModal(true);
        }

        function saveRoom() {
            const id = document.getElementById('room-id').value;
            const roomName = document.getElementById('room-name').value.trim();
            const roomStatus = document.getElementById('room-status').value;
            const roomIcon = document.getElementById('room-icon').value || 'ğŸ›‹ï¸';

            if (!roomName) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©', 'error');
                return;
            }

            const roomData = {
                name: roomName,
                status: roomStatus,
                icon: roomIcon,
                updatedAt: firebase.database.ServerValue.TIMESTAMP
            };

            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯Ø©ØŒ Ø£Ø¶Ù createdAt
            if (!id) {
                roomData.createdAt = firebase.database.ServerValue.TIMESTAMP;
            }

            const ref = id 
                ? firebase.database().ref(`${ROOMS_PATH}/${id}`) 
                : firebase.database().ref(ROOMS_PATH).push();

            (id ? ref.update(roomData) : ref.set(roomData))
                .then(() => {
                    showToast(id ? 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØºØ±ÙØ©' : 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØºØ±ÙØ©', 'success');
                    closeRoomModal();
                })
                .catch(err => showToast(err.message, 'error'));
        }

        function deleteRoom(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ØºØ±ÙØ©ØŸ')) return;
            firebase.database().ref(`${ROOMS_PATH}/${id}`).remove()
                .then(() => showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ØºØ±ÙØ©', 'success'))
                .catch(err => showToast(err.message, 'error'));
        }

        // Stats
        function updateStats() {
            // ØªØµÙÙŠØ© Ø§Ù„ØºØ±Ù Ø§Ù„ØµØ§Ù„Ø­Ø© ÙÙ‚Ø· Ù„Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            const validRooms = rooms.filter(r => r.name && r.name !== 'undefined' && r.name.trim() !== '');
            document.getElementById('stat-total-rooms').textContent = validRooms.length;
            document.getElementById('stat-available-rooms').textContent = validRooms.filter(r => r.status === 'available').length;
            document.getElementById('stat-booked-rooms').textContent = validRooms.filter(r => r.status === 'booked').length;

            // Today's revenue
            const today = new Date().toISOString().split('T')[0];
            const todayRevenue = reservations
                .filter(r => r.checkin === today && r.status === 'confirmed')
                .reduce((sum, r) => sum + (r.total || 0), 0);
            document.getElementById('stat-rooms-revenue').textContent = todayRevenue.toFixed(0);
        }

        // Toast
        // ===== Room Orders Functions =====
        function renderRoomOrders() {
            const grid = document.getElementById('room-orders-grid');
            if (!grid) return;

            const roomFilter = document.getElementById('filter-room-orders')?.value || 'all';
            const statusFilter = document.getElementById('filter-order-status')?.value || 'all';

            let filtered = roomOrders;
            
            if (roomFilter !== 'all') {
                filtered = filtered.filter(o => {
                    const roomName = o.roomNumber || o.roomId || o.customerName || '';
                    return String(roomName).includes(roomFilter);
                });
            }
            
            if (statusFilter !== 'all') {
                filtered = filtered.filter(o => o.status === statusFilter);
            }

            // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø£Ø­Ø¯Ø«
            filtered.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <i class="fas fa-shopping-cart"></i>
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù„Ù„ØºØ±Ù</h3>
                        <p>Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØºØ±Ù Ù‡Ù†Ø§ Ø¹Ù†Ø¯ ÙˆØ±ÙˆØ¯Ù‡Ø§</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filtered.map(order => createOrderCard(order)).join('');
        }

        function createOrderCard(order) {
            const statusText = {
                pending: 'Ø¬Ø¯ÙŠØ¯',
                new: 'Ø¬Ø¯ÙŠØ¯',
                preparing: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±',
                ready: 'Ø¬Ø§Ù‡Ø²',
                paid: 'Ù…Ø¯ÙÙˆØ¹',
                completed: 'Ù…ÙƒØªÙ…Ù„',
                cancelled: 'Ù…Ù„ØºÙŠ'
            };

            const roomName = order.roomNumber || order.customerName || order.locationNumber || 'ØºØ±ÙØ©';
            const orderTime = order.createdAt ? new Date(order.createdAt).toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' }) : '';
            const orderDate = order.createdAt ? new Date(order.createdAt).toLocaleDateString('ar-SA') : '';

            const itemsHtml = order.items ? order.items.map(item => `
                <div class="order-item-row">
                    <div class="order-item-name">
                        <span>${item.emoji || 'ğŸ“¦'}</span>
                        <span>${item.name}</span>
                        <span style="color: var(--text-secondary);">Ã—${item.quantity}</span>
                    </div>
                    <span style="font-weight: 600;">${(item.price * item.quantity).toFixed(3)} Ø±.Ø¹</span>
                </div>
            `).join('') : '';

            const workerInfo = order.workerName ? `<span style="font-size: 0.8rem; color: var(--text-secondary);"><i class="fas fa-user"></i> ${order.workerName}</span>` : '';

            return `
                <div class="order-card">
                    <div class="order-card-header">
                        <div class="room-name">
                            <i class="fas fa-door-open"></i>
                            ${roomName}
                        </div>
                        <span class="order-status ${order.status || 'pending'}">${statusText[order.status] || 'Ø¬Ø¯ÙŠØ¯'}</span>
                    </div>
                    <div class="order-card-body">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.85rem; color: var(--text-secondary);">
                            <span>#${order.id.slice(-6).toUpperCase()}</span>
                            <span>${orderTime} - ${orderDate}</span>
                        </div>
                        ${workerInfo ? `<div style="margin-bottom: 10px;">${workerInfo}</div>` : ''}
                        <div class="order-items-list">
                            ${itemsHtml}
                        </div>
                    </div>
                    <div class="order-card-footer">
                        <div class="order-total">${(order.total || 0).toFixed(3)} Ø±.Ø¹</div>
                        <div class="order-actions">
                            ${order.status !== 'paid' && order.status !== 'completed' ? `
                                <button class="btn btn-secondary" onclick="updateRoomOrderStatus('${order.id}', 'preparing')" ${order.status === 'preparing' ? 'disabled' : ''}>
                                    <i class="fas fa-fire"></i>
                                </button>
                                <button class="btn btn-success" onclick="updateRoomOrderStatus('${order.id}', 'ready')" ${order.status === 'ready' ? 'disabled' : ''}>
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="btn btn-primary" onclick="markRoomOrderPaid('${order.id}')">
                                    <i class="fas fa-money-bill"></i>
                                </button>
                            ` : `
                                <span style="color: var(--success); font-weight: 600;"><i class="fas fa-check-circle"></i> Ù…ÙƒØªÙ…Ù„</span>
                            `}
                        </div>
                    </div>
                </div>
            `;
        }

        function updateRoomOrderStatus(orderId, newStatus) {
            firebase.database().ref(`${ORDERS_PATH}/${orderId}`).update({
                status: newStatus,
                updatedAt: new Date().toISOString()
            }).then(() => {
                showToast(newStatus === 'preparing' ? 'Ø§Ù„Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ± ğŸ”¥' : 'Ø§Ù„Ø·Ù„Ø¨ Ø¬Ø§Ù‡Ø² âœ…', 'success');
            }).catch(err => {
                console.error('Error updating order:', err);
                showToast('Ø­Ø¯Ø« Ø®Ø·Ø£', 'error');
            });
        }

        function markRoomOrderPaid(orderId) {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) return;
            
            firebase.database().ref(`${ORDERS_PATH}/${orderId}`).update({
                status: 'paid',
                paidAt: new Date().toISOString()
            }).then(() => {
                showToast('ØªÙ… Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­ âœ…', 'success');
            }).catch(err => {
                console.error('Error marking paid:', err);
                showToast('Ø­Ø¯Ø« Ø®Ø·Ø£', 'error');
            });
        }

        function updateRoomOrdersStats() {
            const total = roomOrders.length;
            const pending = roomOrders.filter(o => o.status === 'pending' || o.status === 'new').length;
            const completed = roomOrders.filter(o => o.status === 'paid' || o.status === 'completed').length;
            const totalSales = roomOrders.filter(o => o.status === 'paid' || o.status === 'completed')
                .reduce((sum, o) => sum + parseFloat(o.total || 0), 0);

            document.getElementById('stat-room-orders-count').textContent = total;
            document.getElementById('stat-pending-orders').textContent = pending;
            document.getElementById('stat-completed-orders').textContent = completed;
            document.getElementById('stat-orders-total').textContent = totalSales.toFixed(3);

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø§Ø¯Ø¬
            const badge = document.getElementById('room-orders-badge');
            if (badge) {
                if (pending > 0) {
                    badge.textContent = pending;
                    badge.style.display = 'inline-block';
                } else {
                    badge.style.display = 'none';
                }
            }
        }

        function loadRoomOrdersFilter() {
            const select = document.getElementById('filter-room-orders');
            if (!select) return;

            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ØºØ±Ù Ù…Ù† Ø§Ù„Ø·Ù„Ø¨Ø§Øª
            const roomNames = new Set();
            roomOrders.forEach(order => {
                const roomName = order.roomNumber || order.customerName || order.locationNumber;
                if (roomName) roomNames.add(roomName);
            });

            select.innerHTML = '<option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØºØ±Ù</option>';
            roomNames.forEach(name => {
                select.innerHTML += `<option value="${name}">${name}</option>`;
            });
        }

        function filterRoomOrders() {
            renderRoomOrders();
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3500);
        }

        // Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø© - Ù„Ù„Ø£Ø¯Ù…Ù† Ø£Ùˆ Ø§Ù„Ø¹Ø§Ù…Ù„
        const isAdmin = localStorage.getItem('admin_logged_in') === 'true';
        const isWorker = localStorage.getItem('worker_logged_in') === 'true';
        
        if (!isAdmin && !isWorker) {
            window.location.href = 'login-admin.html';
        }
    </script>
</body>
</html>

