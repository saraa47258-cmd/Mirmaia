(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,1465,97427,8070,83877,92953,34991,e=>{"use strict";let t,n,i,r,s,o,a,l,h,u,c,d,p,_,f,m;var g,y,v,C,w=e.i(47167);let b=function(e,t){if(!e)throw E(t)},E=function(e){return Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},I=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:((64512&r)==55296&&i+1<e.length&&(64512&e.charCodeAt(i+1))==56320?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128)}return t},T=function(e){let t=[],n=0,i=0;for(;n<e.length;){let r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){let s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){let s=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(s>>10)),t[i++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")},S={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){let r=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,h=r>>2,u=(3&r)<<4|o>>4,c=(15&o)<<2|l>>6,d=63&l;!a&&(d=64,s||(c=64)),i.push(n[h],n[u],n[c],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(I(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):T(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){let r=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,o=++t<e.length?n[e.charAt(t)]:64,a=++t<e.length?n[e.charAt(t)]:64;if(++t,null==r||null==s||null==o||null==a)throw new k;let l=r<<2|s>>4;if(i.push(l),64!==o){let e=s<<4&240|o>>2;if(i.push(e),64!==a){let e=o<<6&192|a;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class k extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let P=function(e){let t=I(e);return S.encodeByteArray(t,!0)},N=function(e){return P(e).replace(/\./g,"")},x=function(e){try{return S.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function R(e){return function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(let i in n)n.hasOwnProperty(i)&&"__proto__"!==i&&(t[i]=e(t[i],n[i]));return t}(void 0,e)}let D=()=>{try{return("u">typeof self?self:"u">typeof window?window:e.g).__FIREBASE_DEFAULTS__||(()=>{if(void 0===w.default||void 0===w.default.env)return;let e=w.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("u"<typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&x(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},A=e=>D()?.emulatorHosts?.[e],O=e=>{let t=A(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},L=()=>D()?.config,M=e=>D()?.[`_${e}`];class F{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function q(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function B(e){return(await fetch(e,{credentials:"include"})).ok}function W(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...e};return[N(JSON.stringify({alg:"none",type:"JWT"})),N(JSON.stringify(s)),""].join(".")}let U={},H=!1;function j(e,t){if("u"<typeof window||"u"<typeof document||!q(window.location.host)||U[e]===t||U[e]||H)return;function n(e){return`__firebase__banner__${e}`}U[e]=t;let i="__firebase__banner",r=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(U))U[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(i),t=!1,e||((e=document.createElement("div")).setAttribute("id",i),t=!0),{created:t,element:e}),o=n("text"),a=document.getElementById(o)||document.createElement("span"),l=n("learnmore"),h=document.getElementById(l)||document.createElement("a"),u=n("preprendIcon"),c=document.getElementById(u)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",h.setAttribute("id",l),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline";let n=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;H=!0,(e=document.getElementById(i))&&e.remove()},e);c.setAttribute("width","24"),c.setAttribute("id",u),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",t.append(c,a,h,n),document.body.appendChild(t)}r?(a.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,a.innerText="Preview backend running in this workspace."),a.setAttribute("id",o)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function z(){return"u">typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function V(){return"u">typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(z())}function $(){return"u">typeof window||Y()}function Y(){return"u">typeof WorkerGlobalScope&&"u">typeof self&&self instanceof WorkerGlobalScope}function K(){return"u">typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function Q(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function G(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function J(){let e=z();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function X(){return false}function Z(){try{return"object"==typeof indexedDB}catch(e){return!1}}function ee(){return new Promise((e,t)=>{try{let n=!0,i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{t(r.error?.message||"")}}catch(e){t(e)}})}class et extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,et.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,en.prototype.create)}}class en{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,i;let r=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?(n=o,i=r,n.replace(ei,(e,t)=>{let n=i[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new et(s,l,r)}}let ei=/\{\$([^}]+)}/g;function er(e){return JSON.parse(e)}function es(e){return JSON.stringify(e)}let eo=function(e){let t={},n={},i={},r="";try{let s=e.split(".");t=er(x(s[0])||""),n=er(x(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:i,signature:r}},ea=function(e){let t=eo(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},el=function(e){let t=eo(e).claims;return"object"==typeof t&&!0===t.admin};function eh(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function eu(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function ec(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function ed(e,t,n){let i={};for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function ep(e,t){if(e===t)return!0;let n=Object.keys(e),i=Object.keys(t);for(let r of n){if(!i.includes(r))return!1;let n=e[r],s=t[r];if(e_(n)&&e_(s)){if(!ep(n,s))return!1}else if(n!==s)return!1}for(let e of i)if(!n.includes(e))return!1;return!0}function e_(e){return null!==e&&"object"==typeof e}function ef(e){let t=[];for(let[n,i]of Object.entries(e))Array.isArray(i)?i.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function em(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}}),t}function eg(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class ey{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(e,t){let n,i;t||(t=0);let r=this.W_;if("string"==typeof e)for(let n=0;n<16;n++)r[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let n=0;n<16;n++)r[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=r[e-3]^r[e-8]^r[e-14]^r[e-16];r[e]=(t<<1|t>>>31)&0xffffffff}let s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(n=l^o&(a^l),i=0x5a827999):(n=o^a^l,i=0x6ed9eba1):e<60?(n=o&a|l&(o|a),i=0x8f1bbcdc):(n=o^a^l,i=0xca62c1d6);let t=(s<<5|s>>>27)+n+h+i+r[e]|0;h=l,l=a,a=(o<<30|o>>>2)&0xffffffff,o=s,s=t}this.chain_[0]=this.chain_[0]+s|0,this.chain_[1]=this.chain_[1]+o|0,this.chain_[2]=this.chain_[2]+a|0,this.chain_[3]=this.chain_[3]+l|0,this.chain_[4]=this.chain_[4]+h|0}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let n=t-this.blockSize,i=0,r=this.buf_,s=this.inbuf_;for(;i<t;){if(0===s)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(r[s]=e.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}else for(;i<t;)if(r[s]=e[i],++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let i=24;i>=0;i-=8)e[n]=this.chain_[t]>>i&255,++n;return e}}function ev(e,t){let n=new eC(e,t);return n.subscribe.bind(n)}class eC{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(i=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:n}:e).next&&(i.next=ew),void 0===i.error&&(i.error=ew),void 0===i.complete&&(i.complete=ew);let r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}}),this.observers.push(i),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"u">typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ew(){}function eb(e,t){return`${e} failed: ${t} argument `}let eE=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);if(r>=55296&&r<=56319){let t=r-55296;b(++i<e.length,"Surrogate pair missing trail surrogate."),r=65536+(t<<10)+(e.charCodeAt(i)-56320)}r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return t},eI=function(e){let t=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t};function eT(e){return e&&e._delegate?e._delegate:e}e.s(["Deferred",()=>F,"ErrorFactory",()=>en,"FirebaseError",()=>et,"Sha1",()=>ey,"assert",()=>b,"assertionError",()=>E,"base64",()=>S,"base64Decode",()=>x,"base64Encode",()=>P,"base64urlEncodeWithoutPadding",()=>N,"contains",()=>eh,"createMockUserToken",()=>W,"createSubscribe",()=>ev,"deepCopy",()=>R,"deepEqual",()=>ep,"errorPrefix",()=>eb,"extractQuerystring",()=>eg,"getDefaultAppConfig",()=>L,"getDefaultEmulatorHost",()=>A,"getDefaultEmulatorHostnameAndPort",()=>O,"getExperimentalSetting",()=>M,"getModularInstance",()=>eT,"getUA",()=>z,"isAdmin",()=>el,"isBrowser",()=>$,"isBrowserExtension",()=>Q,"isCloudWorkstation",()=>q,"isCloudflareWorker",()=>K,"isEmpty",()=>ec,"isIE",()=>J,"isIndexedDBAvailable",()=>Z,"isMobileCordova",()=>V,"isNodeSdk",()=>X,"isReactNative",()=>G,"isValidFormat",()=>ea,"isWebWorker",()=>Y,"jsonEval",()=>er,"map",()=>ed,"pingServer",()=>B,"querystring",()=>ef,"querystringDecode",()=>em,"safeGet",()=>eu,"stringLength",()=>eI,"stringToByteArray",()=>eE,"stringify",()=>es,"updateEmulatorBanner",()=>j,"validateIndexedDBOpenable",()=>ee],97427);class eS{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let ek="[DEFAULT]";class eP{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new F;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}if(n)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:ek})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=ek){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=ek){return this.instances.has(e)}getOptions(e=ek){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){let n=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(n)??new Set;i.add(e),this.onInitCallbacks.set(n,i);let r=this.instances.get(n);return r&&e(r,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let i of n)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===ek?void 0:n,options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=ek){return this.component?this.component.multipleInstances?e:ek:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class eN{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new eP(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}e.s(["Component",()=>eS,"ComponentContainer",()=>eN,"Provider",()=>eP],8070);let ex=[];(g=v||(v={}))[g.DEBUG=0]="DEBUG",g[g.VERBOSE=1]="VERBOSE",g[g.INFO=2]="INFO",g[g.WARN=3]="WARN",g[g.ERROR=4]="ERROR",g[g.SILENT=5]="SILENT";let eR={debug:v.DEBUG,verbose:v.VERBOSE,info:v.INFO,warn:v.WARN,error:v.ERROR,silent:v.SILENT},eD=v.INFO,eA={[v.DEBUG]:"log",[v.VERBOSE]:"log",[v.INFO]:"info",[v.WARN]:"warn",[v.ERROR]:"error"},eO=(e,t,...n)=>{if(t<e.logLevel)return;let i=new Date().toISOString(),r=eA[t];if(r)console[r](`[${i}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class eL{constructor(e){this.name=e,this._logLevel=eD,this._logHandler=eO,this._userLogHandler=null,ex.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in v))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?eR[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,v.DEBUG,...e),this._logHandler(this,v.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,v.VERBOSE,...e),this._logHandler(this,v.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,v.INFO,...e),this._logHandler(this,v.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,v.WARN,...e),this._logHandler(this,v.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,v.ERROR,...e),this._logHandler(this,v.ERROR,...e)}}function eM(e){ex.forEach(t=>{t.setLogLevel(e)})}function eF(e,t){for(let n of ex){let i=null;t&&t.level&&(i=eR[t.level]),null===e?n.userLogHandler=null:n.userLogHandler=(t,n,...r)=>{let s=r.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");n>=(i??t.logLevel)&&e({level:v[n].toLowerCase(),message:s,args:r,type:t.name})}}}e.s(["LogLevel",()=>v,"Logger",()=>eL,"setLogLevel",()=>eM,"setUserLogHandler",()=>eF],83877);let eq=new WeakMap,eB=new WeakMap,eW=new WeakMap,eU=new WeakMap,eH=new WeakMap,ej={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return eB.get(e);if("objectStoreNames"===t)return e.objectStoreNames||eW.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ez(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ez(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(ez(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&eq.set(t,e)}).catch(()=>{}),eH.set(t,e),t}if(eU.has(e))return eU.get(e);let i=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(eV(this),t),ez(eq.get(this))}:function(...t){return ez(e.apply(eV(this),t))}:function(t,...n){let i=e.call(eV(this),t,...n);return eW.set(i,t.sort?t.sort():[t]),ez(i)};return e instanceof IDBTransaction&&function(e){if(eB.has(e))return;let t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)});eB.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,ej):e}(e);return i!==e&&(eU.set(e,i),eH.set(i,e)),i}let eV=e=>eH.get(e),e$=["get","getKey","getAll","getAllKeys","count"],eY=["put","add","delete","clear"],eK=new Map;function eQ(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eK.get(t))return eK.get(t);let n=t.replace(/FromIndex$/,""),i=t!==n,r=eY.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||e$.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,r?"readwrite":"readonly"),o=s.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&s.done]))[0]};return eK.set(t,s),s}ej={...m=ej,get:(e,t,n)=>eQ(e,t)||m.get(e,t,n),has:(e,t)=>!!eQ(e,t)||m.has(e,t)};class eG{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if(t=e.getComponent(),t?.type!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let eJ="@firebase/app",eX="0.14.7",eZ=new eL("@firebase/app"),e0="[DEFAULT]",e1={[eJ]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},e6=new Map,e3=new Map,e2=new Map;function e4(e,t){try{e.container.addComponent(t)}catch(n){eZ.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function e5(e,t){e.container.addOrOverwriteComponent(t)}function e8(e){let t=e.name;if(e2.has(t))return eZ.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(e2.set(t,e),e6.values()))e4(n,e);for(let t of e3.values())e4(t,e);return!0}function e7(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function e9(e,t,n=e0){e7(e,t).clearInstance(n)}function te(e){return void 0!==e.options}function tt(e){return!te(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function tn(e){return null!=e&&void 0!==e.settings}function ti(){e2.clear()}let tr=new en("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class ts{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new eS("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw tr.create("app-deleted",{appName:this._name})}}function to(e,t){let n=x(e.split(".")[1]);null===n?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(n).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(n).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class ta extends ts{constructor(e,t,n,i){const r=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:n,automaticDataCollectionEnabled:r};void 0!==e.apiKey?super(e,s,i):super(e.options,s,i),this._serverConfig={automaticDataCollectionEnabled:r,...t},this._serverConfig.authIdToken&&to(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&to(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"u">typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,t_(eJ,eX,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){tp(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw tr.create("server-app-deleted")}}let tl="12.8.0";function th(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let i={name:e0,automaticDataCollectionEnabled:!0,...t},r=i.name;if("string"!=typeof r||!r)throw tr.create("bad-app-name",{appName:String(r)});if(n||(n=L()),!n)throw tr.create("no-options");let s=e6.get(r);if(s)if(ep(n,s.options)&&ep(i,s.config))return s;else throw tr.create("duplicate-app",{appName:r});let o=new eN(r);for(let e of e2.values())o.addComponent(e);let a=new ts(n,i,o);return e6.set(r,a),a}function tu(e,t={}){let n;if($()&&!Y())throw tr.create("invalid-server-app-environment");let i=t||{};if(e&&(te(e)?n=e.options:tt(e)?i=e:n=e),void 0===i.automaticDataCollectionEnabled&&(i.automaticDataCollectionEnabled=!0),n||(n=L()),!n)throw tr.create("no-options");let r={...i,...n};if(void 0!==r.releaseOnDeref&&delete r.releaseOnDeref,void 0!==i.releaseOnDeref&&"u"<typeof FinalizationRegistry)throw tr.create("finalization-registry-not-supported",{});let s=""+[...JSON.stringify(r)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),o=e3.get(s);if(o)return o.incRefCount(i.releaseOnDeref),o;let a=new eN(s);for(let e of e2.values())a.addComponent(e);let l=new ta(n,i,s,a);return e3.set(s,l),l}function tc(e=e0){let t=e6.get(e);if(!t&&e===e0&&L())return th();if(!t)throw tr.create("no-app",{appName:e});return t}function td(){return Array.from(e6.values())}async function tp(e){let t=!1,n=e.name;e6.has(n)?(t=!0,e6.delete(n)):e3.has(n)&&0>=e.decRefCount()&&(e3.delete(n),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function t_(e,t,n){let i=e1[e]??e;n&&(i+=`-${n}`);let r=i.match(/\s|\//),s=t.match(/\s|\//);if(r||s){let e=[`Unable to register library "${i}" with version "${t}":`];r&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),eZ.warn(e.join(" "));return}e8(new eS(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}function tf(e,t){if(null!==e&&"function"!=typeof e)throw tr.create("invalid-log-argument");eF(e,t)}function tm(e){eM(e)}let tg="firebase-heartbeat-store",ty=null;function tv(){return ty||(ty=(function(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){let o=indexedDB.open(e,1),a=ez(o);return i&&o.addEventListener("upgradeneeded",e=>{i(ez(o.result),e.oldVersion,e.newVersion,ez(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(tg)}catch(e){console.warn(e)}}}).catch(e=>{throw tr.create("idb-open",{originalErrorMessage:e.message})})),ty}async function tC(e){try{let t=(await tv()).transaction(tg),n=await t.objectStore(tg).get(tb(e));return await t.done,n}catch(e){if(e instanceof et)eZ.warn(e.message);else{let t=tr.create("idb-get",{originalErrorMessage:e?.message});eZ.warn(t.message)}}}async function tw(e,t){try{let n=(await tv()).transaction(tg,"readwrite"),i=n.objectStore(tg);await i.put(t,tb(e)),await n.done}catch(e){if(e instanceof et)eZ.warn(e.message);else{let t=tr.create("idb-set",{originalErrorMessage:e?.message});eZ.warn(t.message)}}}function tb(e){return`${e.name}!${e.options.appId}`}class tE{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tT(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=tI();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let i=1;i<e.length;i++)e[i].date<n&&(n=e[i].date,t=i);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){eZ.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=tI(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){let n=[],i=e.slice();for(let r of e){let e=n.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),tS(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),tS(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=N(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return eZ.warn(e),""}}}function tI(){return new Date().toISOString().substring(0,10)}class tT{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Z()&&ee().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await tC(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function tS(e){return N(JSON.stringify({version:2,heartbeats:e})).length}e8(new eS("platform-logger",e=>new eG(e),"PRIVATE")),e8(new eS("heartbeat",e=>new tE(e),"PRIVATE")),t_(eJ,eX,""),t_(eJ,eX,"esm2020"),t_("fire-js",""),e.s(["SDK_VERSION",()=>tl,"_DEFAULT_ENTRY_NAME",()=>e0,"_addComponent",()=>e4,"_addOrOverwriteComponent",()=>e5,"_apps",()=>e6,"_clearComponents",()=>ti,"_components",()=>e2,"_getProvider",()=>e7,"_isFirebaseApp",()=>te,"_isFirebaseServerApp",()=>tn,"_isFirebaseServerAppSettings",()=>tt,"_registerComponent",()=>e8,"_removeServiceInstance",()=>e9,"_serverApps",()=>e3,"deleteApp",()=>tp,"getApp",()=>tc,"getApps",()=>td,"initializeApp",()=>th,"initializeServerApp",()=>tu,"onLog",()=>tf,"registerVersion",()=>t_,"setLogLevel",()=>tm],92953);let tk="@firebase/database",tP="1.1.0",tN="";function tx(e){tN=e}class tR{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),es(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:er(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class tD{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return eh(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}let tA=function(e){try{if("u">typeof window&&void 0!==window[e]){let t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new tR(t)}}catch(e){}return new tD},tO=tA("localStorage"),tL=tA("sessionStorage"),tM=new eL("@firebase/database"),tF=(p=1,function(){return p++}),tq=function(e){let t=eE(e),n=new ey;n.update(t);let i=n.digest();return S.encodeByteArray(i)},tB=function(...e){let t="";for(let n=0;n<e.length;n++){let i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=tB.apply(null,i):"object"==typeof i?t+=es(i):t+=i,t+=" "}return t},tW=null,tU=!0,tH=function(e,t){b(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(tM.logLevel=v.VERBOSE,tW=tM.log.bind(tM),t&&tL.set("logging_enabled",!0)):"function"==typeof e?tW=e:(tW=null,tL.remove("logging_enabled"))},tj=function(...e){if(!0===tU&&(tU=!1,null===tW&&!0===tL.get("logging_enabled")&&tH(!0)),tW){let t=tB.apply(null,e);tW(t)}},tz=function(e){return function(...t){tj(e,...t)}},tV=function(...e){let t="FIREBASE INTERNAL ERROR: "+tB(...e);tM.error(t)},t$=function(...e){let t=`FIREBASE FATAL ERROR: ${tB(...e)}`;throw tM.error(t),Error(t)},tY=function(...e){let t="FIREBASE WARNING: "+tB(...e);tM.warn(t)},tK=function(){"u">typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&tY("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},tQ=function(e){return"number"==typeof e&&(e!=e||e===1/0||e===-1/0)},tG=function(e){if(X()||"complete"===document.readyState)e();else{let t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},tJ="[MIN_NAME]",tX="[MAX_NAME]",tZ=function(e,t){if(e===t)return 0;{if(e===tJ||t===tX)return -1;if(t===tJ||e===tX)return 1;let n=t8(e),i=t8(t);if(null!==n)if(null!==i)return n-i==0?e.length-t.length:n-i;else return -1;return null!==i?1:e<t?-1:1}},t0=function(e,t){return e===t?0:e<t?-1:1},t1=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+es(t))},t6=function(e){if("object"!=typeof e||null===e)return es(e);let t=[];for(let n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=es(t[i]),n+=":",n+=t6(e[t[i]]);return n+"}"},t3=function(e,t){let n=e.length;if(n<=t)return[e];let i=[];for(let r=0;r<n;r+=t)r+t>n?i.push(e.substring(r,n)):i.push(e.substring(r,r+t));return i};function t2(e,t){for(let n in e)e.hasOwnProperty(n)&&t(n,e[n])}let t4=function(e){let t,n,i,r,s;b(!tQ(e),"Invalid JSON number");0===e?(n=0,i=0,t=+(1/e==-1/0)):(t=e<0,(e=Math.abs(e))>=22250738585072014e-324?(n=(r=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,i=Math.round(e*Math.pow(2,52-r)-0x10000000000000)):(n=0,i=Math.round(e/5e-324)));let o=[];for(s=52;s;s-=1)o.push(i%2?1:0),i=Math.floor(i/2);for(s=11;s;s-=1)o.push(n%2?1:0),n=Math.floor(n/2);o.push(+!!t),o.reverse();let a=o.join(""),l="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},t5=RegExp("^-?(0*)\\d{1,10}$"),t8=function(e){if(t5.test(e)){let t=Number(e);if(t>=-0x80000000&&t<=0x7fffffff)return t}return null},t7=function(e){try{e()}catch(e){setTimeout(()=>{throw tY("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},t9=function(e,t){let n=setTimeout(e,t);return"number"==typeof n&&"u">typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class ne{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,tn(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){tY(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class nt{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(tj("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',tY(e)}}class nn{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}nn.OWNER="owner";let ni=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,nr="websocket",ns="long_polling";class no{constructor(e,t,n,i,r=!1,s="",o=!1,a=!1,l=null){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=tO.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&tO.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function na(e,t,n){let i;if(b("string"==typeof t,"typeof type must == string"),b("object"==typeof n,"typeof params must == object"),t===nr)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===ns)i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);(e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams)&&(n.ns=e.namespace);let r=[];return t2(n,(e,t)=>{r.push(e+"="+t)}),i+r.join("&")}class nl{constructor(){this.counters_={}}incrementCounter(e,t=1){eh(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return R(this.counters_)}}let nh={},nu={};function nc(e){let t=e.toString();return nh[t]||(nh[t]=new nl),nh[t]}class nd{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&t7(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let np="start";class n_{constructor(e,t,n,i,r,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=tz(e),this.stats_=nc(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),na(t,ns,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new nd(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),tG(()=>{if(this.isClosed_)return;this.scriptTagHolder=new nf((...e)=>{let[t,n,i,r,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===np)this.id=n,this.password=i;else if("close"===t)n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)},(...e)=>{let[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);let e={};e[np]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"u">typeof location&&location.hostname&&ni.test(location.hostname)&&(e.r="f");let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n_.forceAllow_=!0}static forceDisallow(){n_.forceDisallow_=!0}static isAvailable(){return!X()&&(!!n_.forceAllow_||!n_.forceDisallow_&&"u">typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&("object"!=typeof Windows||"object"!=typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=es(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=t3(P(t),1840);for(let e=0;e<n.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(X())return;this.myDisconnFrame=document.createElement("iframe");let n={};n.dframe="t",n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=es(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class nf{constructor(e,t,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,X())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=tF(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=nf.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";</script>');const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){tj("frame writing exception"),e.stack&&tj(e.stack),tj(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||tj("No IE domain setting required")}catch(t){e.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+n.length<=1870){let e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}else break;return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(i),n()})}addTag(e,t){X()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{tj("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))}}let nm=null;"u">typeof MozWebSocket?nm=MozWebSocket:"u">typeof WebSocket&&(nm=WebSocket);class ng{constructor(e,t,n,i,r,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=tz(this.connId),this.stats_=nc(t),this.connURL=ng.connectionURL_(t,s,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,r){let s={};return s.v="5",!X()&&"u">typeof location&&location.hostname&&ni.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),i&&(s.ac=i),r&&(s.p=r),na(e,nr,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,tO.set("previous_websocket_failure",!0);try{let e;if(X()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/5/${tN}/${w.default.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let n=w.default.env,i=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;i&&(e.proxy={origin:i})}this.mySock=new nm(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){ng.forceDisallow_=!0}static isAvailable(){let e=!1;if("u">typeof navigator&&navigator.userAgent){let t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);t&&t.length>1&&4.4>parseFloat(t[1])&&(e=!0)}return!e&&null!==nm&&!ng.forceDisallow_}static previouslyFailed(){return tO.isInMemoryStorage||!0===tO.get("previous_websocket_failure")}markConnectionHealthy(){tO.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=er(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(b(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=es(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=t3(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ng.responsesRequiredToBeHealthy=2,ng.healthyTimeout=3e4;class ny{static get ALL_TRANSPORTS(){return[n_,ng]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){let t=ng&&ng.isAvailable(),n=t&&!ng.previouslyFailed();if(e.webSocketOnly&&(t||tY("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[ng];else{let e=this.transports_=[];for(let t of ny.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);ny.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}ny.globalTransportInitialized_=!1;class nv{constructor(e,t,n,i,r,s,o,a,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=tz("c:"+this.id+":"),this.transportManager_=new ny(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=t9(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){let t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=t1("t",e),n=t1("d",e);if("c"===t)this.onSecondaryControl_(n);else if("d"===t)this.pendingDataMessages.push(n);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=t1("t",e),n=t1("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=t1("t",e);if("d"in e){let n=e.d;if("h"===t){let e={...n};this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?tV("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):tV("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&tY("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),t9(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):t9(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(tO.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class nC{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class nw{constructor(e){this.allowedEvents_=e,this.listeners_={},b(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let e=0;e<i.length;e++)if(i[e].callback===t&&(!n||n===i[e].context))return void i.splice(e,1)}validateEventType_(e){b(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class nb extends nw{static getInstance(){return new nb}constructor(){super(["online"]),this.online_=!0,"u">typeof window&&void 0!==window.addEventListener&&!V()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return b("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class nE{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function nI(){return new nE("")}function nT(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function nS(e){return e.pieces_.length-e.pieceNum_}function nk(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new nE(e.pieces_,t)}function nP(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function nN(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function nx(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new nE(t,0)}function nR(e,t){let n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof nE)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new nE(n,0)}function nD(e){return e.pieceNum_>=e.pieces_.length}function nA(e,t){let n=nT(e),i=nT(t);if(null===n)return t;if(n===i)return nA(nk(e),nk(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function nO(e,t){let n=nN(e,0),i=nN(t,0);for(let e=0;e<n.length&&e<i.length;e++){let t=tZ(n[e],i[e]);if(0!==t)return t}return n.length===i.length?0:n.length<i.length?-1:1}function nL(e,t){if(nS(e)!==nS(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function nM(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(nS(e)>nS(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class nF{constructor(e,t){this.errorPrefix_=t,this.parts_=nN(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=eI(this.parts_[e]);nq(this)}}function nq(e){if(e.byteLength_>768)throw Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+nB(e))}function nB(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class nW extends nw{static getInstance(){return new nW}constructor(){let e,t;super(["visible"]),"u">typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return b("visible"===e,"Unknown event type: "+e),[this.visible_]}}class nU extends nC{constructor(e,t,n,i,r,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=nU.nextPersistentConnectionId_++,this.log_=tz("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!X())throw Error("Auth override specified in options, but not supported on non Node.js platforms");nW.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&nb.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){let i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_(es(r)),b(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();let t=new F,n={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:n,onComplete:e=>{let n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}}),this.outstandingGetCount_++;let i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,i){this.initConnection_();let r=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+r),this.listens.has(s)||this.listens.set(s,new Map),b(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),b(!this.listens.get(s).has(r),"listen() called twice for same path/queryId.");let o={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(s).set(r,o),this.connected_&&this.sendListen_(o)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){let t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);let r={p:n};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,r=>{let s=r.d,o=r.s;nU.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",r),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&eh(e,"w")){let n=eu(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();tY(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||el(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=ea(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{let n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){let n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),b(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);let r={p:e};i&&(r.q=n,r.t=i),this.sendRequest("n",r)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){let r={p:t,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,e=>{i&&setTimeout(()=>{i(e.s,e.d)},Math.floor(0))})}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,r){this.initConnection_();let s={p:t,d:n};void 0!==r&&(s.h=r),this.outstandingPuts_.push({action:e,request:s,onComplete:i}),this.outstandingPutCount_++;let o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+es(e));let t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):tV("Unrecognized action received from server: "+es(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){b(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+nU.nextConnectionId_++,r=this.lastSessionId,s=!1,o=null,a=function(){o?o.close():(s=!0,n())};this.realtime_={close:a,sendRequest:function(e){b(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)}};let l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[a,h]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);s?tj("getToken() completed but was canceled"):(tj("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=h&&h.token,o=new nv(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{tY(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},r))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&tY(e),a())}}}interrupt(e){tj("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){tj("Resuming connection for reason: "+e),delete this.interruptReasons_[e],ec(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>t6(e)).join("$"):"default";let i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){let n,i=new nE(e).toString();if(this.listens.has(i)){let e=this.listens.get(i);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(i)}else n=void 0;return n}onAuthRevoked_(e,t){tj("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){tj("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";X()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+tN.replace(/\./g,"-")]=1,V()?e["framework.cordova"]=1:G()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=nb.getInstance().currentlyOnline();return ec(this.interruptReasons_)&&e}}nU.nextPersistentConnectionId_=0,nU.nextConnectionId_=0;class nH{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new nH(e,t)}}class nj{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new nH(tJ,e),i=new nH(tJ,t);return 0!==this.compare(n,i)}minPost(){return nH.MIN}}class nz extends nj{static get __EMPTY_NODE(){return i}static set __EMPTY_NODE(e){i=e}compare(e,t){return tZ(e.name,t.name)}isDefinedOn(e){throw E("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return nH.MIN}maxPost(){return new nH(tX,i)}makePost(e,t){return b("string"==typeof e,"KeyIndex indexValue must always be a string."),new nH(e,i)}toString(){return".key"}}let nV=new nz;class n${constructor(e,t,n,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,i&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class nY{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:nY.RED,this.left=null!=i?i:nK.EMPTY_NODE,this.right=null!=r?r:nK.EMPTY_NODE}copy(e,t,n,i,r){return new nY(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,r=n(e,i.key);return(i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n))).fixUp_()}removeMin_(){if(this.left.isEmpty())return nK.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let n,i;if(n=this,0>t(e,n.key))n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key))if(n.right.isEmpty())return nK.EMPTY_NODE;else i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_());n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,nY.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,nY.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+ +!this.isRed_();throw Error("Black depths differ")}}nY.RED=!0,nY.BLACK=!1;class nK{constructor(e,t=nK.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new nK(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,nY.BLACK,null,null))}remove(e){return new nK(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,nY.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))if(n.left.isEmpty())if(i)return i.key;else return null;else{for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new n$(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new n$(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new n$(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new n$(this.root_,null,this.comparator_,!0,e)}}function nQ(e,t){return tZ(e.name,t.name)}function nG(e,t){return tZ(e,t)}nK.EMPTY_NODE=new class{copy(e,t,n,i,r){return this}insert(e,t,n){return new nY(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let nJ=function(e){return"number"==typeof e?"number:"+t4(e):"string:"+e},nX=function(e){if(e.isLeafNode()){let t=e.val();b("string"==typeof t||"number"==typeof t||"object"==typeof t&&eh(t,".sv"),"Priority must be a string or number.")}else b(e===r||e.isEmpty(),"priority of unexpected type.");b(e===r||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class nZ{static set __childrenNodeConstructor(e){s=e}static get __childrenNodeConstructor(){return s}constructor(e,t=nZ.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,b(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),nX(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new nZ(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:nZ.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return nD(e)?this:".priority"===nT(e)?this.priorityNode_:nZ.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:nZ.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let n=nT(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(b(".priority"!==n||1===nS(e),".priority must be the last token in a path"),this.updateImmediateChild(n,nZ.__childrenNodeConstructor.EMPTY_NODE.updateChild(nk(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+nJ(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=t4(this.value_):e+=this.value_,this.lazyHash_=tq(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===nZ.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof nZ.__childrenNodeConstructor?-1:(b(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,n=typeof this.value_,i=nZ.VALUE_TYPE_ORDER.indexOf(t),r=nZ.VALUE_TYPE_ORDER.indexOf(n);return(b(i>=0,"Unknown leaf type: "+t),b(r>=0,"Unknown leaf type: "+n),i!==r)?r-i:"object"===n?0:this.value_<e.value_?-1:1*(this.value_!==e.value_)}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}nZ.VALUE_TYPE_ORDER=["object","boolean","number","string"];let n0=new class extends nj{compare(e,t){let n=e.node.getPriority(),i=t.node.getPriority(),r=n.compareTo(i);return 0===r?tZ(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return nH.MIN}maxPost(){return new nH(tX,new nZ("[PRIORITY-POST]",a))}makePost(e,t){return new nH(t,new nZ("[PRIORITY-POST]",o(e)))}toString(){return".priority"}},n1=Math.log(2);class n6{constructor(e){this.count=parseInt(Math.log(e+1)/n1,10),this.current_=this.count-1;const t=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&t}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}let n3=function(e,t,n,i){e.sort(t);let r=function(t,i){let s,o=i-t;if(0===o)return null;if(1===o)return s=e[t],new nY(n?n(s):s,s.node,nY.BLACK,null,null);{let a=parseInt(o/2,10)+t,l=r(t,a),h=r(a+1,i);return s=e[a],new nY(n?n(s):s,s.node,nY.BLACK,l,h)}};return new nK(i||t,function(t){let i=null,s=null,o=e.length,a=function(t,i){let s=o-t,a=o;o-=t;let h=r(s+1,a),u=e[s];l(new nY(n?n(u):u,u.node,i,null,h))},l=function(e){i?i.left=e:s=e,i=e};for(let e=0;e<t.count;++e){let n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,nY.BLACK):(a(i,nY.BLACK),a(i,nY.RED))}return s}(new n6(e.length)))},n2={};class n4{static get Default(){return b(n2&&n0,"ChildrenNode.ts has not been loaded"),l=l||new n4({".priority":n2},{".priority":n0})}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=eu(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof nK?t:null}hasIndex(e){return eh(this.indexSet_,e.toString())}addIndex(e,t){let n;b(e!==nV,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],r=!1,s=t.getIterator(nH.Wrap),o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();n=r?n3(i,e.getCompare()):n2;let a=e.toString(),l={...this.indexSet_};l[a]=e;let h={...this.indexes_};return h[a]=n,new n4(h,l)}addToIndexes(e,t){return new n4(ed(this.indexes_,(n,i)=>{let r=eu(this.indexSet_,i);if(b(r,"Missing index implementation for "+i),n===n2)if(!r.isDefinedOn(e.node))return n2;else{let n=[],i=t.getIterator(nH.Wrap),s=i.getNext();for(;s;)s.name!==e.name&&n.push(s),s=i.getNext();return n.push(e),n3(n,r.getCompare())}{let i=t.get(e.name),r=n;return i&&(r=r.remove(new nH(e.name,i))),r.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new n4(ed(this.indexes_,n=>{if(n===n2)return n;{let i=t.get(e.name);return i?n.remove(new nH(e.name,i)):n}}),this.indexSet_)}}class n5{static get EMPTY_NODE(){return h||(h=new n5(new nK(nG),null,n4.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&nX(this.priorityNode_),this.children_.isEmpty()&&b(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||h}updatePriority(e){return this.children_.isEmpty()?this:new n5(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?h:t}}getChild(e){let t=nT(e);return null===t?this:this.getImmediateChild(t).getChild(nk(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(b(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let n,i,r=new nH(e,t);t.isEmpty()?(n=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(n=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));let s=n.isEmpty()?h:this.priorityNode_;return new n5(n,s,i)}}updateChild(e,t){let n=nT(e);if(null===n)return t;{b(".priority"!==nT(e)||1===nS(e),".priority must be the last token in a path");let i=this.getImmediateChild(n).updateChild(nk(e),t);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},n=0,i=0,r=!0;if(this.forEachChild(n0,(s,o)=>{t[s]=o.val(e),n++,r&&n5.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):r=!1}),e||!r||!(i<2*n))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let n in t)e[n]=t[n];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+nJ(this.getPriority().val())+":"),this.forEachChild(n0,(t,n)=>{let i=n.hash();""!==i&&(e+=":"+t+":"+i)}),this.lazyHash_=""===e?"":tq(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){let i=this.resolveIndex_(n);if(!i)return this.children_.getPredecessorKey(e);{let n=i.getPredecessorKey(new nH(e,t));return n?n.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new nH(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new nH(t,this.children_.get(t)):null}forEachChild(e,t){let n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{let n=this.children_.getIteratorFrom(e.name,nH.Wrap),i=n.peek();for(;null!=i&&0>t.compare(i,e);)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{let n=this.children_.getReverseIteratorFrom(e.name,nH.Wrap),i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){if(this.isEmpty())if(e.isEmpty())return 0;else return -1;return e.isLeafNode()||e.isEmpty()?1:e===n8?-1:0}withIndex(e){if(e===nV||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new n5(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===nV||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode()||!this.getPriority().equals(e.getPriority()))return!1;if(this.children_.count()!==e.children_.count())return!1;{let t=this.getIterator(n0),n=e.getIterator(n0),i=t.getNext(),r=n.getNext();for(;i&&r;){if(i.name!==r.name||!i.node.equals(r.node))return!1;i=t.getNext(),r=n.getNext()}return null===i&&null===r}}resolveIndex_(e){return e===nV?null:this.indexMap_.get(e.toString())}}n5.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;let n8=new class extends n5{constructor(){super(new nK(nG),n5.EMPTY_NODE,n4.Default)}compareTo(e){return+(e!==this)}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return n5.EMPTY_NODE}isEmpty(){return!1}};function n7(e,t=null){if(null===e)return n5.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),b(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new nZ(e,n7(t));if(e instanceof Array){let n=n5.EMPTY_NODE;return t2(e,(t,i)=>{if(eh(e,t)&&"."!==t.substring(0,1)){let e=n7(i);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(n7(t))}{let n=[],i=!1;if(t2(e,(e,t)=>{if("."!==e.substring(0,1)){let r=n7(t);r.isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new nH(e,r)))}}),0===n.length)return n5.EMPTY_NODE;let r=n3(n,nQ,e=>e.name,nG);if(!i)return new n5(r,n7(t),n4.Default);{let e=n3(n,n0.getCompare());return new n5(r,n7(t),new n4({".priority":e},{".priority":n0}))}}}Object.defineProperties(nH,{MIN:{value:new nH(tJ,n5.EMPTY_NODE)},MAX:{value:new nH(tX,n8)}}),nz.__EMPTY_NODE=n5.EMPTY_NODE,nZ.__childrenNodeConstructor=n5,r=n8,a=n8,o=n7;class n9 extends nj{constructor(e){super(),this.indexPath_=e,b(!nD(e)&&".priority"!==nT(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),i=this.extractChild(t.node),r=n.compareTo(i);return 0===r?tZ(e.name,t.name):r}makePost(e,t){let n=n7(e);return new nH(t,n5.EMPTY_NODE.updateChild(this.indexPath_,n))}maxPost(){return new nH(tX,n5.EMPTY_NODE.updateChild(this.indexPath_,n8))}toString(){return nN(this.indexPath_,0).join("/")}}let ie=new class extends nj{compare(e,t){let n=e.node.compareTo(t.node);return 0===n?tZ(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return nH.MIN}maxPost(){return nH.MAX}makePost(e,t){return new nH(t,n7(e))}toString(){return".value"}};function it(e){return{type:"value",snapshotNode:e}}function ii(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function ir(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function is(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class io{constructor(e){this.index_=e}updateChild(e,t,n,i,r,s){b(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let o=e.getImmediateChild(t);return o.getChild(i).equals(n.getChild(i))&&o.isEmpty()===n.isEmpty()||(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(ir(t,o)):b(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(ii(t,n)):s.trackChildChange(is(t,n,o))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(n0,(e,i)=>{t.hasChild(e)||n.trackChildChange(ir(e,i))}),t.isLeafNode()||t.forEachChild(n0,(t,i)=>{if(e.hasChild(t)){let r=e.getImmediateChild(t);r.equals(i)||n.trackChildChange(is(t,i,r))}else n.trackChildChange(ii(t,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?n5.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class ia{constructor(e){this.indexedFilter_=new io(e.getIndex()),this.index_=e.getIndex(),this.startPost_=ia.getStartPost_(e),this.endPost_=ia.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),e):0>this.index_.compare(this.getStartPost(),e),n=this.endIsInclusive_?0>=this.index_.compare(e,this.getEndPost()):0>this.index_.compare(e,this.getEndPost());return t&&n}updateChild(e,t,n,i,r,s){return this.matches(new nH(t,n))||(n=n5.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,r,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=n5.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(n5.EMPTY_NODE);let r=this;return t.forEachChild(n0,(e,t)=>{r.matches(new nH(e,t))||(i=i.updateImmediateChild(e,n5.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(!e.hasStart())return e.getIndex().minPost();{let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}}static getEndPost_(e){if(!e.hasEnd())return e.getIndex().maxPost();{let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}}}class il{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{let t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{let t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new ia(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,r,s){return(this.rangedFilter_.matches(new nH(t,n))||(n=n5.EMPTY_NODE),e.getImmediateChild(t).equals(n))?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,r,s):this.fullLimitUpdateChild_(e,t,n,r,s)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=n5.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=n5.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){let t=e.getNext();if(this.withinDirectionalStart(t))if(this.withinDirectionalEnd(t))i=i.updateImmediateChild(t.name,t.node),n++;else break}}else{let e;i=(i=t.withIndex(this.index_)).updatePriority(n5.EMPTY_NODE),e=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;e.hasNext();){let t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:i=i.updateImmediateChild(t.name,n5.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,i,r){let s;if(this.reverse_){let e=this.index_.getCompare();s=(t,n)=>e(n,t)}else s=this.index_.getCompare();b(e.numChildren()===this.limit_,"");let o=new nH(t,n),a=this.reverse_?e.getFirstChild(this.index_):e.getLastChild(this.index_),l=this.rangedFilter_.matches(o);if(e.hasChild(t)){let h=e.getImmediateChild(t),u=i.getChildAfterChild(this.index_,a,this.reverse_);for(;null!=u&&(u.name===t||e.hasChild(u.name));)u=i.getChildAfterChild(this.index_,u,this.reverse_);let c=null==u?1:s(u,o);if(l&&!n.isEmpty()&&c>=0)return null!=r&&r.trackChildChange(is(t,n,h)),e.updateImmediateChild(t,n);{null!=r&&r.trackChildChange(ir(t,h));let n=e.updateImmediateChild(t,n5.EMPTY_NODE);return null!=u&&this.rangedFilter_.matches(u)?(null!=r&&r.trackChildChange(ii(u.name,u.node)),n.updateImmediateChild(u.name,u.node)):n}}return n.isEmpty()?e:l?s(a,o)>=0?(null!=r&&(r.trackChildChange(ir(a.name,a.node)),r.trackChildChange(ii(t,n))),e.updateImmediateChild(t,n).updateImmediateChild(a.name,n5.EMPTY_NODE)):e:e}}class ih{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=n0}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return b(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(b(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:tJ}hasEnd(){return this.endSet_}getIndexEndValue(){return b(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(b(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:tX}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return b(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===n0}copy(){let e=new ih;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function iu(e,t,n){let i=e.copy();return i.startSet_=!0,void 0===t&&(t=null),i.indexStartValue_=t,null!=n?(i.startNameSet_=!0,i.indexStartName_=n):(i.startNameSet_=!1,i.indexStartName_=""),i}function ic(e,t,n){let i=e.copy();return i.endSet_=!0,void 0===t&&(t=null),i.indexEndValue_=t,void 0!==n?(i.endNameSet_=!0,i.indexEndName_=n):(i.endNameSet_=!1,i.indexEndName_=""),i}function id(e,t){let n=e.copy();return n.index_=t,n}function ip(e){let t,n={};if(e.isDefault())return n;if(e.index_===n0?t="$priority":e.index_===ie?t="$value":e.index_===nV?t="$key":(b(e.index_ instanceof n9,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=es(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";n[t]=es(e.indexStartValue_),e.startNameSet_&&(n[t]+=","+es(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";n[t]=es(e.indexEndValue_),e.endNameSet_&&(n[t]+=","+es(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function i_(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==n0&&(t.i=e.index_.toString()),t}class im extends nC{reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(b(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=tz("p:rest:"),this.listens_={}}listen(e,t,n,i){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let s=im.getListenId_(e,n),o={};this.listens_[s]=o;let a=ip(e._queryParams);this.restRequest_(r+".json",a,(e,t)=>{let a=t;(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(r,a,!1,n),eu(this.listens_,s)===o)&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})}unlisten(e,t){let n=im.getListenId_(e,t);delete this.listens_[n]}get(e){let t=ip(e._queryParams),n=e._path.toString(),i=new F;return this.restRequest_(n+".json",t,(e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(Error(r))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ef(t);this.log_("Sending REST request for "+s);let o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=er(o.responseText)}catch(e){tY("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&tY("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class ig{constructor(){this.rootNode_=n5.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function iy(){return{value:null,children:new Map}}function iv(e,t,n){if(nD(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{let i=nT(t);e.children.has(i)||e.children.set(i,iy()),iv(e.children.get(i),t=nk(t),n)}}function iC(e,t,n){var i,r;null!==e.value?n(t,e.value):(i=e,r=(e,i)=>{iC(i,new nE(t.toString()+"/"+e),n)},i.children.forEach((e,t)=>{r(t,e)}))}class iw{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t={...e};return this.last_&&t2(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class ib{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new iw(e);const n=1e4+2e4*Math.random();t9(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;t2(e,(e,i)=>{i>0&&eh(this.statsToReport_,e)&&(t[e]=i,n=!0)}),n&&this.server_.reportStats(t),t9(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function iE(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function iI(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function iT(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(y=C||(C={}))[y.OVERWRITE=0]="OVERWRITE",y[y.MERGE=1]="MERGE",y[y.ACK_USER_WRITE=2]="ACK_USER_WRITE",y[y.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class iS{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=C.ACK_USER_WRITE,this.source=iE()}operationForChild(e){if(!nD(this.path))return b(nT(this.path)===e,"operationForChild called for unrelated child."),new iS(nk(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return b(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new nE(e));return new iS(nI(),t,this.revert)}}}class ik{constructor(e,t){this.source=e,this.path=t,this.type=C.LISTEN_COMPLETE}operationForChild(e){return nD(this.path)?new ik(this.source,nI()):new ik(this.source,nk(this.path))}}class iP{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=C.OVERWRITE}operationForChild(e){return nD(this.path)?new iP(this.source,nI(),this.snap.getImmediateChild(e)):new iP(this.source,nk(this.path),this.snap)}}class iN{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=C.MERGE}operationForChild(e){if(!nD(this.path))return b(nT(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new iN(this.source,nk(this.path),this.children);{let t=this.children.subtree(new nE(e));return t.isEmpty()?null:t.value?new iP(this.source,nI(),t.value):new iN(this.source,nI(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class ix{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(nD(e))return this.isFullyInitialized()&&!this.filtered_;let t=nT(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class iR{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function iD(e,t,n,i,r,s){let o=i.filter(e=>e.type===n);o.sort((t,n)=>(function(e,t,n){if(null==t.childName||null==n.childName)throw E("Should only compare child_ events.");let i=new nH(t.childName,t.snapshotNode),r=new nH(n.childName,n.snapshotNode);return e.index_.compare(i,r)})(e,t,n)),o.forEach(n=>{var i,o,a;let l=(i=e,o=n,a=s,"value"===o.type||"child_removed"===o.type||(o.prevName=a.getPredecessorChildName(o.childName,o.snapshotNode,i.index_)),o);r.forEach(i=>{i.respondsTo(n.type)&&t.push(i.createEvent(l,e.query_))})})}function iA(e,t){return{eventCache:e,serverCache:t}}function iO(e,t,n,i){return iA(new ix(t,n,i),e.serverCache)}function iL(e,t,n,i){return iA(e.eventCache,new ix(t,n,i))}function iM(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function iF(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}class iq{static fromObject(e){let t=new iq(null);return t2(e,(e,n)=>{t=t.set(new nE(e),n)}),t}constructor(e,t=(!u&&(u=new nK(t0)),u)){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:nI(),value:this.value};{if(nD(e))return null;let n=nT(e),i=this.children.get(n);if(null===i)return null;{let r=i.findRootMostMatchingPathAndValue(nk(e),t);return null!=r?{path:nR(new nE(n),r.path),value:r.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(nD(e))return this;{let t=nT(e),n=this.children.get(t);return null!==n?n.subtree(nk(e)):new iq(null)}}set(e,t){if(nD(e))return new iq(t,this.children);{let n=nT(e),i=(this.children.get(n)||new iq(null)).set(nk(e),t),r=this.children.insert(n,i);return new iq(this.value,r)}}remove(e){if(nD(e))if(this.children.isEmpty())return new iq(null);else return new iq(null,this.children);{let t=nT(e),n=this.children.get(t);if(!n)return this;{let i,r=n.remove(nk(e));return(i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty())?new iq(null):new iq(this.value,i)}}}get(e){if(nD(e))return this.value;{let t=nT(e),n=this.children.get(t);return n?n.get(nk(e)):null}}setTree(e,t){if(nD(e))return t;{let n,i=nT(e),r=(this.children.get(i)||new iq(null)).setTree(nk(e),t);return n=r.isEmpty()?this.children.remove(i):this.children.insert(i,r),new iq(this.value,n)}}fold(e){return this.fold_(nI(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((i,r)=>{n[i]=r.fold_(nR(e,i),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,nI(),t)}findOnPath_(e,t,n){let i=!!this.value&&n(t,this.value);if(i)return i;{if(nD(e))return null;let i=nT(e),r=this.children.get(i);return r?r.findOnPath_(nk(e),nR(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,nI(),t)}foreachOnPath_(e,t,n){if(nD(e))return this;{this.value&&n(t,this.value);let i=nT(e),r=this.children.get(i);return r?r.foreachOnPath_(nk(e),nR(t,i),n):new iq(null)}}foreach(e){this.foreach_(nI(),e)}foreach_(e,t){this.children.inorderTraversal((n,i)=>{i.foreach_(nR(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class iB{constructor(e){this.writeTree_=e}static empty(){return new iB(new iq(null))}}function iW(e,t,n){if(nD(t))return new iB(new iq(n));{let i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){let r=i.path,s=i.value,o=nA(r,t);return s=s.updateChild(o,n),new iB(e.writeTree_.set(r,s))}{let i=new iq(n);return new iB(e.writeTree_.setTree(t,i))}}}function iU(e,t,n){let i=e;return t2(n,(e,n)=>{i=iW(i,nR(t,e),n)}),i}function iH(e,t){return nD(t)?iB.empty():new iB(e.writeTree_.setTree(t,new iq(null)))}function ij(e,t){return null!=iz(e,t)}function iz(e,t){let n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(nA(n.path,t)):null}function iV(e){let t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(n0,(e,n)=>{t.push(new nH(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new nH(e,n.value))}),t}function i$(e,t){if(nD(t))return e;{let n=iz(e,t);return new iB(null!=n?new iq(n):e.writeTree_.subtree(t))}}function iY(e){return e.writeTree_.isEmpty()}function iK(e,t){return function e(t,n,i){if(null!=n.value)return i.updateChild(t,n.value);{let r=null;return n.children.inorderTraversal((n,s)=>{".priority"===n?(b(null!==s.value,"Priority writes must always be leaf nodes"),r=s.value):i=e(nR(t,n),s,i)}),i.getChild(t).isEmpty()||null===r||(i=i.updateChild(nR(t,".priority"),r)),i}}(nI(),e.writeTree_,t)}function iQ(e){return e.visible}function iG(e,t,n){let i=iB.empty();for(let r=0;r<e.length;++r){let s=e[r];if(t(s)){let e,t=s.path;if(s.snap)nM(n,t)?i=iW(i,e=nA(n,t),s.snap):nM(t,n)&&(e=nA(t,n),i=iW(i,nI(),s.snap.getChild(e)));else if(s.children){if(nM(n,t))i=iU(i,e=nA(n,t),s.children);else if(nM(t,n))if(nD(e=nA(t,n)))i=iU(i,nI(),s.children);else{let t=eu(s.children,nT(e));if(t){let n=t.getChild(nk(e));i=iW(i,nI(),n)}}}else throw E("WriteRecord should have .snap or .children")}}return i}function iJ(e,t,n,i,r){if(i||r){let s=i$(e.visibleWrites,t);return!r&&iY(s)?n:r||null!=n||ij(s,nI())?iK(iG(e.allWrites,function(e){return(e.visible||r)&&(!i||!~i.indexOf(e.writeId))&&(nM(e.path,t)||nM(t,e.path))},t),n||n5.EMPTY_NODE):null}{let i=iz(e.visibleWrites,t);if(null!=i)return i;{let i=i$(e.visibleWrites,t);return iY(i)?n:null!=n||ij(i,nI())?iK(i,n||n5.EMPTY_NODE):null}}}function iX(e,t,n,i){return iJ(e.writeTree,e.treePath,t,n,i)}function iZ(e,t){return function(e,t,n){let i=n5.EMPTY_NODE,r=iz(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(n0,(e,t)=>{i=i.updateImmediateChild(e,t)}),i;if(!n)return iV(i$(e.visibleWrites,t)).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i;{let r=i$(e.visibleWrites,t);return n.forEachChild(n0,(e,t)=>{let n=iK(i$(r,new nE(e)),t);i=i.updateImmediateChild(e,n)}),iV(r).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i}}(e.writeTree,e.treePath,t)}function i0(e,t,n,i){return function(e,t,n,i,r){b(i||r,"Either existingEventSnap or existingServerSnap must exist");let s=nR(t,n);if(ij(e.visibleWrites,s))return null;{let t=i$(e.visibleWrites,s);return iY(t)?r.getChild(n):iK(t,r.getChild(n))}}(e.writeTree,e.treePath,t,n,i)}function i1(e,t){var n,i;return n=e.writeTree,i=nR(e.treePath,t),iz(n.visibleWrites,i)}function i6(e,t,n){var i,r;let s,o;return i=e.writeTree,r=e.treePath,s=nR(r,t),null!=(o=iz(i.visibleWrites,s))?o:n.isCompleteForChild(t)?iK(i$(i.visibleWrites,s),n.getNode().getImmediateChild(t)):null}function i3(e,t){return i2(nR(e.treePath,t),e.writeTree)}function i2(e,t){return{treePath:e,writeTree:t}}class i4{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;b("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),b(".priority"!==n,"Only non-priority child changes can be tracked.");let i=this.changeMap.get(n);if(i){let r=i.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(n,is(n,e.snapshotNode,i.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(n,ir(n,i.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(n,ii(n,e.snapshotNode));else if("child_changed"===t&&"child_changed"===r)this.changeMap.set(n,is(n,e.snapshotNode,i.oldSnap));else throw E("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}let i5=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class i8{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new ix(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return i6(this.writes_,e,t)}}getChildAfterChild(e,t,n){var i;let r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:iF(this.viewCache_),s=(i=this.writes_,function(e,t,n,i,r,s,o){let a,l=i$(e.visibleWrites,t),h=iz(l,nI());if(null!=h)a=h;else{if(null==n)return[];a=iK(l,n)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];{let e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),r=n.getNext();for(;r&&e.length<1;)0!==t(r,i)&&e.push(r),r=n.getNext();return e}}(i.writeTree,i.treePath,r,t,1,n,e));return 0===s.length?null:s[0]}}function i7(e,t,n,i,r,s){let o=t.eventCache;if(null!=i1(i,n))return t;{let a,l;if(nD(n))if(b(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let n=iF(t),r=iZ(i,n instanceof n5?n:n5.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),r,s)}else{let n=iX(i,iF(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{let h=nT(n);if(".priority"===h){b(1===nS(n),"Can't have a priority with additional path components");let r=o.getNode(),s=i0(i,n,r,l=t.serverCache.getNode());a=null!=s?e.filter.updatePriority(r,s):o.getNode()}else{let u,c=nk(n);if(o.isCompleteForChild(h)){l=t.serverCache.getNode();let e=i0(i,n,o.getNode(),l);u=null!=e?o.getNode().getImmediateChild(h).updateChild(c,e):o.getNode().getImmediateChild(h)}else u=i6(i,h,t.serverCache);a=null!=u?e.filter.updateChild(o.getNode(),h,u,c,r,s):o.getNode()}}return iO(t,a,o.isFullyInitialized()||nD(n),e.filter.filtersNodes())}}function i9(e,t,n,i,r,s,o,a){let l,h=t.serverCache,u=o?e.filter:e.filter.getIndexedFilter();if(nD(n))l=u.updateFullNode(h.getNode(),i,null);else if(u.filtersNodes()&&!h.isFiltered()){let e=h.getNode().updateChild(n,i);l=u.updateFullNode(h.getNode(),e,null)}else{let e=nT(n);if(!h.isCompleteForPath(n)&&nS(n)>1)return t;let r=nk(n),s=h.getNode().getImmediateChild(e).updateChild(r,i);l=".priority"===e?u.updatePriority(h.getNode(),s):u.updateChild(h.getNode(),e,s,r,i5,null)}let c=iL(t,l,h.isFullyInitialized()||nD(n),u.filtersNodes()),d=new i8(r,c,s);return i7(e,c,n,r,d,a)}function re(e,t,n,i,r,s,o){let a,l,h=t.eventCache,u=new i8(r,t,s);if(nD(n))l=e.filter.updateFullNode(t.eventCache.getNode(),i,o),a=iO(t,l,!0,e.filter.filtersNodes());else{let r=nT(n);if(".priority"===r)l=e.filter.updatePriority(t.eventCache.getNode(),i),a=iO(t,l,h.isFullyInitialized(),h.isFiltered());else{let s,l=nk(n),c=h.getNode().getImmediateChild(r);if(nD(l))s=i;else{let e=u.getCompleteChild(r);s=null!=e?".priority"===nP(l)&&e.getChild(nx(l)).isEmpty()?e:e.updateChild(l,i):n5.EMPTY_NODE}a=c.equals(s)?t:iO(t,e.filter.updateChild(h.getNode(),r,s,l,u,o),h.isFullyInitialized(),e.filter.filtersNodes())}}return a}function rt(e,t){return e.eventCache.isCompleteForChild(t)}function rn(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function ri(e,t,n,i,r,s,o,a){let l;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h=t;l=nD(n)?i:new iq(null).setTree(n,i);let u=t.serverCache.getNode();return l.children.inorderTraversal((n,i)=>{if(u.hasChild(n)){let l=rn(e,t.serverCache.getNode().getImmediateChild(n),i);h=i9(e,h,new nE(n),l,r,s,o,a)}}),l.children.inorderTraversal((n,i)=>{let l=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!u.hasChild(n)&&!l){let l=rn(e,t.serverCache.getNode().getImmediateChild(n),i);h=i9(e,h,new nE(n),l,r,s,o,a)}}),h}class rr{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new io(n.getIndex()),r=function(e){return e.loadsAllData()?new io(e.getIndex()):e.hasLimit()?new il(e):new ia(e)}(n);this.processor_={filter:r};const s=t.serverCache,o=t.eventCache,a=i.updateFullNode(n5.EMPTY_NODE,s.getNode(),null),l=r.updateFullNode(n5.EMPTY_NODE,o.getNode(),null),h=new ix(a,s.isFullyInitialized(),i.filtersNodes()),u=new ix(l,o.isFullyInitialized(),r.filtersNodes());this.viewCache_=iA(u,h),this.eventGenerator_=new iR(this.query_)}get query(){return this.query_}}function rs(e){return 0===e.eventRegistrations_.length}function ro(e,t,n){let i=[];if(n){b(null==t,"A cancel should cancel all event registrations.");let r=e.query._path;e.eventRegistrations_.forEach(e=>{let t=e.createCancelEvent(n,r);t&&i.push(t)})}if(t){let n=[];for(let i=0;i<e.eventRegistrations_.length;++i){let r=e.eventRegistrations_[i];if(r.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(i+1));break}}else n.push(r)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return i}function ra(e,t,n,i){var r,s;t.type===C.MERGE&&null!==t.source.queryId&&(b(iF(e.viewCache_),"We should always have a full cache before handling merges"),b(iM(e.viewCache_),"Missing event cache, even though we have a server cache"));let o=e.viewCache_,a=function(e,t,n,i,r){var s,o,a,l,h,u,c,d,p,_,f,m;let g,y,v=new i4;if(n.type===C.OVERWRITE)n.source.fromUser?g=re(e,t,n.path,n.snap,i,r,v):(b(n.source.fromServer,"Unknown source."),y=n.source.tagged||t.serverCache.isFiltered()&&!nD(n.path),g=i9(e,t,n.path,n.snap,i,r,y,v));else if(n.type===C.MERGE){let d;n.source.fromUser?(s=e,o=t,a=n.path,l=n.children,h=i,u=r,c=v,d=o,l.foreach((e,t)=>{let n=nR(a,e);rt(o,nT(n))&&(d=re(s,d,n,t,h,u,c))}),l.foreach((e,t)=>{let n=nR(a,e);rt(o,nT(n))||(d=re(s,d,n,t,h,u,c))}),g=d):(b(n.source.fromServer,"Unknown source."),y=n.source.tagged||t.serverCache.isFiltered(),g=ri(e,t,n.path,n.children,i,r,y,v))}else if(n.type===C.ACK_USER_WRITE)g=n.revert?function(e,t,n,i,r,s){let o;if(null!=i1(i,n))return t;{let a,l=new i8(i,t,r),h=t.eventCache.getNode();if(nD(n)||".priority"===nT(n)){let n;if(t.serverCache.isFullyInitialized())n=iX(i,iF(t));else{let e=t.serverCache.getNode();b(e instanceof n5,"serverChildren would be complete if leaf node"),n=iZ(i,e)}a=e.filter.updateFullNode(h,n,s)}else{let r=nT(n),u=i6(i,r,t.serverCache);null==u&&t.serverCache.isCompleteForChild(r)&&(u=h.getImmediateChild(r)),(a=null!=u?e.filter.updateChild(h,r,u,nk(n),l,s):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(h,r,n5.EMPTY_NODE,nk(n),l,s):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(o=iX(i,iF(t))).isLeafNode()&&(a=e.filter.updateFullNode(a,o,s))}return o=t.serverCache.isFullyInitialized()||null!=i1(i,nI()),iO(t,a,o,e.filter.filtersNodes())}}(e,t,n.path,i,r,v):function(e,t,n,i,r,s,o){if(null!=i1(r,n))return t;let a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=i.value)if(nD(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return i9(e,t,n,l.getNode().getChild(n),r,s,a,o);else{if(!nD(n))return t;let i=new iq(null);return l.getNode().forEachChild(nV,(e,t)=>{i=i.set(new nE(e),t)}),ri(e,t,n,i,r,s,a,o)}{let h=new iq(null);return i.foreach((e,t)=>{let i=nR(n,e);l.isCompleteForPath(i)&&(h=h.set(e,l.getNode().getChild(i)))}),ri(e,t,n,h,r,s,a,o)}}(e,t,n.path,n.affectedTree,i,r,v);else if(n.type===C.LISTEN_COMPLETE){let r;d=e,p=t,_=n.path,f=i,m=v,r=p.serverCache,g=i7(d,iL(p,r.getNode(),r.isFullyInitialized()||nD(_),r.isFiltered()),_,f,i5,m)}else throw E("Unknown operation type: "+n.type);let w=v.getChanges();return function(e,t,n){let i=t.eventCache;if(i.isFullyInitialized()){let r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=iM(e);!(n.length>0)&&e.eventCache.isFullyInitialized()&&(!r||i.getNode().equals(s))&&i.getNode().getPriority().equals(s.getPriority())||n.push(it(iM(t)))}}(t,g,w),{viewCache:g,changes:w}}(e.processor_,o,t,n,i);return r=e.processor_,b((s=a.viewCache).eventCache.getNode().isIndexed(r.filter.getIndex()),"Event snap not indexed"),b(s.serverCache.getNode().isIndexed(r.filter.getIndex()),"Server snap not indexed"),b(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,rl(e,a.changes,a.viewCache.eventCache.getNode(),null)}function rl(e,t,n,i){var r;let s,o,a=i?[i]:e.eventRegistrations_;return r=e.eventGenerator_,s=[],o=[],t.forEach(e=>{var t;"child_changed"===e.type&&r.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&o.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),iD(r,s,"child_removed",t,a,n),iD(r,s,"child_added",t,a,n),iD(r,s,"child_moved",o,a,n),iD(r,s,"child_changed",t,a,n),iD(r,s,"value",t,a,n),s}class rh{constructor(){this.views=new Map}}function ru(e,t,n,i){let r=t.source.queryId;if(null!==r){let s=e.views.get(r);return b(null!=s,"SyncTree gave us an op for an invalid query."),ra(s,t,n,i)}{let r=[];for(let s of e.views.values())r=r.concat(ra(s,t,n,i));return r}}function rc(e,t,n,i,r){let s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=iX(n,r?i:null),s=!1;return e?s=!0:(e=i instanceof n5?iZ(n,i):n5.EMPTY_NODE,s=!1),new rr(t,iA(new ix(e,s,!1),new ix(i,r,!1)))}return o}function rd(e){let t=[];for(let n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function rp(e,t){let n=null;for(let i of e.views.values())n=n||function(e,t){let n=iF(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!nD(t)&&!n.getImmediateChild(nT(t)).isEmpty())?n.getChild(t):null}(i,t);return n}function r_(e,t){if(t._queryParams.loadsAllData())return rm(e);{let n=t._queryIdentifier;return e.views.get(n)}}function rf(e){return null!=rm(e)}function rm(e){for(let t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let rg=1;class ry{constructor(e){this.listenProvider_=e,this.syncPointTree_=new iq(null),this.pendingWriteTree_={visibleWrites:iB.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function rv(e,t,n,i,r){var s,o;return(s=e.pendingWriteTree_,o=r,b(i>s.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),s.allWrites.push({path:t,snap:n,writeId:i,visible:o}),o&&(s.visibleWrites=iW(s.visibleWrites,t,n)),s.lastWriteId=i,r)?rS(e,new iP(iE(),t,n)):[]}function rC(e,t,n=!1){let i=function(e,t){for(let n=0;n<e.allWrites.length;n++){let i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(!function(e,t){var n;let i=e.allWrites.findIndex(e=>e.writeId===t);b(i>=0,"removeWrite called with nonexistent writeId.");let r=e.allWrites[i];e.allWrites.splice(i,1);let s=r.visible,o=!1,a=e.allWrites.length-1;for(;s&&a>=0;){let t=e.allWrites[a];t.visible&&(a>=i&&function(e,t){if(e.snap)return nM(e.path,t);for(let n in e.children)if(e.children.hasOwnProperty(n)&&nM(nR(e.path,n),t))return!0;return!1}(t,r.path)?s=!1:nM(r.path,t.path)&&(o=!0)),a--}return!!s&&(o?((n=e).visibleWrites=iG(n.allWrites,iQ,nI()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1):r.snap?e.visibleWrites=iH(e.visibleWrites,r.path):t2(r.children,t=>{e.visibleWrites=iH(e.visibleWrites,nR(r.path,t))}),!0)}(e.pendingWriteTree_,t))return[];{let t=new iq(null);return null!=i.snap?t=t.set(nI(),!0):t2(i.children,e=>{t=t.set(new nE(e),!0)}),rS(e,new iS(i.path,t,n))}}function rw(e,t,n){return rS(e,new iP(iI(),t,n))}function rb(e,t,n,i,r=!1){let s=t._path,o=e.syncPointTree_.get(s),a=[];if(o&&("default"===t._queryIdentifier||null!=r_(o,t))){let u=function(e,t,n,i){let r=t._queryIdentifier,s=[],o=[],a=rf(e);if("default"===r)for(let[t,r]of e.views.entries())o=o.concat(ro(r,n,i)),rs(r)&&(e.views.delete(t),r.query._queryParams.loadsAllData()||s.push(r.query));else{let t=e.views.get(r);t&&(o=o.concat(ro(t,n,i)),rs(t)&&(e.views.delete(r),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!rf(e)&&s.push(new(b(c,"Reference.ts has not been loaded"),c)(t._repo,t._path)),{removed:s,events:o}}(o,t,n,i);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));let d=u.removed;if(a=u.events,!r){let n=-1!==d.findIndex(e=>e._queryParams.loadsAllData()),r=e.syncPointTree_.findOnPath(s,(e,t)=>rf(t));if(n&&!r){let t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){let n=t.fold((e,t,n)=>{if(t&&rf(t))return[rm(t)];{let e=[];return t&&(e=rd(t)),t2(n,(t,n)=>{e=e.concat(n)}),e}});for(let t=0;t<n.length;++t){let i=n[t],r=i.query,s=rk(e,i);e.listenProvider_.startListening(rA(r),rP(e,r),s.hashFn,s.onComplete)}}}r||!(d.length>0)||i||(n?e.listenProvider_.stopListening(rA(t),null):d.forEach(t=>{let n=e.queryToTagMap.get(rN(t));e.listenProvider_.stopListening(rA(t),n)}))}var l=e,h=d;for(let e=0;e<h.length;++e){let t=h[e];if(!t._queryParams.loadsAllData()){let e=rN(t),n=l.queryToTagMap.get(e);l.queryToTagMap.delete(e),l.tagToQueryMap.delete(n)}}}return a}function rE(e,t,n,i){let r=rx(e,i);if(null==r)return[];{let i=rR(r),s=i.path,o=i.queryId,a=nA(s,t);return rD(e,s,new iP(iT(o),a,n))}}function rI(e,t,n,i=!1){var r;let s,o,a,l,h=t._path,u=null,c=!1;e.syncPointTree_.foreachOnPath(h,(e,t)=>{let n=nA(e,h);u=u||rp(t,n),c=c||rf(t)});let d=e.syncPointTree_.get(h);d?(c=c||rf(d),u=u||rp(d,nI())):(d=new rh,e.syncPointTree_=e.syncPointTree_.set(h,d)),null!=u?s=!0:(s=!1,u=n5.EMPTY_NODE,e.syncPointTree_.subtree(h).foreachChild((e,t)=>{let n=rp(t,nI());n&&(u=u.updateImmediateChild(e,n))}));let p=null!=r_(d,t);if(!p&&!t._queryParams.loadsAllData()){let n=rN(t);b(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");let i=rg++;e.queryToTagMap.set(n,i),e.tagToQueryMap.set(i,n)}let _=i2(h,e.pendingWriteTree_),f=(o=rc(r=d,t,_,u,s),r.views.has(t._queryIdentifier)||r.views.set(t._queryIdentifier,o),o.eventRegistrations_.push(n),a=o.viewCache_.eventCache,l=[],a.getNode().isLeafNode()||a.getNode().forEachChild(n0,(e,t)=>{l.push(ii(e,t))}),a.isFullyInitialized()&&l.push(it(a.getNode())),rl(o,l,a.getNode(),n));if(!p&&!c&&!i){let n=r_(d,t);f=f.concat(function(e,t,n){let i=t._path,r=rP(e,t),s=rk(e,n),o=e.listenProvider_.startListening(rA(t),r,s.hashFn,s.onComplete),a=e.syncPointTree_.subtree(i);if(r)b(!rf(a.value),"If we're adding a query, it shouldn't be shadowed");else{let t=a.fold((e,t,n)=>{if(!nD(e)&&t&&rf(t))return[rm(t).query];{let e=[];return t&&(e=e.concat(rd(t).map(e=>e.query))),t2(n,(t,n)=>{e=e.concat(n)}),e}});for(let n=0;n<t.length;++n){let i=t[n];e.listenProvider_.stopListening(rA(i),rP(e,i))}}return o}(e,t,n))}return f}function rT(e,t,n){let i=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,(e,n)=>{let i=rp(n,nA(e,t));if(i)return i});return iJ(i,t,r,n,!0)}function rS(e,t){var n;return function e(t,n,i,r){if(nD(t.path))return function e(t,n,i,r){let s=n.get(nI());null==i&&null!=s&&(i=rp(s,nI()));let o=[];return n.children.inorderTraversal((n,s)=>{let a=i?i.getImmediateChild(n):null,l=i3(r,n),h=t.operationForChild(n);h&&(o=o.concat(e(h,s,a,l)))}),s&&(o=o.concat(ru(s,t,r,i))),o}(t,n,i,r);{let s=n.get(nI());null==i&&null!=s&&(i=rp(s,nI()));let o=[],a=nT(t.path),l=t.operationForChild(a),h=n.children.get(a);if(h&&l){let t=i?i.getImmediateChild(a):null,n=i3(r,a);o=o.concat(e(l,h,t,n))}return s&&(o=o.concat(ru(s,t,r,i))),o}}(t,e.syncPointTree_,null,(n=e.pendingWriteTree_,i2(nI(),n)))}function rk(e,t){let n=t.query,i=rP(e,n);return{hashFn:()=>(t.viewCache_.serverCache.getNode()||n5.EMPTY_NODE).hash(),onComplete:t=>{var r;if("ok"===t)if(i)return function(e,t,n){let i=rx(e,n);if(!i)return[];{let n=rR(i),r=n.path,s=n.queryId,o=nA(r,t);return rD(e,r,new ik(iT(s),o))}}(e,n._path,i);else return r=n._path,rS(e,new ik(iI(),r));{let i,r,s=(i="Unknown Error","too_big"===t?i="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?i="Client doesn't have permission to access the desired data.":"unavailable"===t&&(i="The service is unavailable"),(r=Error(t+" at "+n._path.toString()+": "+i)).code=t.toUpperCase(),r);return rb(e,n,null,s)}}}}function rP(e,t){let n=rN(t);return e.queryToTagMap.get(n)}function rN(e){return e._path.toString()+"$"+e._queryIdentifier}function rx(e,t){return e.tagToQueryMap.get(t)}function rR(e){let t=e.indexOf("$");return b(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new nE(e.substr(0,t))}}function rD(e,t,n){let i=e.syncPointTree_.get(t);return b(i,"Missing sync point for query tag that we're tracking"),ru(i,n,i2(t,e.pendingWriteTree_),null)}function rA(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(b(d,"Reference.ts has not been loaded"),d)(e._repo,e._path):e}class rO{constructor(e){this.node_=e}getImmediateChild(e){return new rO(this.node_.getImmediateChild(e))}node(){return this.node_}}class rL{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=nR(this.path_,e);return new rL(this.syncTree_,t)}node(){return rT(this.syncTree_,this.path_)}}let rM=function(e,t,n){return e&&"object"==typeof e?(b(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?rF(e[".sv"],t,n):"object"==typeof e[".sv"]?rq(e[".sv"],t):void b(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},rF=function(e,t,n){if("timestamp"===e)return n.timestamp;b(!1,"Unexpected server value: "+e)},rq=function(e,t,n){e.hasOwnProperty("increment")||b(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let i=e.increment;"number"!=typeof i&&b(!1,"Unexpected increment value: "+i);let r=t.node();if(b(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;let s=r.getValue();return"number"!=typeof s?i:s+i},rB=function(e,t,n,i){return rU(t,new rL(n,e),i)},rW=function(e,t,n){return rU(e,new rO(t),n)};function rU(e,t,n){let i,r=rM(e.getPriority().val(),t.getImmediateChild(".priority"),n);if(!e.isLeafNode())return i=e,r!==e.getPriority().val()&&(i=i.updatePriority(new nZ(r))),e.forEachChild(n0,(e,r)=>{let s=rU(r,t.getImmediateChild(e),n);s!==r&&(i=i.updateImmediateChild(e,s))}),i;{let i=rM(e.getValue(),t,n);return i!==e.getValue()||r!==e.getPriority().val()?new nZ(i,n7(r)):e}}class rH{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function rj(e,t){let n=t instanceof nE?t:new nE(t),i=e,r=nT(n);for(;null!==r;){let e=eu(i.node.children,r)||{children:{},childCount:0};i=new rH(r,i,e),r=nT(n=nk(n))}return i}function rz(e){return e.node.value}function rV(e,t){e.node.value=t,function e(t){null!==t.parent&&function(t,n,i){let r=void 0===rz(i)&&!r$(i),s=eh(t.node.children,n);r&&s?(delete t.node.children[n],t.node.childCount--,e(t)):r||s||(t.node.children[n]=i.node,t.node.childCount++,e(t))}(t.parent,t.name,t)}(e)}function r$(e){return e.node.childCount>0}function rY(e,t){t2(e.node.children,(n,i)=>{t(new rH(n,e,i))})}function rK(e){return new nE(null===e.parent?e.name:rK(e.parent)+"/"+e.name)}let rQ=/[\[\].#$\/\u0000-\u001F\u007F]/,rG=/[\[\].#$\u0000-\u001F\u007F]/,rJ=function(e){return"string"==typeof e&&0!==e.length&&!rQ.test(e)},rX=function(e){return"string"==typeof e&&0!==e.length&&!rG.test(e)},rZ=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!tQ(e)||e&&"object"==typeof e&&eh(e,".sv")},r0=function(e,t,n,i){i&&void 0===t||r1(eb(e,"value"),t,n)},r1=function(e,t,n){let i=n instanceof nE?new nF(n,e):n;if(void 0===t)throw Error(e+"contains undefined "+nB(i));if("function"==typeof t)throw Error(e+"contains a function "+nB(i)+" with contents = "+t.toString());if(tQ(t))throw Error(e+"contains "+t.toString()+" "+nB(i));if("string"==typeof t&&t.length>3495253.3333333335&&eI(t)>0xa00000)throw Error(e+"contains a string greater than 10485760 utf8 bytes "+nB(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,r=!1;if(t2(t,(t,s)=>{let o;if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!rJ(t)))throw Error(e+" contains an invalid key ("+t+") "+nB(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');i.parts_.length>0&&(i.byteLength_+=1),i.parts_.push(t),i.byteLength_+=eI(t),nq(i),r1(e,s,i),o=i.parts_.pop(),i.byteLength_-=eI(o),i.parts_.length>0&&(i.byteLength_-=1)}),n&&r)throw Error(e+' contains ".value" child '+nB(i)+" in addition to actual children.")}},r6=function(e,t){let n,i;for(n=0;n<t.length;n++){let r=nN(i=t[n]);for(let t=0;t<r.length;t++)if(".priority"===r[t]&&t===r.length-1);else if(!rJ(r[t]))throw Error(e+"contains an invalid key ("+r[t]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(nO);let r=null;for(n=0;n<t.length;n++){if(i=t[n],null!==r&&nM(r,i))throw Error(e+"contains a path "+r.toString()+" that is ancestor of another path "+i.toString());r=i}},r3=function(e,t,n,i){if(i&&void 0===t)return;let r=eb(e,"values");if(!(t&&"object"==typeof t)||Array.isArray(t))throw Error(r+" must be an object containing the children to replace.");let s=[];t2(t,(e,t)=>{let i=new nE(e);if(r1(r,t,nR(n,i)),".priority"===nP(i)&&!rZ(t))throw Error(r+"contains an invalid value for '"+i.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(i)}),r6(r,s)},r2=function(e,t,n){if(!n||void 0!==t){if(tQ(t))throw Error(eb(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!rZ(t))throw Error(eb(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},r4=function(e,t,n,i){if((!i||void 0!==n)&&!rJ(n))throw Error(eb(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},r5=function(e,t,n,i){if((!i||void 0!==n)&&!rX(n))throw Error(eb(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},r8=function(e,t,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),r5(e,t,n,i)},r7=function(e,t){if(".info"===nT(t))throw Error(e+" failed = Can't modify data under /.info/")},r9=function(e,t){var n;let i=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!rJ(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==i.length&&((n=i)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),!rX(n)))throw Error(eb(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class se{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function st(e,t){let n=null;for(let i=0;i<t.length;i++){let r=t[i],s=r.getPath();null===n||nL(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(r)}n&&e.eventLists_.push(n)}function sn(e,t,n){st(e,n),sr(e,e=>nL(e,t))}function si(e,t,n){st(e,n),sr(e,e=>nM(e,t)||nM(t,e))}function sr(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){let r=e.eventLists_[i];r&&(t(r.path)?(function(e){for(let t=0;t<e.events.length;t++){let n=e.events[t];if(null!==n){e.events[t]=null;let i=n.getEventRunner();tW&&tj("event: "+n.toString()),t7(i)}}}(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}let ss="repo_interrupt";class so{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new se,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=iy(),this.transactionQueueTree_=new rH,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function sa(e){let t=e.infoData_.getNode(new nE(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function sl(e){var t;return(t=t={timestamp:sa(e)}).timestamp=t.timestamp||new Date().getTime(),t}function sh(e,t,n,i,r){e.dataUpdateCount++;let s=new nE(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(r)if(i){let t=ed(n,e=>n7(e));o=function(e,t,n,i){let r=rx(e,i);if(!r)return[];{let i=rR(r),s=i.path,o=i.queryId,a=nA(s,t),l=iq.fromObject(n);return rD(e,s,new iN(iT(o),a,l))}}(e.serverSyncTree_,s,t,r)}else{let t=n7(n);o=rE(e.serverSyncTree_,s,t,r)}else if(i){var a;let t,i=ed(n,e=>n7(e));a=e.serverSyncTree_,t=iq.fromObject(i),o=rS(a,new iN(iI(),s,t))}else{let t=n7(n);o=rw(e.serverSyncTree_,s,t)}let l=s;o.length>0&&(l=sw(e,s)),si(e.eventQueue_,l,o)}function su(e,t){var n;let i,r,s;sc(e,"connected",t),!1===t&&(sg(n=e,"onDisconnectEvents"),i=sl(n),r=iy(),iC(n.onDisconnect_,nI(),(e,t)=>{let s=rB(e,t,n.serverSyncTree_,i);iv(r,e,s)}),s=[],iC(r,nI(),(e,t)=>{s=s.concat(rw(n.serverSyncTree_,e,t));let i=sT(n,e);sw(n,i)}),n.onDisconnect_=iy(),si(n.eventQueue_,nI(),s))}function sc(e,t,n){let i=new nE("/.info/"+t),r=n7(n);e.infoData_.updateSnapshot(i,r);let s=rw(e.infoSyncTree_,i,r);si(e.eventQueue_,i,s)}function sd(e){return e.nextWriteId_++}function sp(e,t,n,i,r){sg(e,"set",{path:t.toString(),value:n,priority:i});let s=sl(e),o=n7(n,i),a=rW(o,rT(e.serverSyncTree_,t),s),l=sd(e),h=rv(e.serverSyncTree_,t,a,l,!0);st(e.eventQueue_,h),e.server_.put(t.toString(),o.val(!0),(n,i)=>{let s="ok"===n;s||tY("set at "+t+" failed: "+n);let o=rC(e.serverSyncTree_,l,!s);si(e.eventQueue_,t,o),sy(e,r,n,i)});let u=sT(e,t);sw(e,u),si(e.eventQueue_,u,[])}function s_(e,t,n,i){let r=n7(n);e.server_.onDisconnectPut(t.toString(),r.val(!0),(n,s)=>{"ok"===n&&iv(e.onDisconnect_,t,r),sy(e,i,n,s)})}function sf(e,t,n){let i;i=".info"===nT(t._path)?rb(e.infoSyncTree_,t,n):rb(e.serverSyncTree_,t,n),sn(e.eventQueue_,t._path,i)}function sm(e){e.persistentConnection_&&e.persistentConnection_.interrupt(ss)}function sg(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),tj(n,...t)}function sy(e,t,n,i){t&&t7(()=>{if("ok"===n)t(null);else{let e=(n||"error").toUpperCase(),r=e;i&&(r+=": "+i);let s=Error(r);s.code=e,t(s)}})}function sv(e,t,n){return rT(e.serverSyncTree_,t,n)||n5.EMPTY_NODE}function sC(e,t=e.transactionQueueTree_){if(t||sI(e,t),rz(t)){let n=sE(e,t);b(n.length>0,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(e,t,n){let i=sv(e,t,n.map(e=>e.currentWriteId)),r=i,s=i.hash();for(let e=0;e<n.length;e++){let i=n[e];b(0===i.status,"tryToSendTransactionQueue_: items in queue should all be run."),i.status=1,i.retryCount++;let s=nA(t,i.path);r=r.updateChild(s,i.currentOutputSnapshotRaw)}let o=r.val(!0);e.server_.put(t.toString(),o,i=>{sg(e,"transaction put response",{path:t.toString(),status:i});let r=[];if("ok"===i){let i=[];for(let t=0;t<n.length;t++)n[t].status=2,r=r.concat(rC(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&i.push(()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)),n[t].unwatcher();sI(e,rj(e.transactionQueueTree_,t)),sC(e,e.transactionQueueTree_),si(e.eventQueue_,t,r);for(let e=0;e<i.length;e++)t7(i[e])}else{if("datastale"===i)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{tY("transaction at "+t.toString()+" failed: "+i);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=i}sw(e,t)}},s)}(e,rK(t),n)}else r$(t)&&rY(t,t=>{sC(e,t)})}function sw(e,t){let n=sb(e,t),i=rK(n),r=sE(e,n);return function(e,t,n){if(0===t.length)return;let i=[],r=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){let a=t[o],l=nA(n,a.path),h=!1,u;if(b(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)h=!0,u=a.abortReason,r=r.concat(rC(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status)if(a.retryCount>=25)h=!0,u="maxretry",r=r.concat(rC(e.serverSyncTree_,a.currentWriteId,!0));else{let n=sv(e,a.path,s);a.currentInputSnapshot=n;let i=t[o].update(n.val());if(void 0!==i){r1("transaction failed: Data returned ",i,a.path);let t=n7(i);"object"==typeof i&&null!=i&&eh(i,".priority")||(t=t.updatePriority(n.getPriority()));let o=a.currentWriteId,l=rW(t,n,sl(e));a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=l,a.currentWriteId=sd(e),s.splice(s.indexOf(o),1),r=(r=r.concat(rv(e.serverSyncTree_,a.path,l,a.currentWriteId,a.applyLocally))).concat(rC(e.serverSyncTree_,o,!0))}else h=!0,u="nodata",r=r.concat(rC(e.serverSyncTree_,a.currentWriteId,!0))}si(e.eventQueue_,n,r),r=[],h&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&("nodata"===u?i.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):i.push(()=>t[o].onComplete(Error(u),!1,null))))}sI(e,e.transactionQueueTree_);for(let e=0;e<i.length;e++)t7(i[e]);sC(e,e.transactionQueueTree_)}(e,r,i),i}function sb(e,t){let n,i=e.transactionQueueTree_;for(n=nT(t);null!==n&&void 0===rz(i);)i=rj(i,n),n=nT(t=nk(t));return i}function sE(e,t){let n=[];return function e(t,n,i){let r=rz(n);if(r)for(let e=0;e<r.length;e++)i.push(r[e]);rY(n,n=>{e(t,n,i)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function sI(e,t){let n=rz(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,rV(t,n.length>0?n:void 0)}rY(t,t=>{sI(e,t)})}function sT(e,t){let n=rK(sb(e,t)),i=rj(e.transactionQueueTree_,t);return!function(e,t,n){let i=e.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,t=>{sS(e,t)}),sS(e,i),!function e(t,n,i,r){i&&!r&&n(t),rY(t,t=>{e(t,n,!0,r)}),i&&r&&n(t)}(i,t=>{sS(e,t)}),n}function sS(e,t){let n=rz(t);if(n){let i=[],r=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(b(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(b(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),r=r.concat(rC(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&i.push(n[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?rV(t,void 0):n.length=s+1,si(e.eventQueue_,rK(t),r);for(let e=0;e<i.length;e++)t7(i[e])}}let sk=function(e,t){let n=sP(e),i=n.namespace;"firebase.com"===n.domain&&t$(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||t$("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||tK();let r="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new no(n.host,n.secure,i,r,t,"",i!==n.subdomain),path:new nE(n.pathString)}},sP=function(e){let t="",n="",i="",r="",s="",o=!0,a="https",l=443;if("string"==typeof e){let h=e.indexOf("//");h>=0&&(a=e.substring(0,h-1),e=e.substring(h+2));let u=e.indexOf("/");-1===u&&(u=e.length);let c=e.indexOf("?");-1===c&&(c=e.length),t=e.substring(0,Math.min(u,c)),u<c&&(r=function(e){let t="",n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let i=n[e];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(u,c)));let d=function(e){let t={};for(let n of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===n.length)continue;let i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):tY(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,c)));(h=t.indexOf(":"))>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(h+1),10)):h=t.length;let p=t.slice(0,h);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{let e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=i}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}},sN="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",sx=(_=0,f=[],function(e){let t,n=e===_;_=e;let i=Array(8);for(t=7;t>=0;t--)i[t]=sN.charAt(e%64),e=Math.floor(e/64);b(0===e,"Cannot push at time == 0");let r=i.join("");if(n){for(t=11;t>=0&&63===f[t];t--)f[t]=0;f[t]++}else for(t=0;t<12;t++)f[t]=Math.floor(64*Math.random());for(t=0;t<12;t++)r+=sN.charAt(f[t]);return b(20===r.length,"nextPushId: Length should be 20."),r});class sR{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){let e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+es(this.snapshot.exportVal())}}class sD{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class sA{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return b(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class sO{constructor(e,t){this._repo=e,this._path=t}cancel(){var e,t,n;let i=new F;return e=this._repo,t=this._path,n=i.wrapCallback(()=>{}),e.server_.onDisconnectCancel(t.toString(),(i,r)=>{"ok"===i&&function e(t,n){if(nD(n))return t.value=null,t.children.clear(),!0;if(null!==t.value)if(t.value.isLeafNode())return!1;else{let i=t.value;return t.value=null,i.forEachChild(n0,(e,n)=>{iv(t,new nE(e),n)}),e(t,n)}if(!(t.children.size>0))return!0;{let i=nT(n);return n=nk(n),t.children.has(i)&&e(t.children.get(i),n)&&t.children.delete(i),0===t.children.size}}(e.onDisconnect_,t),sy(e,n,i,r)}),i.promise}remove(){r7("OnDisconnect.remove",this._path);let e=new F;return s_(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){r7("OnDisconnect.set",this._path),r0("OnDisconnect.set",e,this._path,!1);let t=new F;return s_(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){var n,i,r;let s;r7("OnDisconnect.setWithPriority",this._path),r0("OnDisconnect.setWithPriority",e,this._path,!1),r2("OnDisconnect.setWithPriority",t,!1);let o=new F;return n=this._repo,i=this._path,r=o.wrapCallback(()=>{}),s=n7(e,t),n.server_.onDisconnectPut(i.toString(),s.val(!0),(e,t)=>{"ok"===e&&iv(n.onDisconnect_,i,s),sy(n,r,e,t)}),o.promise}update(e){r7("OnDisconnect.update",this._path),r3("OnDisconnect.update",e,this._path,!1);let t=new F;return!function(e,t,n,i){if(ec(n)){tj("onDisconnect().update() called with empty data.  Don't do anything."),sy(e,i,"ok",void 0);return}e.server_.onDisconnectMerge(t.toString(),n,(r,s)=>{"ok"===r&&t2(n,(n,i)=>{let r=n7(i);iv(e.onDisconnect_,nR(t,n),r)}),sy(e,i,r,s)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class sL{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return nD(this._path)?null:nP(this._path)}get ref(){return new sB(this._repo,this._path)}get _queryIdentifier(){let e=t6(i_(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return i_(this._queryParams)}isEqual(e){if(!((e=eT(e))instanceof sL))return!1;let t=this._repo===e._repo,n=nL(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}function sM(e,t){if(!0===e._orderByCalled)throw Error(t+": You can't combine multiple orderBy calls.")}function sF(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===nV){let i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",r="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==tJ)throw Error(i);if("string"!=typeof t)throw Error(r)}if(e.hasEnd()){if(e.getIndexEndName()!==tX)throw Error(i);if("string"!=typeof n)throw Error(r)}}else if(e.getIndex()===n0){if(null!=t&&!rZ(t)||null!=n&&!rZ(n))throw Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(b(e.getIndex()instanceof n9||e.getIndex()===ie,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function sq(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class sB extends sL{constructor(e,t){super(e,t,new ih,!1)}get parent(){let e=nx(this._path);return null===e?null:new sB(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class sW{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new nE(e),n=sj(this.ref,e);return new sW(this._node.getChild(t),n,n0)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(t,n)=>e(new sW(n,sj(this.ref,t),n0)))}hasChild(e){let t=new nE(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function sU(e,t){return(e=eT(e))._checkNotDeleted("ref"),void 0!==t?sj(e._root,t):e._root}function sH(e,t){(e=eT(e))._checkNotDeleted("refFromURL");let n=sk(t,e._repo.repoInfo_.nodeAdmin);r9("refFromURL",n);let i=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||i.host===e._repo.repoInfo_.host||t$("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+e._repo.repoInfo_.host+")"),sU(e,n.path.toString())}function sj(e,t){return null===nT((e=eT(e))._path)?r8("child","path",t,!1):r5("child","path",t,!1),new sB(e._repo,nR(e._path,t))}function sz(e){return new sO((e=eT(e))._repo,e._path)}function sV(e,t){let n;r7("push",(e=eT(e))._path),r0("push",t,e._path,!0);let i=sx(sa(e._repo)),r=sj(e,i),s=sj(e,i);return r.then=(n=null!=t?sY(s,t).then(()=>s):Promise.resolve(s)).then.bind(n),r.catch=n.then.bind(n,void 0),r}function s$(e){return r7("remove",e._path),sY(e,null)}function sY(e,t){r7("set",(e=eT(e))._path),r0("set",t,e._path,!1);let n=new F;return sp(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}function sK(e,t){r7("setPriority",(e=eT(e))._path),r2("setPriority",t,!1);let n=new F;return sp(e._repo,nR(e._path,".priority"),t,null,n.wrapCallback(()=>{})),n.promise}function sQ(e,t,n){if(r7("setWithPriority",e._path),r0("setWithPriority",t,e._path,!1),r2("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";let i=new F;return sp(e._repo,e._path,t,n,i.wrapCallback(()=>{})),i.promise}function sG(e,t){r3("update",t,e._path,!1);let n=new F;return!function(e,t,n,i){sg(e,"update",{path:t.toString(),value:n});let r=!0,s=sl(e),o={};if(t2(n,(n,i)=>{r=!1,o[n]=rB(nR(t,n),n7(i),e.serverSyncTree_,s)}),r)tj("update() called with empty data.  Don't do anything."),sy(e,i,"ok",void 0);else{var a,l;let r,s=sd(e),h=(a=e.serverSyncTree_,l=a.pendingWriteTree_,b(s>l.lastWriteId,"Stacking an older merge on top of newer ones"),l.allWrites.push({path:t,children:o,writeId:s,visible:!0}),l.visibleWrites=iU(l.visibleWrites,t,o),l.lastWriteId=s,r=iq.fromObject(o),rS(a,new iN(iE(),t,r)));st(e.eventQueue_,h),e.server_.merge(t.toString(),n,(n,r)=>{let o="ok"===n;o||tY("update at "+t+" failed: "+n);let a=rC(e.serverSyncTree_,s,!o),l=a.length>0?sw(e,t):t;si(e.eventQueue_,l,a),sy(e,i,n,r)}),t2(n,n=>{let i=sT(e,nR(t,n));sw(e,i)}),si(e.eventQueue_,t,[])}}(e._repo,e._path,t,n.wrapCallback(()=>{})),n.promise}function sJ(e){var t,n,i,r,s;let o,a,l,h,u,c,d;e=eT(e);let p=new sX(new sA(()=>{}));return(t=e._repo,n=e,i=t.serverSyncTree_,a=(r=n)._path,l=null,i.syncPointTree_.foreachOnPath(a,(e,t)=>{let n=nA(e,a);l=l||rp(t,n)}),(h=i.syncPointTree_.get(a))?l=l||rp(h,nI()):(h=new rh,i.syncPointTree_=i.syncPointTree_.set(a,h)),c=(u=null!=l)?new ix(l,!0,!1):null,d=(s=i.pendingWriteTree_,i2(r._path,s)),null!=(o=iM(rc(h,r,d,u?c.getNode():n5.EMPTY_NODE,u).viewCache_))?Promise.resolve(o):t.server_.get(n).then(e=>{let i,r=n7(e).withIndex(n._queryParams.getIndex());if(rI(t.serverSyncTree_,n,p,!0),n._queryParams.loadsAllData())i=rw(t.serverSyncTree_,n._path,r);else{let e=rP(t.serverSyncTree_,n);i=rE(t.serverSyncTree_,n._path,r,e)}return si(t.eventQueue_,n._path,i),rb(t.serverSyncTree_,n,p,null,!0),r},e=>(sg(t,"get for query "+es(n)+" failed: "+e),Promise.reject(Error(e))))).then(t=>new sW(t,new sB(e._repo,e._path),e._queryParams.getIndex()))}class sX{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){let n=t._queryParams.getIndex();return new sR("value",this,new sW(e.snapshotNode,new sB(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new sD(this,e,t):null}matches(e){return e instanceof sX&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class sZ{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new sD(this,e,t):null}createEvent(e,t){b(null!=e.childName,"Child events should have a childName.");let n=sj(new sB(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new sR(e.type,this,new sW(e.snapshotNode,n,i),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof sZ&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function s0(e,t,n,i,r){var s;let o,a;if("object"==typeof i&&(o=void 0,r=i),"function"==typeof i&&(o=i),r&&r.onlyOnce){let t=n,i=(n,i)=>{sf(e._repo,e,h),t(n,i)};i.userCallback=n.userCallback,i.context=n.context,n=i}let l=new sA(n,o||void 0),h="value"===t?new sX(l):new sZ(t,l);return s=e._repo,a=".info"===nT(e._path)?rI(s.infoSyncTree_,e,h):rI(s.serverSyncTree_,e,h),sn(s.eventQueue_,e._path,a),()=>sf(e._repo,e,h)}function s1(e,t,n,i){return s0(e,"value",t,n,i)}function s6(e,t,n,i){return s0(e,"child_added",t,n,i)}function s3(e,t,n,i){return s0(e,"child_changed",t,n,i)}function s2(e,t,n,i){return s0(e,"child_moved",t,n,i)}function s4(e,t,n,i){return s0(e,"child_removed",t,n,i)}function s5(e,t,n){let i=null,r=n?new sA(n):null;"value"===t?i=new sX(r):t&&(i=new sZ(t,r)),sf(e._repo,e,i)}class s8{}class s7 extends s8{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){r0("endAt",this._value,e._path,!0);let t=ic(e._queryParams,this._value,this._key);if(sq(t),sF(t),e._queryParams.hasEnd())throw Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new sL(e._repo,e._path,t,e._orderByCalled)}}function s9(e,t){return r4("endAt","key",t,!0),new s7(e,t)}class oe extends s8{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){var t,n,i;let r;r0("endBefore",this._value,e._path,!1);let s=(t=e._queryParams,n=this._value,i=this._key,(r=t.index_===nV||i?ic(t,n,i):ic(t,n,tJ)).endBeforeSet_=!0,r);if(sq(s),sF(s),e._queryParams.hasEnd())throw Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new sL(e._repo,e._path,s,e._orderByCalled)}}function ot(e,t){return r4("endBefore","key",t,!0),new oe(e,t)}class on extends s8{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){r0("startAt",this._value,e._path,!0);let t=iu(e._queryParams,this._value,this._key);if(sq(t),sF(t),e._queryParams.hasStart())throw Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new sL(e._repo,e._path,t,e._orderByCalled)}}function oi(e=null,t){return r4("startAt","key",t,!0),new on(e,t)}class or extends s8{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){var t,n,i;let r;r0("startAfter",this._value,e._path,!1);let s=(t=e._queryParams,n=this._value,i=this._key,(r=t.index_===nV||i?iu(t,n,i):iu(t,n,tX)).startAfterSet_=!0,r);if(sq(s),sF(s),e._queryParams.hasStart())throw Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new sL(e._repo,e._path,s,e._orderByCalled)}}function os(e,t){return r4("startAfter","key",t,!0),new or(e,t)}class oo extends s8{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){var t,n;let i;if(e._queryParams.hasLimit())throw Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new sL(e._repo,e._path,(t=e._queryParams,n=this._limit,(i=t.copy()).limitSet_=!0,i.limit_=n,i.viewFrom_="l",i),e._orderByCalled)}}function oa(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw Error("limitToFirst: First argument must be a positive integer.");return new oo(e)}class ol extends s8{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){var t,n;let i;if(e._queryParams.hasLimit())throw Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new sL(e._repo,e._path,(t=e._queryParams,n=this._limit,(i=t.copy()).limitSet_=!0,i.limit_=n,i.viewFrom_="r",i),e._orderByCalled)}}function oh(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw Error("limitToLast: First argument must be a positive integer.");return new ol(e)}class ou extends s8{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){sM(e,"orderByChild");let t=new nE(this._path);if(nD(t))throw Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let n=new n9(t),i=id(e._queryParams,n);return sF(i),new sL(e._repo,e._path,i,!0)}}function oc(e){if("$key"===e)throw Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return r5("orderByChild","path",e,!1),new ou(e)}class od extends s8{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){sM(e,"orderByKey");let t=id(e._queryParams,nV);return sF(t),new sL(e._repo,e._path,t,!0)}}function op(){return new od}class o_ extends s8{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){sM(e,"orderByPriority");let t=id(e._queryParams,n0);return sF(t),new sL(e._repo,e._path,t,!0)}}function of(){return new o_}class om extends s8{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){sM(e,"orderByValue");let t=id(e._queryParams,ie);return sF(t),new sL(e._repo,e._path,t,!0)}}function og(){return new om}class oy extends s8{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(r0("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new s7(this._value,this._key)._apply(new on(this._value,this._key)._apply(e))}}function ov(e,t){return r4("equalTo","key",t,!0),new oy(e,t)}function oC(e,...t){let n=eT(e);for(let e of t)n=e._apply(n);return n}b(!c,"__referenceConstructor has already been defined"),c=sB,b(!d,"__referenceConstructor has already been defined"),d=sB;let ow={},ob=!1;function oE(e,t,n,i,r){var s,o,a,l;let h,u,c,d,p=i||e.options.databaseURL;void 0===p&&(e.options.projectId||t$("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),tj("Using default host for project ",e.options.projectId),p=`${e.options.projectId}-default-rtdb.firebaseio.com`);let _=sk(p,r),f=_.repoInfo;void 0!==w.default&&w.default.env&&(c=w.default.env.FIREBASE_DATABASE_EMULATOR_HOST),c?(d=!0,f=(_=sk(p=`http://${c}?ns=${f.namespace}`,r)).repoInfo):d=!_.repoInfo.secure;let m=r&&d?new nn(nn.OWNER):new nt(e.name,e.options,t);return r9("Invalid Firebase Database URL",_),nD(_.path)||t$("Database URL must point to the root of a Firebase Database (not including a child path)."),new oI((s=f,o=e,a=m,l=new ne(e,n),(h=ow[o.name])||(h={},ow[o.name]=h),(u=h[s.toURLString()])&&t$("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),u=new so(s,ob,a,l),h[s.toURLString()]=u,u),e)}class oI{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(!function(e,t,n){var i;let r;if(e.stats_=nc(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new im(e.repoInfo_,(t,n,i,r)=>{sh(e,t,n,i,r)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>su(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{es(n)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new nU(e.repoInfo_,t,(t,n,i,r)=>{sh(e,t,n,i,r)},t=>{su(e,t)},t=>{var n;n=e,t2(t,(e,t)=>{sc(n,e,t)})},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),i=e.repoInfo_,nu[r=i.toString()]||(nu[r]=(()=>new ib(e.stats_,e.server_))()),e.statsReporter_=nu[r],e.infoData_=new ig,e.infoSyncTree_=new ry({startListening:(t,n,i,r)=>{let s=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=rw(e.infoSyncTree_,t._path,o),setTimeout(()=>{r("ok")},0)),s},stopListening:()=>{}}),sc(e,"connected",!1),e.serverSyncTree_=new ry({startListening:(t,n,i,r)=>(e.server_.listen(t,i,n,(n,i)=>{let s=r(n,i);si(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new sB(this._repo,nI())),this._rootInternal}_delete(){if(null!==this._rootInternal){var e,t;let n;e=this._repo,(n=ow[t=this.app.name])&&n[e.key]===e||t$(`Database ${t}(${e.repoInfo_}) has already been deleted.`),sm(e),delete n[e.key],this._repoInternal=null,this._rootInternal=null}return Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&t$("Cannot call "+e+" on a deleted database.")}}function oT(){ny.IS_TRANSPORT_INITIALIZED&&tY("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function oS(){oT(),n_.forceDisallow()}function ok(){oT(),ng.forceDisallow(),n_.forceAllow()}function oP(e=tc(),t){let n=e7(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){let e=O("database");e&&oN(n,...e)}return n}function oN(e,t,n,i={}){var r;let s,o,a;(e=eT(e))._checkNotDeleted("useEmulator");let l=`${t}:${n}`,h=e._repoInternal;if(e._instanceStarted){if(l===e._repoInternal.repoInfo_.host&&ep(i,h.repoInfo_.emulatorOptions))return;t$("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}h.repoInfo_.nodeAdmin?(i.mockUserToken&&t$('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new nn(nn.OWNER)):i.mockUserToken&&(s=new nn("string"==typeof i.mockUserToken?i.mockUserToken:W(i.mockUserToken,e.app.options.projectId))),q(t)&&(B(t),j("Database",!0)),r=s,o=l.lastIndexOf(":"),a=q(l.substring(0,o)),h.repoInfo_=new no(l,a,h.repoInfo_.namespace,h.repoInfo_.webSocketOnly,h.repoInfo_.nodeAdmin,h.repoInfo_.persistenceKey,h.repoInfo_.includeNamespaceInQueryParams,!0,i),r&&(h.authTokenProvider_=r)}function ox(e){(e=eT(e))._checkNotDeleted("goOffline"),sm(e._repo)}function oR(e){var t;(e=eT(e))._checkNotDeleted("goOnline"),(t=e._repo).persistentConnection_&&t.persistentConnection_.resume(ss)}function oD(e,t){tH(e,t)}let oA={".sv":"timestamp"};function oO(){return oA}function oL(e){return{".sv":{increment:e}}}class oM{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function oF(e,t,n){if(r7("Reference.transaction",(e=eT(e))._path),".length"===e.key||".keys"===e.key)throw"Reference.transaction failed: "+e.key+" is a read-only object.";let i=n?.applyLocally??!0,r=new F,s=s1(e,()=>{});return!function(e,t,n,i,r,s){sg(e,"transaction on "+t);let o={path:t,update:n,onComplete:i,status:null,order:tF(),applyLocally:s,retryCount:0,unwatcher:r,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=sv(e,t,void 0);o.currentInputSnapshot=a;let l=o.update(a.val());if(void 0===l)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{let n;r1("transaction failed: Data returned ",l,o.path),o.status=0;let i=rj(e.transactionQueueTree_,t),r=rz(i)||[];r.push(o),rV(i,r),"object"==typeof l&&null!==l&&eh(l,".priority")?b(rZ(n=eu(l,".priority")),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null."):n=(rT(e.serverSyncTree_,t)||n5.EMPTY_NODE).getPriority().val();let s=sl(e),h=n7(l,n),u=rW(h,a,s);o.currentOutputSnapshotRaw=h,o.currentOutputSnapshotResolved=u,o.currentWriteId=sd(e);let c=rv(e.serverSyncTree_,t,u,o.currentWriteId,o.applyLocally);si(e.eventQueue_,t,c),sC(e,e.transactionQueueTree_)}}(e._repo,e._path,t,(t,n,i)=>{let s=null;t?r.reject(t):(s=new sW(i,new sB(e._repo,e._path),n0),r.resolve(new oM(n,s)))},s,i),r.promise}nU.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},nU.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};let oq=function(e){let t=nU.prototype.put;return nU.prototype.put=function(n,i,r,s){void 0!==s&&(s=e()),t.call(this,n,i,r,s)},function(){nU.prototype.put=t}},oB=function(e){ob=e};function oW({app:e,url:t,version:n,customAuthImpl:i,customAppCheckImpl:r,nodeAdmin:s=!1}){let o;tN=n;let a=new eN("database-standalone"),l=new eP("auth-internal",a);return r&&(o=new eP("app-check-internal",a)).setComponent(new eS("app-check-internal",()=>r,"PRIVATE")),l.setComponent(new eS("auth-internal",()=>i,"PRIVATE")),oE(e,l,o,t,s)}tN=tl,e8(new eS("database",(e,{instanceIdentifier:t})=>oE(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),t_(tk,tP,void 0),t_(tk,tP,"esm2020"),e.s(["DataSnapshot",()=>sW,"Database",()=>oI,"OnDisconnect",()=>sO,"QueryConstraint",()=>s8,"TransactionResult",()=>oM,"_QueryImpl",()=>sL,"_QueryParams",()=>ih,"_ReferenceImpl",()=>sB,"_TEST_ACCESS_forceRestClient",()=>oB,"_TEST_ACCESS_hijackHash",()=>oq,"_initStandalone",()=>oW,"_repoManagerDatabaseFromApp",()=>oE,"_setSDKVersion",()=>tx,"_validatePathString",()=>r5,"_validateWritablePath",()=>r7,"child",()=>sj,"connectDatabaseEmulator",()=>oN,"enableLogging",()=>oD,"endAt",()=>s9,"endBefore",()=>ot,"equalTo",()=>ov,"forceLongPolling",()=>ok,"forceWebSockets",()=>oS,"get",()=>sJ,"getDatabase",()=>oP,"goOffline",()=>ox,"goOnline",()=>oR,"increment",()=>oL,"limitToFirst",()=>oa,"limitToLast",()=>oh,"off",()=>s5,"onChildAdded",()=>s6,"onChildChanged",()=>s3,"onChildMoved",()=>s2,"onChildRemoved",()=>s4,"onDisconnect",()=>sz,"onValue",()=>s1,"orderByChild",()=>oc,"orderByKey",()=>op,"orderByPriority",()=>of,"orderByValue",()=>og,"push",()=>sV,"query",()=>oC,"ref",()=>sU,"refFromURL",()=>sH,"remove",()=>s$,"runTransaction",()=>oF,"serverTimestamp",()=>oO,"set",()=>sY,"setPriority",()=>sK,"setWithPriority",()=>sQ,"startAfter",()=>os,"startAt",()=>oi,"update",()=>sG],34991),e.s([],1465)}]);