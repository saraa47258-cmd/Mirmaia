(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,t,s)=>{t.exports=e.r(76562)},38036,e=>{"use strict";var t=e.i(33842);e.i(1465);var s=e.i(34991);let r="auth_session_id",a="auth_user_data",i="auth_user_type",o="auth_session",n={set(e,t,s=1){let r=new Date(Date.now()+24*s*36e5).toUTCString();document.cookie=`${e}=${encodeURIComponent(t)}; expires=${r}; path=/; SameSite=Strict`},get(e){let t=document.cookie.match(RegExp("(^| )"+e+"=([^;]+)"));return t?decodeURIComponent(t[2]):null},remove(e){document.cookie=`${e}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`}},u=async(e,t)=>e===t,l=async(e,l)=>{let d=(0,s.ref)(t.database,"restaurant-system/restaurants"),m=(await (0,s.get)(d)).val()||{},c=null;for(let t in m){let s=m[t],r=await u(l,s.password);if(s.username===e&&r){c={id:t,...s,isRestaurantAdmin:!0};break}}if(!c){let r=(0,s.ref)(t.database,`restaurant-system/workers/${t.RESTAURANT_ID}`),a=(await (0,s.get)(r)).val()||{};for(let t in a){let s=a[t],r=await u(l,s.password);if(s.username===e&&r&&!1!==s.active&&!1!==s.isActive){c={id:t,...s,isWorker:!0};break}}}if(!c)throw Error("اسم المستخدم أو كلمة المرور غير صحيحة");if(c.isWorker&&(!1===c.active||!1===c.isActive))throw Error("هذا الحساب معطل. تواصل مع المدير.");let g=c.isRestaurantAdmin?"admin":c.role||"staff",S=`${g}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,A={id:c.id,username:c.username,name:c.name||c.fullName||"مستخدم",role:g,restaurantId:t.RESTAURANT_ID,position:c.position,permissions:c.permissions};return sessionStorage.setItem(r,S),sessionStorage.setItem(i,g),sessionStorage.setItem(a,JSON.stringify(A)),n.set(o,JSON.stringify({sessionId:S,role:g,userId:A.id}),1),await (0,s.set)((0,s.ref)(t.database,`sessions/${S}`),{userId:c.id,userType:g,createdAt:Date.now(),expiresAt:Date.now()+864e5,restaurantId:t.RESTAURANT_ID}),c.isWorker&&await (0,s.update)((0,s.ref)(t.database,`restaurant-system/workers/${t.RESTAURANT_ID}/${c.id}`),{lastLoginAt:new Date().toISOString()}),A},d=async(e,l)=>{let d=(0,s.ref)(t.database,`restaurant-system/workers/${t.RESTAURANT_ID}`),m=(await (0,s.get)(d)).val()||{},c=null,g="";for(let t in m){let s=m[t],r=await u(l,s.password);if(s.username===e&&r){c={id:t,...s},g=t;break}}if(!c)throw Error("اسم المستخدم أو كلمة المرور غير صحيحة");if(!1===c.active||!1===c.isActive)throw Error("هذا الحساب معطل. تواصل مع المدير.");let S=c.role||"staff",A=`${S}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,h={id:g,username:c.username,name:c.name||c.fullName||"موظف",role:S,restaurantId:t.RESTAURANT_ID,position:c.position,permissions:c.permissions,detailedPermissions:c.detailedPermissions};return sessionStorage.setItem(r,A),sessionStorage.setItem(i,S),sessionStorage.setItem(a,JSON.stringify(h)),n.set(o,JSON.stringify({sessionId:A,role:S,userId:h.id}),.5),await (0,s.set)((0,s.ref)(t.database,`sessions/${A}`),{userId:g,userType:S,createdAt:Date.now(),expiresAt:Date.now()+432e5,restaurantId:t.RESTAURANT_ID}),await (0,s.update)((0,s.ref)(t.database,`restaurant-system/workers/${t.RESTAURANT_ID}/${g}`),{lastLoginAt:new Date().toISOString()}),h},m=async()=>{let e=sessionStorage.getItem(r);e&&await (0,s.remove)((0,s.ref)(t.database,`sessions/${e}`)),sessionStorage.removeItem(r),sessionStorage.removeItem(a),sessionStorage.removeItem(i),n.remove(o)},c=async()=>{let e=sessionStorage.getItem(r);if(!e&&!n.get(o))return{isAuthenticated:!1};let i=e||(()=>{try{let e=n.get(o);return e?JSON.parse(e).sessionId:null}catch{return null}})();if(!i)return{isAuthenticated:!1};let u=(0,s.ref)(t.database,`sessions/${i}`),l=(await (0,s.get)(u)).val();if(!l)return sessionStorage.clear(),n.remove(o),{isAuthenticated:!1};if(l.expiresAt&&Date.now()>l.expiresAt)return await (0,s.remove)(u),sessionStorage.clear(),n.remove(o),{isAuthenticated:!1};let d=sessionStorage.getItem(a);if(d)try{let e=JSON.parse(d);return{isAuthenticated:!0,user:e}}catch(e){}return{isAuthenticated:!1}};e.s(["checkAuth",0,c,"getCurrentUser",0,()=>{let e=sessionStorage.getItem(a);if(!e&&(e=localStorage.getItem(a))){sessionStorage.setItem(a,e);let t=localStorage.getItem(i),s=localStorage.getItem(r);t&&sessionStorage.setItem(i,t),s&&sessionStorage.setItem(r,s)}if(e)try{return JSON.parse(e)}catch(e){}return null},"loginAdmin",0,l,"loginEmployee",0,d,"logout",0,m])},13056,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(18566),a=e.i(38036);let i=(0,s.createContext)(void 0);function o({children:e}){let[o,n]=(0,s.useState)(null),[u,l]=(0,s.useState)(!0),d=(0,r.useRouter)();(0,s.useEffect)(()=>{(async()=>{try{let{isAuthenticated:e,user:t}=await (0,a.checkAuth)();e&&t?n(t):n(null)}catch(e){console.error("Auth check error:",e),n(null)}finally{l(!1)}})()},[]);let m=async(e,t)=>{try{let s=await (0,a.loginAdmin)(e,t);n(s),d.push("/admin")}catch(e){throw e}},c=async()=>{try{await (0,a.logout)(),n(null),d.push("/login")}catch(e){console.error("Logout error:",e)}};return(0,t.jsx)(i.Provider,{value:{user:o,loading:u,login:m,logout:c},children:e})}function n(){let e=(0,s.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}e.s(["AuthProvider",()=>o,"useAuth",()=>n])}]);