<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mirmaia | Ø§Ù„ÙƒØ§Ø´ÙŠØ±</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .pos-layout {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 20px;
        }
        
        /* ===== Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ===== */
        .new-orders-badge {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 5px 25px rgba(239, 68, 68, 0.5);
            z-index: 9999;
            display: none !important;
            animation: pulse 1s infinite;
        }
        
        .new-orders-badge.show {
            display: none !important;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        .orders-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .orders-modal.show {
            display: flex;
        }
        
        .orders-modal-content {
            background: var(--card-bg);
            border-radius: 20px;
            width: 100%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            border: 1px solid var(--border);
        }
        
        .orders-modal-header {
            padding: 20px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .orders-modal-header h3 {
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .orders-modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .pending-order-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .pending-order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }
        
        .pending-order-id {
            font-weight: 700;
            color: var(--gold);
            font-size: 1.1rem;
        }
        
        .pending-order-table {
            background: var(--primary);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .pending-order-items {
            margin-bottom: 15px;
        }
        
        .pending-order-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed var(--border);
        }
        
        .pending-order-item:last-child {
            border-bottom: none;
        }
        
        .pending-order-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: 700;
            padding-top: 10px;
            border-top: 2px solid var(--border);
        }
        
        .pending-order-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .pending-order-actions button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-family: inherit;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-accept {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .btn-preparing {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        
        .btn-complete {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }
        
        /* ===== Ù‚Ø³Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø© ===== */
        .open-tables-section, .open-rooms-section {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .open-tables-header {
            padding: 15px 20px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .open-rooms-header {
            padding: 15px 20px;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .open-tables-header h3, .open-rooms-header h3 {
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .open-tables-grid, .open-rooms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px;
        }
        
        /* Room Card Styling */
        .room-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 15px;
            padding: 15px;
            transition: all 0.3s ease;
        }
        
        .room-card.occupied {
            border-color: #8b5cf6;
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.2);
        }
        
        .room-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .room-number {
            font-size: 1.1rem;
            font-weight: 700;
            color: #8b5cf6;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .room-status {
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
        }
        
        .room-info {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }
        
        .room-total {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--gold);
            margin-bottom: 12px;
        }
        
        .room-actions {
            display: flex;
            gap: 8px;
        }
        
        .room-actions button {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }
        
        .room-actions .view-btn {
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
        }
        
        .room-actions .pay-btn {
            background: linear-gradient(135deg, var(--gold), #b8860b);
            color: #000;
        }
        
        .table-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .table-card:hover {
            border-color: var(--gold);
            transform: translateY(-3px);
        }
        
        .table-card.occupied {
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }
        
        .table-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .table-number {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--gold);
        }
        
        .table-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .table-status.occupied {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }
        
        .table-orders-count {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .table-total {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--success);
        }
        
        .table-card-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }
        
        .table-card-actions button {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-view-orders {
            background: var(--primary);
            color: white;
        }
        
        .btn-close-table {
            background: var(--success);
            color: white;
        }

        .pos-panel {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
        }

        .pos-panel-header {
            padding: 18px 20px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pos-panel-header h3 {
            font-size: 1.1rem;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .pos-panel-body {
            padding: 18px 20px;
        }

        .pos-products {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 15px;
        }

        .pos-product {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 14px;
            display: flex;
            gap: 12px;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .pos-product:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
        }

        .pos-product .icon {
            width: 46px;
            height: 46px;
            border-radius: 14px;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .pos-product .info { flex: 1; }
        .pos-product .name { font-weight: 800; }
        .pos-product .price { color: var(--text-secondary); font-size: 0.9rem; }

        .receipt {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .receipt-items {
            flex: 1;
            overflow-y: auto;
            padding: 16px 20px;
        }

        .receipt-item {
            display: flex;
            gap: 10px;
            align-items: center;
            padding: 12px;
            background: var(--bg);
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .receipt-item .meta { flex: 1; }
        .receipt-item .meta .n { font-weight: 800; }
        .receipt-item .meta .p { color: var(--text-secondary); font-size: 0.85rem; }

        .qty {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .qty button {
            width: 30px;
            height: 30px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--card-bg);
            color: var(--text);
            cursor: pointer;
        }

        .receipt-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--border);
            background: var(--bg-secondary);
        }

        .totals {
            display: flex;
            justify-content: space-between;
            font-weight: 900;
            margin-bottom: 12px;
            font-size: 1.15rem;
        }

        .pay-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .pay-grid button { width: 100%; justify-content: center; }

        .discount-btn {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .discount-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        @media (max-width: 1100px) {
            .pos-layout { grid-template-columns: 1fr; }
        }

        /* ===== Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠ ===== */
        .daily-closing-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .daily-closing-modal.show {
            display: flex;
        }

        .daily-closing-content {
            background: var(--card-bg);
            border-radius: 24px;
            width: 100%;
            max-width: 700px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border);
        }

        .daily-closing-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .daily-closing-header h2 {
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .daily-closing-header .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .daily-closing-header .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .daily-closing-body {
            padding: 25px;
            overflow-y: auto;
            flex: 1;
        }

        .closing-date-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 15px;
            background: var(--bg);
            border-radius: 12px;
            margin-bottom: 25px;
            font-size: 1.1rem;
            color: var(--text);
        }

        .closing-date-info i {
            color: #f59e0b;
            font-size: 1.3rem;
        }

        .closing-section {
            margin-bottom: 25px;
        }

        .closing-section h3 {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .closing-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-card {
            background: var(--bg);
            border-radius: 16px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid var(--border);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
        }

        .stat-info {
            display: flex;
            flex-direction: column;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .stat-value {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--text);
        }

        .closing-details {
            background: var(--bg);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid var(--border);
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .pending-badge {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 700;
        }

        .cash-count-section {
            background: var(--bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
        }

        .cash-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .cash-input-group label {
            flex: 1;
            color: var(--text-secondary);
        }

        .cash-input-group input {
            width: 150px;
            padding: 12px 15px;
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: 1.1rem;
            font-weight: 700;
            text-align: center;
            font-family: inherit;
        }

        .cash-input-group input:focus {
            outline: none;
            border-color: #f59e0b;
        }

        .currency-label {
            color: var(--text-secondary);
            font-weight: 600;
        }

        .cash-difference {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .difference-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }

        .difference-value {
            font-weight: 800;
            font-size: 1.1rem;
        }

        .difference-value.positive {
            color: #10b981;
        }

        .difference-value.negative {
            color: #ef4444;
        }

        .difference-value.zero {
            color: #10b981;
        }

        .closing-section textarea {
            width: 100%;
            padding: 15px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-family: inherit;
            font-size: 0.95rem;
            resize: vertical;
            min-height: 80px;
        }

        .closing-section textarea:focus {
            outline: none;
            border-color: #f59e0b;
        }

        .daily-closing-footer {
            display: flex;
            gap: 10px;
            padding: 20px 25px;
            background: var(--bg);
            border-top: 1px solid var(--border);
        }

        .daily-closing-footer button {
            flex: 1;
            padding: 14px 20px;
            border-radius: 12px;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-cancel {
            background: var(--card-bg);
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }

        .btn-cancel:hover {
            background: var(--border);
        }

        .btn-print {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #3b82f6;
        }

        .btn-print:hover {
            background: rgba(59, 130, 246, 0.2);
        }

        .btn-confirm {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            color: white;
        }

        .btn-confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(16, 185, 129, 0.4);
        }

        @media (max-width: 600px) {
            .closing-stats {
                grid-template-columns: 1fr;
            }
            .daily-closing-footer {
                flex-direction: column;
            }
        }
        
        /* Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© */
        #incoming-orders-panel {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
    <div class="new-orders-badge" id="new-orders-badge" onclick="openPendingOrders()">
        <i class="fas fa-bell"></i>
        <span>Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©: <strong id="pending-count">0</strong></span>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© -->
    <div class="orders-modal" id="orders-modal">
        <div class="orders-modal-content">
            <div class="orders-modal-header">
                <h3><i class="fas fa-clipboard-list"></i> Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h3>
                <button onclick="closePendingOrders()" style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">&times;</button>
            </div>
            <div class="orders-modal-body" id="pending-orders-list">
                <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>
        </div>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø´ÙŠØ´Ø©/Ø§Ù„Ø­Ø¬Ù… -->
    <div class="orders-modal" id="product-options-modal" onclick="if(event.target===this)closeProductModal()">
        <div class="orders-modal-content" style="max-width: 450px;">
            <div class="orders-modal-header" style="background: linear-gradient(135deg, #6366f1, #4f46e5);">
                <h3 id="product-modal-title"><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</h3>
                <button onclick="closeProductModal()" style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">&times;</button>
            </div>
            <div class="orders-modal-body" id="product-modal-body" style="padding: 20px;">
                <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù†Ø§ÙØ°Ø© ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
        </div>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠ -->
    <div class="daily-closing-modal" id="daily-closing-modal">
        <div class="daily-closing-content">
            <div class="daily-closing-header">
                <h2><i class="fas fa-cash-register"></i> Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h2>
                <button onclick="closeDailyClosing()" class="close-btn">&times;</button>
            </div>
            <div class="daily-closing-body">
                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙŠÙˆÙ… -->
                <div class="closing-date-info">
                    <i class="fas fa-calendar-day"></i>
                    <span id="closing-date"></span>
                    <span id="closing-time"></span>
                </div>
                
                <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª -->
                <div class="closing-section">
                    <h3><i class="fas fa-chart-line"></i> Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
                    <div class="closing-stats">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: rgba(16, 185, 129, 0.1); color: #10b981;">
                                <i class="fas fa-receipt"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
                                <span class="stat-value" id="closing-orders-count">0</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: rgba(139, 92, 246, 0.1); color: #8b5cf6;">
                                <i class="fas fa-coins"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</span>
                                <span class="stat-value" id="closing-total-sales">0.000</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: rgba(245, 158, 11, 0.1); color: #f59e0b;">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-label">Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ù†Ù‚Ø¯Ø§Ù‹</span>
                                <span class="stat-value" id="closing-cash-total">0.000</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: rgba(59, 130, 246, 0.1); color: #3b82f6;">
                                <i class="fas fa-credit-card"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-label">Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ø¨Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</span>
                                <span class="stat-value" id="closing-card-total">0.000</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© -->
                <div class="closing-section">
                    <h3><i class="fas fa-info-circle"></i> ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©</h3>
                    <div class="closing-details">
                        <div class="detail-row">
                            <span>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© (ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©)</span>
                            <span id="closing-pending-count" class="pending-badge">0</span>
                        </div>
                        <div class="detail-row">
                            <span>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</span>
                            <span id="closing-pending-total" style="color: #f59e0b;">0.000 Ø±.Ø¹</span>
                        </div>
                        <div class="detail-row">
                            <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª</span>
                            <span id="closing-discounts" style="color: #ef4444;">0.000 Ø±.Ø¹</span>
                        </div>
                    </div>
                </div>

                <!-- Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†Ù‚Ø¯ Ø§Ù„ÙØ¹Ù„ÙŠ -->
                <div class="closing-section">
                    <h3><i class="fas fa-hand-holding-usd"></i> Ø¬Ø±Ø¯ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</h3>
                    <div class="cash-count-section">
                        <div class="cash-input-group">
                            <label>Ø§Ù„Ù†Ù‚Ø¯ Ø§Ù„ÙØ¹Ù„ÙŠ ÙÙŠ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</label>
                            <input type="number" step="0.001" id="actual-cash" placeholder="0.000" oninput="calculateDifference()">
                            <span class="currency-label">Ø±.Ø¹</span>
                        </div>
                        <div class="cash-difference" id="cash-difference-section" style="display: none;">
                            <div class="difference-row">
                                <span>Ø§Ù„Ù†Ù‚Ø¯ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:</span>
                                <span id="expected-cash">0.000 Ø±.Ø¹</span>
                            </div>
                            <div class="difference-row">
                                <span>Ø§Ù„ÙØ±Ù‚:</span>
                                <span id="cash-difference" class="difference-value">0.000 Ø±.Ø¹</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
                <div class="closing-section">
                    <h3><i class="fas fa-sticky-note"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</h3>
                    <textarea id="closing-notes" placeholder="Ø£Ø¶Ù Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ù† Ø§Ù„ÙŠÙˆÙ…..."></textarea>
                </div>
            </div>
            <div class="daily-closing-footer">
                <button class="btn-cancel" onclick="closeDailyClosing()">
                    <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                </button>
                <button class="btn-print" onclick="printDailyReport()">
                    <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                </button>
                <button class="btn-confirm" onclick="confirmDailyClosing()">
                    <i class="fas fa-check-circle"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
                </button>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar"></aside>

    <main class="main-content">
        <header class="header">
            <div class="header-title">
                <h2>ğŸ’° Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø´ÙŠØ±</h2>
                <p>Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ§Ù„ÙÙˆØ§ØªÙŠØ±</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="document.getElementById('pos-barcode').focus()">
                    <i class="fas fa-barcode"></i>
                    Ù…Ø³Ø­ Ø¨Ø§Ø±ÙƒÙˆØ¯
                </button>
                <input id="pos-barcode" class="barcode-input" placeholder="Ø£Ø¯Ø®Ù„/Ø§Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø«Ù… Enter" style="max-width: 340px;">
                <button class="btn" onclick="openDailyClosing()" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border: none; margin-right: 10px;">
                    <i class="fas fa-cash-register"></i>
                    Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠ
                </button>
                <button class="btn btn-danger" onclick="logout()" style="background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.2); margin-right: 10px;">
                    <i class="fas fa-sign-out-alt"></i>
                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                </button>
            </div>
        </header>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø© -->
        <div class="open-tables-section" id="open-tables-section">
            <div class="open-tables-header">
                <h3><i class="fas fa-chair"></i> Ø§Ù„Ø·Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø©</h3>
                <span id="open-tables-count">0 Ø·Ø§ÙˆÙ„Ø©</span>
            </div>
            <div class="open-tables-grid" id="open-tables-grid">
                <!-- Ø§Ù„Ø·Ø§ÙˆÙ„Ø§Øª ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                <div style="grid-column: 1/-1; text-align: center; padding: 30px; color: var(--text-secondary);">
                    <i class="fas fa-check-circle" style="font-size: 2rem; color: var(--success); margin-bottom: 10px;"></i>
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ø§ÙˆÙ„Ø§Øª Ù…ÙØªÙˆØ­Ø©</p>
                </div>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„ØºØ±Ù Ø§Ù„Ù…ÙØªÙˆØ­Ø© -->
        <div class="open-rooms-section" id="open-rooms-section">
            <div class="open-rooms-header">
                <h3><i class="fas fa-door-open"></i> Ø§Ù„ØºØ±Ù Ø§Ù„Ù…ÙØªÙˆØ­Ø©</h3>
                <span id="open-rooms-count">0 ØºØ±ÙØ©</span>
            </div>
            <div class="open-rooms-grid" id="open-rooms-grid">
                <!-- Ø§Ù„ØºØ±Ù ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                <div style="grid-column: 1/-1; text-align: center; padding: 30px; color: var(--text-secondary);">
                    <i class="fas fa-check-circle" style="font-size: 2rem; color: var(--success); margin-bottom: 10px;"></i>
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØºØ±Ù Ù…ÙØªÙˆØ­Ø©</p>
                </div>
            </div>
        </div>

        <!-- Incoming Orders Panel -->
        <div id="incoming-orders-panel" class="orders-panel" style="display: none !important; margin-bottom: 20px; background: var(--card-bg); border: 1px solid var(--border); border-radius: 20px; overflow: hidden;">
            <div class="pos-panel-header" style="background: rgba(239, 68, 68, 0.1); border-bottom: 1px solid var(--danger);">
                <h3 style="color: var(--danger);"><i class="fas fa-bell"></i> Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <span id="orders-count" class="badge" style="background: var(--danger); color: white; padding: 2px 8px; border-radius: 10px;">0</span>
            </div>
            <div class="pos-panel-body" id="incoming-orders-list" style="max-height: 450px; overflow-y: auto; padding: 5px;">
                <!-- Orders will be injected here -->
            </div>
        </div>

        <div class="pos-layout">
            <!-- Products -->
            <section class="pos-panel">
                <div class="pos-panel-header">
                    <h3><i class="fas fa-mug-hot" style="color: var(--primary);"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">Ø§Ù†Ù‚Ø± Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</div>
                </div>
                <div class="pos-panel-body">
                    <div class="pos-products" id="pos-products"></div>
                </div>
            </section>

            <!-- Receipt -->
            <section class="pos-panel receipt">
                <div class="pos-panel-header">
                    <h3><i class="fas fa-receipt" style="color: var(--gold);"></i> Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h3>
                    <button class="btn btn-secondary" onclick="clearCart()">
                        <i class="fas fa-trash"></i>
                        ØªÙØ±ÙŠØº
                    </button>
                </div>

                <div class="receipt-items" id="receipt-items"></div>

                <div class="receipt-footer">
                    <!-- Discount Section -->
                    <div class="discount-section" id="discount-section" style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--border);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="font-weight: 600; color: var(--text-secondary);">
                                <i class="fas fa-tag"></i> Ø§Ù„ØªØ®ÙÙŠØ¶
                            </span>
                            <button class="btn btn-secondary" onclick="toggleDiscount()" style="padding: 6px 12px; font-size: 0.85rem;">
                                <i class="fas fa-percent"></i> Ø¥Ø¶Ø§ÙØ©
                            </button>
                        </div>
                        <div id="discount-options" style="display: none;">
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 10px;">
                                <button class="discount-btn" onclick="applyDiscount(5)">5%</button>
                                <button class="discount-btn" onclick="applyDiscount(10)">10%</button>
                                <button class="discount-btn" onclick="applyDiscount(15)">15%</button>
                                <button class="discount-btn" onclick="applyDiscount(20)">20%</button>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <input type="number" id="custom-discount" placeholder="Ù…Ø®ØµØµ %" min="0" max="100" 
                                       style="flex: 1; padding: 8px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text); color: var(--text);"
                                       onkeypress="if(event.key==='Enter') applyCustomDiscount()">
                                <button class="btn btn-primary" onclick="applyCustomDiscount()" style="padding: 8px 16px;">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="btn btn-danger" onclick="removeDiscount()" style="padding: 8px 16px;">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <div id="discount-display" style="display: none; margin-top: 10px; padding: 10px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.3);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: var(--success); font-weight: 600;">
                                    <i class="fas fa-tag"></i> ØªØ®ÙÙŠØ¶: <span id="discount-percent">0</span>%
                                </span>
                                <span style="color: var(--success); font-weight: 700;">
                                    -<span id="discount-amount">0.000</span> Ø±.Ø¹
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--border);">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem; color: var(--text-secondary);">
                            <i class="fas fa-chair"></i> Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                        </label>
                        <input type="text" id="cashier-table-number" placeholder="Ù…Ø«Ø§Ù„: 1ØŒ 2ØŒ Ø·Ø§ÙˆÙ„Ø© 5" 
                               style="width: 100%; padding: 10px; border-radius: 8px; border: 2px solid var(--border); background: var(--bg); color: var(--text); font-family: inherit;">
                    </div>
                    
                    <div class="totals">
                        <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ</span>
                        <span id="receipt-subtotal">0 Ø±.Ø¹</span>
                    </div>
                    <div class="totals" style="font-size: 1.3rem; color: var(--primary); margin-top: 5px;">
                        <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
                        <span id="receipt-total">0 Ø±.Ø¹</span>
                    </div>
                    <div class="pay-grid">
                        <button class="btn btn-success" onclick="pay('cash')"><i class="fas fa-money-bill"></i> Ù†Ù‚Ø¯Ø§Ù‹</button>
                        <button class="btn btn-primary" onclick="pay('card')"><i class="fas fa-credit-card"></i> Ø¨Ø·Ø§Ù‚Ø©</button>
                    </div>
                    <button class="btn btn-later" onclick="payLater()" style="width: 100%; margin-top: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 14px; font-size: 1.1rem; border-radius: 12px; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); transition: all 0.3s ease;">
                        <i class="fas fa-clock"></i> 
                        <span>Ø§Ù„Ø¯ÙØ¹ Ù„Ø§Ø­Ù‚Ø§Ù‹</span>
                        <small style="opacity: 0.8; font-size: 0.75rem;">(Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙƒÙ„)</small>
                    </button>
                </div>
            </section>
        </div>
    </main>

    <div class="toast-container"></div>

    <!-- Firebase & Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="js/common.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/sidebar.js?v=1.1"></script>

    <script src="js/app.js"></script>
    <script src="js/precision-calc.js"></script>
    <script>
        const RESTAURANT_ID = 'mirmaia-1';
        const MENU_PATH = `restaurant-system/restaurants/${RESTAURANT_ID}/menu`;
        const ORDERS_PATH = `restaurant-system/restaurants/${RESTAURANT_ID}/orders`;
        const TABLES_PATH = `restaurant-system/restaurants/${RESTAURANT_ID}/tables`;
        const CATEGORIES_PATH = `restaurant-system/restaurants/${RESTAURANT_ID}/categories`;
        const SHISHA_TYPES_PATH = `restaurant-system/restaurants/${RESTAURANT_ID}/shisha-types`;
        
        let globalShishaTypes = {};
        
        let categories = [];
        
        // Update table status
        function updateTableStatus(tableId, status) {
            if (!tableId) return;
            const tableRef = firebase.database().ref(`${TABLES_PATH}/${tableId}`);
            tableRef.update({
                status: status,
                updatedAt: firebase.database.ServerValue.TIMESTAMP
            }).catch(err => console.error('Error updating table status:', err));
        }
        let menuItems = [];
        let incomingOrders = [];

        // Initialize Firebase
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof firebase !== 'undefined' && firebase.apps.length > 0) {
                initFirebaseListeners();
                initOrdersListener();
            } else {
                console.error('Firebase not initialized');
                // Fallback to local data if needed
                renderProducts();
            }
        });

        function initOrdersListener() {
            const ordersRef = firebase.database().ref(ORDERS_PATH);
            const isWorker = localStorage.getItem('worker_logged_in') === 'true';
            
            ordersRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    // Filter for new/pending orders - Ø§Ù„Ø¹Ø§Ù…Ù„ Ù„Ø§ ÙŠØ±Ù‰ Ø§Ù„Ù…Ù„ØºÙŠØ©
                    incomingOrders = Object.entries(data)
                        .map(([key, value]) => ({ id: key, ...value }))
                        .filter(order => {
                            // Ø§Ù„Ø¹Ø§Ù…Ù„: ÙÙ‚Ø· Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„Ù…Ø¹Ù„Ù‚Ø©
                            if (isWorker) {
                                return order.status === 'new' || order.status === 'pending';
                            }
                            // Ø§Ù„Ø£Ø¯Ù…Ù†: Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„Ù…Ø¹Ù„Ù‚Ø© ÙˆÙ‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±
                            return order.status === 'new' || order.status === 'pending' || order.status === 'processing' || order.status === 'preparing';
                        })
                        .filter(order => order.status !== 'cancelled') // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ù„ØºÙŠØ© Ø¯Ø§Ø¦Ù…Ø§Ù‹
                        .sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
                    
                    // Update table statuses based on active orders
                    incomingOrders.forEach(order => {
                        if (order.tableNumber && order.status !== 'paid' && order.status !== 'completed') {
                            const tableId = order.tableId || (order.tableNumber.toString().match(/(\d+)/)?.[1] || order.tableNumber.toString());
                            if (tableId) {
                                updateTableStatus(tableId, 'occupied');
                            }
                        }
                    });
                    
                    renderIncomingOrders();
                } else {
                    incomingOrders = [];
                    renderIncomingOrders();
                }
            });
        }

        function renderIncomingOrders() {
            const panel = document.getElementById('incoming-orders-panel');
            const list = document.getElementById('incoming-orders-list');
            const countBadge = document.getElementById('orders-count');
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø³Ù… Ø¯Ø§Ø¦Ù…Ø§Ù‹
            panel.style.display = 'none';
            return;
            
            if (incomingOrders.length === 0) {
                panel.style.display = 'none';
                return;
            }
            
            panel.style.display = 'block';
            countBadge.textContent = incomingOrders.length;

            list.innerHTML = `<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; padding: 10px;">` + 
            incomingOrders.map(order => {
                // ØªØ­Ø¯ÙŠØ¯ Ù…ØµØ¯Ø± Ø§Ù„Ø·Ù„Ø¨ ÙˆÙ„ÙˆÙ†Ù‡
                let sourceColor = '#10B981';
                let sourceIcon = 'ğŸ’³';
                let sourceText = 'ÙƒØ§Ø´ÙŠØ±';
                let borderColor = 'var(--border)';
                
                if (order.source === 'worker-app' || order.source === 'staff-menu') {
                    sourceColor = '#8B5CF6';
                    sourceIcon = 'ğŸ‘¨â€ğŸ’¼';
                    sourceText = order.workerName || 'Ù…ÙˆØ¸Ù';
                    borderColor = '#8B5CF6';
                } else if (order.source === 'menu') {
                    sourceColor = '#F59E0B';
                    sourceIcon = 'ğŸ“±';
                    sourceText = 'Ù…Ù†ÙŠÙˆ QR';
                    borderColor = '#F59E0B';
                }
                
                const location = order.customerName || order.tableNumber || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const orderTime = order.createdAt ? new Date(order.createdAt).toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' }) : '';
                const itemsPreview = order.items ? order.items.slice(0, 3).map(i => `${i.quantity}Ã— ${i.name}`).join(' â€¢ ') : '';
                const moreItems = order.items && order.items.length > 3 ? ` (+${order.items.length - 3})` : '';
                
                return `
                <div style="background: linear-gradient(135deg, var(--card-bg), var(--bg-secondary)); border: 2px solid ${borderColor}; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                    <!-- Header -->
                    <div style="background: ${sourceColor}; padding: 12px 15px; display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 10px; color: white;">
                            <span style="font-size: 1.3rem;">${sourceIcon}</span>
                            <div>
                                <div style="font-weight: 800; font-size: 1rem;">${sourceText}</div>
                                <div style="font-size: 0.75rem; opacity: 0.9;">${orderTime}</div>
                            </div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 20px; color: white; font-weight: 700;">
                            #${order.id.slice(-4).toUpperCase()}
                        </div>
                    </div>
                    
                    <!-- Body -->
                    <div style="padding: 15px;">
                        <!-- Location -->
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px; padding: 10px; background: var(--bg); border-radius: 10px;">
                            <span style="font-size: 1.5rem;">${order.locationType === 'room' ? 'ğŸšª' : 'ğŸª‘'}</span>
                            <div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">Ø§Ù„Ù…ÙˆÙ‚Ø¹</div>
                                <div style="font-weight: 800; color: var(--gold);">${location}</div>
                            </div>
                        </div>
                        
                        <!-- Items Preview -->
                        <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 12px; line-height: 1.6;">
                            ğŸ“¦ ${itemsPreview}${moreItems}
                        </div>
                        
                        <!-- Total -->
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: linear-gradient(135deg, var(--gold), #d97706); border-radius: 10px; color: #000;">
                            <span style="font-weight: 600;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
                            <span style="font-size: 1.2rem; font-weight: 900;">${parseFloat(order.total || 0).toFixed(3)} Ø±.Ø¹</span>
                        </div>
                        
                        <!-- Action Button -->
                        <button onclick="loadOrderToPOS('${order.id}')" style="width: 100%; margin-top: 12px; padding: 12px; background: linear-gradient(135deg, #10b981, #059669); border: none; border-radius: 10px; color: white; font-family: inherit; font-size: 0.95rem; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
                            <i class="fas fa-cash-register"></i> Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨
                        </button>
                    </div>
                </div>
            `}).join('') + '</div>';
        }

        function loadOrderToPOS(orderId) {
            const order = incomingOrders.find(o => o.id === orderId);
            if (!order) return;
            
            if (BonApp.state.cart.length > 0) {
                if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø·Ù„Ø¨ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ')) return;
            }
            
            // Load items to cart
            BonApp.state.cart = order.items.map(item => ({
                ...item,
                price: parseFloat(item.price) // Ensure price is number
            }));
            
            renderReceipt();
            BonApp.saveData();
            
            // Update order status to 'processing'
            firebase.database().ref(ORDERS_PATH + '/' + orderId).update({
                status: 'processing'
            });
            
            // Scroll to receipt
            document.querySelector('.receipt').scrollIntoView({ behavior: 'smooth' });
        }

        // Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù†ØªØ¬ Ø´ÙŠØ´Ø©
        function isShishaProduct(item, cats) {
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ÙØ¦Ø© Ø§Ù„Ø´ÙŠØ´Ø©
            const shishaCat = cats.find(c => 
                c.id === 'shisha' || 
                (c.name && (c.name === 'Ø§Ù„Ø´ÙŠØ´Ø©' || c.name.includes('Ø´ÙŠØ´Ø©')))
            );
            const shishaCatId = shishaCat ? shishaCat.id : 'shisha';
            
            return item.category === shishaCatId || 
                   item.category === 'shisha' || 
                   item.isShisha === true ||
                   (item.name && item.name.includes('Ø´ÙŠØ´Ø©'));
        }
        
        function initFirebaseListeners() {
            // ØªØ­Ù…ÙŠÙ„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø´ÙŠØ´Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹
            firebase.database().ref(SHISHA_TYPES_PATH).on('value', (snapshot) => {
                globalShishaTypes = snapshot.val() || {};
                console.log('Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø´ÙŠØ´Ø© Ø§Ù„Ù…Ø­Ù…Ù„Ø©:', Object.keys(globalShishaTypes).length);
                // ØªØ­Ø¯ÙŠØ« Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø´ÙŠØ´Ø© Ø¨Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©
                if (Object.keys(globalShishaTypes).length > 0) {
                    menuItems.forEach(item => {
                        if (isShishaProduct(item, categories)) {
                            item.shishaTypes = globalShishaTypes;
                            item.isShisha = true;
                        }
                    });
                }
                renderProducts();
            });
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø£ÙˆÙ„Ø§Ù‹
            firebase.database().ref(CATEGORIES_PATH).on('value', (snapshot) => {
                const data = snapshot.val();
                categories = data ? Object.entries(data).map(([id, cat]) => ({ id, ...cat })) : [];
                categories.sort((a, b) => (a.order || 0) - (b.order || 0));
                
                // ØªØ­Ø¯ÙŠØ« Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø´ÙŠØ´Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
                if (Object.keys(globalShishaTypes).length > 0) {
                    menuItems.forEach(item => {
                        if (isShishaProduct(item, categories)) {
                            item.shishaTypes = globalShishaTypes;
                            item.isShisha = true;
                        }
                    });
                }
                renderProducts();
            });
            
            const menuRef = firebase.database().ref(MENU_PATH);
            
            menuRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    // Convert object to array
                    menuItems = Object.entries(data).map(([key, value]) => ({
                        id: key,
                        ...value
                    }));
                    
                    // ØªØ­Ø¯ÙŠØ« Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø´ÙŠØ´Ø© Ø¨Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©
                    if (Object.keys(globalShishaTypes).length > 0) {
                        menuItems.forEach(item => {
                            if (isShishaProduct(item, categories)) {
                                item.shishaTypes = globalShishaTypes;
                                item.isShisha = true;
                            }
                        });
                    }
                    
                    // Update BonApp state if it exists, or just use local variable
                    if (typeof BonApp !== 'undefined') {
                        BonApp.state.products = menuItems;
                    }
                    
                    renderProducts();
                } else {
                    menuItems = [];
                    renderProducts();
                }
            }, (error) => {
                console.error("Error fetching menu:", error);
            });
        }

        let selectedCategory = 'all';
        
        function renderProducts() {
            const container = document.getElementById('pos-products');
            
            if (!menuItems || menuItems.length === 0) {
                const isAdmin = localStorage.getItem('admin_logged_in') === 'true';
                const adminLink = isAdmin ? `
                    <a href="admin-menu.html" style="color: var(--primary); text-decoration: none; margin-top: 10px; display: inline-block;">
                        Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª <i class="fas fa-arrow-left"></i>
                    </a>
                ` : '';
                
                container.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-mug-hot" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</p>
                        ${adminLink}
                    </div>
                `;
                return;
            }

            // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            const categoriesHtml = `
                <div style="grid-column: 1/-1; display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--border);">
                    <button onclick="filterByCategory('all')" class="category-filter-btn ${selectedCategory === 'all' ? 'active' : ''}" style="
                        padding: 10px 20px;
                        border: 2px solid ${selectedCategory === 'all' ? 'var(--gold)' : 'var(--border)'};
                        background: ${selectedCategory === 'all' ? 'var(--gold)' : 'transparent'};
                        color: ${selectedCategory === 'all' ? '#000' : 'var(--text)'};
                        border-radius: 25px;
                        font-family: inherit;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">
                        ğŸ¯ Ø§Ù„ÙƒÙ„ (${menuItems.length})
                    </button>
                    ${categories.map(cat => {
                        const count = menuItems.filter(p => p.category === cat.id).length;
                        const isActive = selectedCategory === cat.id;
                        return `
                            <button onclick="filterByCategory('${cat.id}')" class="category-filter-btn ${isActive ? 'active' : ''}" style="
                                padding: 10px 20px;
                                border: 2px solid ${isActive ? 'var(--gold)' : 'var(--border)'};
                                background: ${isActive ? 'var(--gold)' : 'transparent'};
                                color: ${isActive ? '#000' : 'var(--text)'};
                                border-radius: 25px;
                                font-family: inherit;
                                font-weight: 600;
                                cursor: pointer;
                                transition: all 0.3s ease;
                            ">
                                ${cat.emoji || 'ğŸ“'} ${cat.name} (${count})
                            </button>
                        `;
                    }).join('')}
                </div>
            `;
            
            // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯
            let filteredItems = menuItems;
            if (selectedCategory !== 'all') {
                filteredItems = menuItems.filter(p => p.category === selectedCategory);
            }
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            const productsHtml = filteredItems.map(p => {
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± - Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ù†ØªØ¬ Ø´ÙŠØ´Ø©ØŒ Ø£Ø¸Ù‡Ø± "Ù…Ù† X"
                let priceDisplay = '';
                if (p.shishaTypes && Object.keys(p.shishaTypes).length > 0) {
                    const prices = Object.values(p.shishaTypes).map(t => parseFloat(t.price));
                    const minPrice = Math.min(...prices);
                    priceDisplay = `Ù…Ù† ${minPrice.toFixed(3)}`;
                } else if (p.sizes && Object.keys(p.sizes).length > 0) {
                    const prices = Object.values(p.sizes).map(s => parseFloat(s.price));
                    const minPrice = Math.min(...prices);
                    priceDisplay = `Ù…Ù† ${minPrice.toFixed(3)}`;
                } else {
                    priceDisplay = parseFloat(p.price || 0).toFixed(3);
                }
                
                return `
                    <div class="pos-product" onclick="addToCart('${p.id}');">
                        <div class="icon" style="${p.imageUrl ? 'padding: 0; overflow: hidden;' : ''}">
                            ${p.imageUrl 
                                ? `<img src="${p.imageUrl}" alt="${p.name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;">` 
                                : (p.emoji || 'â˜•')}
                        </div>
                        <div class="info">
                            <div class="name">${p.name}</div>
                            <div class="price">${priceDisplay} Ø±.Ø¹</div>
                        </div>
                        <i class="fas fa-plus" style="color: var(--text-secondary);"></i>
                    </div>
                `;
            }).join('');

            container.innerHTML = categoriesHtml + productsHtml;
        }
        
        function filterByCategory(categoryId) {
            selectedCategory = categoryId;
            renderProducts();
        }

        // Ù…ØªØºÙŠØ±Ø§Øª Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†ØªØ¬
        let currentProduct = null;
        let selectedOptionKey = null;
        let productModalQty = 1;
        
        // Override addToCart to handle string IDs from Firebase
        function addToCart(productId) {
            const product = menuItems.find(p => p.id === productId);
            if (!product) return;
            
            console.log('Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬:', product.name, 'Ø´ÙŠØ´Ø©:', product.isShisha, 'Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø´ÙŠØ´Ø©:', product.shishaTypes ? Object.keys(product.shishaTypes).length : 0);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£Ù†ÙˆØ§Ø¹ Ø´ÙŠØ´Ø© Ø£Ùˆ Ø£Ø­Ø¬Ø§Ù…
            const hasShishaTypes = product.shishaTypes && Object.keys(product.shishaTypes).length > 0;
            const hasSizes = product.sizes && Object.keys(product.sizes).length > 0;
            
            console.log('hasShishaTypes:', hasShishaTypes, 'hasSizes:', hasSizes);
            
            if (hasShishaTypes || hasSizes) {
                // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†ÙˆØ¹/Ø§Ù„Ø­Ø¬Ù…
                console.log('ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±...');
                openProductModal(product);
                return;
            }

            // Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¯ÙˆÙ† Ø®ÙŠØ§Ø±Ø§Øª
            addItemToCart(productId, product.name, product.price, product.emoji);
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ù„Ù„Ø³Ù„Ø©
        function addItemToCart(itemId, name, price, emoji) {
            const existingItem = BonApp.state.cart.find(i => i.id === itemId);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                BonApp.state.cart.push({ 
                    id: itemId, 
                    name: name, 
                    price: parseFloat(price), 
                    emoji: emoji || 'â˜•', 
                    quantity: 1 
                });
            }
            
            renderReceipt();
            BonApp.saveData();
        }
        
        // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†ÙˆØ¹/Ø§Ù„Ø­Ø¬Ù…
        function openProductModal(product) {
            currentProduct = product;
            selectedOptionKey = null;
            productModalQty = 1;
            
            const hasShishaTypes = product.shishaTypes && Object.keys(product.shishaTypes).length > 0;
            const hasSizes = product.sizes && Object.keys(product.sizes).length > 0;
            const options = hasShishaTypes ? product.shishaTypes : product.sizes;
            
            // ØªØ­Ø¯ÙŠØ¯ Ø£ÙˆÙ„ Ø®ÙŠØ§Ø±
            if (options) {
                selectedOptionKey = Object.keys(options)[0];
            }
            
            const title = hasShishaTypes ? 'ğŸ’¨ Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø´ÙŠØ´Ø©' : 'ğŸ“ Ø§Ø®ØªØ± Ø§Ù„Ø­Ø¬Ù…';
            document.getElementById('product-modal-title').innerHTML = `<i class="fas fa-plus-circle"></i> ${product.name}`;
            
            let optionsHtml = '';
            if (options) {
                optionsHtml = `<div style="margin-bottom: 12px; font-weight: 700; color: var(--gold); display: flex; align-items: center; gap: 8px; font-size: 0.95rem;">${title}</div>`;
                optionsHtml += '<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">';
                
                Object.entries(options).forEach(([key, opt], idx) => {
                    const isSelected = idx === 0;
                    const icon = hasShishaTypes ? (opt.icon || 'ğŸ’¨') : 'ğŸ“';
                    optionsHtml += `
                        <div class="product-option-item ${isSelected ? 'selected' : ''}" 
                             onclick="selectProductOption('${key}', this)" 
                             data-key="${key}" 
                             data-price="${opt.price}"
                             style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 12px 8px; background: ${isSelected ? 'rgba(99, 102, 241, 0.15)' : 'var(--bg-secondary)'}; border: 2px solid ${isSelected ? '#6366f1' : 'var(--border)'}; border-radius: 12px; cursor: pointer; transition: all 0.2s; position: relative; text-align: center; min-height: 90px;">
                            ${isSelected ? '<div style="position: absolute; top: -8px; right: 8px; background: #6366f1; color: white; font-size: 0.6rem; padding: 2px 6px; border-radius: 6px; font-weight: 700;">âœ“</div>' : ''}
                            <span style="font-size: 1.8rem; margin-bottom: 6px;">${icon}</span>
                            <div style="font-weight: 700; font-size: 0.85rem; margin-bottom: 4px;">${opt.name || key}</div>
                            <div style="background: linear-gradient(135deg, #6366f1, #4f46e5); color: white; padding: 4px 10px; border-radius: 12px; font-weight: 800; font-size: 0.8rem;">
                                ${parseFloat(opt.price).toFixed(3)}
                            </div>
                        </div>`;
                });
                optionsHtml += '</div>';
            }
            
            const initPrice = options && selectedOptionKey ? parseFloat(options[selectedOptionKey].price) : parseFloat(product.price || 0);
            
            document.getElementById('product-modal-body').innerHTML = `
                ${optionsHtml}
                
                <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 15px; padding: 12px; background: var(--bg-secondary); border-radius: 12px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <button onclick="changeProductQty(-1)" style="width: 38px; height: 38px; background: var(--card-bg); border: 1px solid var(--border); border-radius: 10px; color: white; font-size: 1.2rem; cursor: pointer;">âˆ’</button>
                        <span id="product-qty" style="font-size: 1.3rem; font-weight: 800; min-width: 30px; text-align: center;">1</span>
                        <button onclick="changeProductQty(1)" style="width: 38px; height: 38px; background: var(--card-bg); border: 1px solid var(--border); border-radius: 10px; color: white; font-size: 1.2rem; cursor: pointer;">+</button>
                    </div>
                    <div style="text-align: left;">
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                        <div id="product-total" style="font-size: 1.2rem; font-weight: 800; color: var(--gold);">${initPrice.toFixed(3)} Ø±.Ø¹</div>
                    </div>
                </div>
                
                <button onclick="confirmAddToCart()" style="width: 100%; padding: 14px; margin-top: 12px; background: linear-gradient(135deg, #10b981, #059669); border: none; border-radius: 12px; color: white; font-size: 1rem; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <i class="fas fa-cart-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©
                </button>
            `;
            
            document.getElementById('product-options-modal').classList.add('show');
        }
        
        // Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹/Ø­Ø¬Ù…
        function selectProductOption(key, el) {
            selectedOptionKey = key;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¨ØµØ±ÙŠ
            document.querySelectorAll('.product-option-item').forEach(item => {
                item.classList.remove('selected');
                item.style.borderColor = 'var(--border)';
                item.style.background = 'var(--bg-secondary)';
                // Ø¥Ø²Ø§Ù„Ø© Ø´Ø§Ø±Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯
                const badge = item.querySelector('div[style*="position: absolute"]');
                if (badge && badge.textContent.includes('Ù…Ø­Ø¯Ø¯')) {
                    badge.remove();
                }
            });
            
            el.classList.add('selected');
            el.style.borderColor = '#6366f1';
            el.style.background = 'rgba(99, 102, 241, 0.15)';
            
            // Ø¥Ø¶Ø§ÙØ© Ø´Ø§Ø±Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯
            if (!el.querySelector('div[style*="position: absolute"]')) {
                const badge = document.createElement('div');
                badge.style.cssText = 'position: absolute; top: -8px; right: 12px; background: #6366f1; color: white; font-size: 0.65rem; padding: 2px 8px; border-radius: 8px; font-weight: 700;';
                badge.textContent = 'âœ“ Ù…Ø­Ø¯Ø¯';
                el.appendChild(badge);
            }
            
            updateProductTotal();
        }
        
        // ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙ…ÙŠØ©
        function changeProductQty(delta) {
            productModalQty = Math.max(1, productModalQty + delta);
            document.getElementById('product-qty').textContent = productModalQty;
            updateProductTotal();
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
        function updateProductTotal() {
            if (!currentProduct) return;
            
            const options = currentProduct.shishaTypes || currentProduct.sizes;
            let price = 0;
            
            if (options && selectedOptionKey && options[selectedOptionKey]) {
                price = parseFloat(options[selectedOptionKey].price);
            } else {
                price = parseFloat(currentProduct.price || 0);
            }
            
            const total = price * productModalQty;
            document.getElementById('product-total').textContent = total.toFixed(3) + ' Ø±.Ø¹';
        }
        
        // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©
        function confirmAddToCart() {
            if (!currentProduct) return;
            
            const options = currentProduct.shishaTypes || currentProduct.sizes;
            let price, optName, itemId;
            
            if (options && selectedOptionKey && options[selectedOptionKey]) {
                price = parseFloat(options[selectedOptionKey].price);
                optName = options[selectedOptionKey].name || selectedOptionKey;
                itemId = `${currentProduct.id}_${selectedOptionKey}`;
            } else {
                price = parseFloat(currentProduct.price || 0);
                optName = '';
                itemId = currentProduct.id;
            }
            
            const displayName = optName ? `${currentProduct.name} (${optName})` : currentProduct.name;
            
            // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©
            const existingItem = BonApp.state.cart.find(i => i.id === itemId);
            if (existingItem) {
                existingItem.quantity += productModalQty;
            } else {
                BonApp.state.cart.push({
                    id: itemId,
                    productId: currentProduct.id,
                    name: displayName,
                    price: price,
                    emoji: currentProduct.emoji || 'â˜•',
                    quantity: productModalQty
                });
            }
            
            renderReceipt();
            BonApp.saveData();
            closeProductModal();
            
            BonApp.showToast(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${displayName} âœ“`, 'success');
        }
        
        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
        function closeProductModal() {
            document.getElementById('product-options-modal').classList.remove('show');
            currentProduct = null;
            selectedOptionKey = null;
            productModalQty = 1;
        }

        // Discount variables
        let currentDiscount = 0; // Percentage

        function renderReceipt() {
            const container = document.getElementById('receipt-items');
            const items = BonApp.state.cart;

            container.innerHTML = items.length ? items.map(i => `
                <div class="receipt-item">
                    <div class="icon">${i.emoji || 'â˜•'}</div>
                    <div class="meta">
                        <div class="n">${i.name}</div>
                        <div class="p">${PC.itemTotal(i.price, i.quantity)}</div>
                    </div>
                    <div class="qty">
                        <button onclick="updateCartQuantity('${i.id}', ${i.quantity - 1})">-</button>
                        <div style="min-width: 22px; text-align: center; font-weight: 800;">${i.quantity}</div>
                        <button onclick="updateCartQuantity('${i.id}', ${i.quantity + 1})">+</button>
                    </div>
                </div>
            `).join('') : `
                <div style="text-align:center; color: var(--text-secondary); padding: 30px;">
                    Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©. Ø§Ø®ØªØ± Ù…Ù†ØªØ¬Ø§Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.
                </div>
            `;

            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¯Ù‚ÙŠÙ‚
            const calc = PC.calculateOrder(items, currentDiscount);

            document.getElementById('receipt-subtotal').textContent = PC.format(calc.subtotal) + ' Ø±.Ø¹';
            document.getElementById('receipt-total').textContent = PC.format(calc.total) + ' Ø±.Ø¹';
            
            // Update discount display
            if (currentDiscount > 0) {
                document.getElementById('discount-display').style.display = 'block';
                document.getElementById('discount-percent').textContent = currentDiscount;
                document.getElementById('discount-amount').textContent = PC.format(calc.discountAmount);
            } else {
                document.getElementById('discount-display').style.display = 'none';
            }
            
            // Update BonApp UI if needed
            if (typeof BonApp.updateCartUI === 'function') {
                BonApp.updateCartUI();
            }
        }

        function toggleDiscount() {
            const options = document.getElementById('discount-options');
            options.style.display = options.style.display === 'none' ? 'block' : 'none';
        }

        function applyDiscount(percent) {
            currentDiscount = percent;
            renderReceipt();
            document.getElementById('discount-options').style.display = 'none';
        }

        function applyCustomDiscount() {
            const customValue = parseFloat(document.getElementById('custom-discount').value);
            if (customValue && customValue >= 0 && customValue <= 100) {
                currentDiscount = customValue;
                document.getElementById('custom-discount').value = '';
                renderReceipt();
                document.getElementById('discount-options').style.display = 'none';
            } else {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Ø³Ø¨Ø© ØµØ­ÙŠØ­Ø© Ø¨ÙŠÙ† 0 Ùˆ 100');
            }
        }

        function removeDiscount() {
            currentDiscount = 0;
            document.getElementById('custom-discount').value = '';
            document.getElementById('discount-options').style.display = 'none';
            renderReceipt();
        }

        function clearCart() {
            if (BonApp.state.cart.length === 0) {
                BonApp.showToast('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© Ø¨Ø§Ù„ÙØ¹Ù„', 'info');
                return;
            }
            
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©ØŸ')) return;
            
            BonApp.state.cart = [];
            currentDiscount = 0;
            document.getElementById('custom-discount').value = '';
            document.getElementById('discount-options').style.display = 'none';
            document.getElementById('discount-display').style.display = 'none';
            renderReceipt();
            BonApp.saveData();
            BonApp.showToast('ØªÙ… ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©', 'success');
        }

        function updateCartQuantity(productId, newQty) {
            if (newQty < 1) {
                BonApp.state.cart = BonApp.state.cart.filter(i => i.id !== productId);
            } else {
                const item = BonApp.state.cart.find(i => i.id === productId);
                if (item) item.quantity = newQty;
            }
            renderReceipt();
            BonApp.saveData();
        }

        function pay(method) {
            const items = BonApp.state.cart;
            if (items.length === 0) {
                BonApp.showToast('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©', 'error');
                return;
            }

            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¯Ù‚ÙŠÙ‚
            const calc = PC.calculateOrder(items, currentDiscount);
            const subtotal = calc.subtotal;
            const discountAmount = calc.discountAmount;
            const total = calc.total;

            // Get table number from input
            const tableNumber = document.getElementById('cashier-table-number')?.value.trim() || null;
            
            // Create order with discount info - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¯Ù‚ÙŠÙ‚
            const orderData = {
                items: items.map(item => ({
                    id: item.id,
                    name: item.name,
                    price: PC.round(parseFloat(item.price)),
                    quantity: item.quantity,
                    itemTotal: PC.multiply(item.price, item.quantity)
                })),
                subtotal: calc.subtotal,
                discount: {
                    percent: currentDiscount,
                    amount: calc.discountAmount
                },
                total: calc.total,
                paymentMethod: method,
                paymentStatus: 'paid',
                status: 'paid',
                createdAt: new Date().toISOString(),
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                workerId: localStorage.getItem('worker_id') || null,
                workerName: localStorage.getItem('worker_name') || null,
                tableNumber: tableNumber,
                tableId: tableNumber ? (tableNumber.match(/(\d+)/)?.[1] || tableNumber) : null,
                itemsCount: items.reduce((sum, item) => sum + item.quantity, 0),
                source: 'cashier',
                restaurantId: RESTAURANT_ID
            };

            // Save to Firebase
            const orderRef = firebase.database().ref(ORDERS_PATH).push();
            orderRef.set(orderData)
                .then(() => {
                    BonApp.showToast(method === 'cash' ? 'ØªÙ… Ø§Ù„Ø¯ÙØ¹ Ù†Ù‚Ø¯Ø§Ù‹ âœ…' : 'ØªÙ… Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© âœ…', 'success');
                    
                    // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                    printReceipt({
                        orderId: orderRef.key.slice(-6).toUpperCase(),
                        items: orderData.items,
                        total: orderData.total,
                        subtotal: orderData.subtotal,
                        discount: orderData.discount,
                        tableNumber: orderData.tableNumber || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                        paymentMethod: method === 'cash' ? 'Ù†Ù‚Ø¯Ø§Ù‹' : 'Ø¨Ø·Ø§Ù‚Ø©',
                        date: new Date().toLocaleString('en-US')
                    });
                    
                    BonApp.clearCart();
                    currentDiscount = 0;
                    // Clear table number input
                    const tableInput = document.getElementById('cashier-table-number');
                    if (tableInput) tableInput.value = '';
                    // Update table status - since order is paid, table should be available
                    if (orderData.tableNumber) {
                        updateTableStatus(orderData.tableId || orderData.tableNumber, 'available');
                    }
                    renderReceipt();
                })
                .catch(error => {
                    console.error('Error saving order:', error);
                    BonApp.showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨', 'error');
                });
        }
        
        // ===== Pay Later (Ø§Ù„Ø¯ÙØ¹ Ù„Ø§Ø­Ù‚Ø§Ù‹) =====
        function payLater() {
            const items = BonApp.state.cart;
            if (items.length === 0) {
                BonApp.showToast('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©', 'error');
                return;
            }

            // ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ù„Ù„Ø¯ÙØ¹ Ù„Ø§Ø­Ù‚Ø§Ù‹
            const tableNumber = document.getElementById('cashier-table-number')?.value.trim();
            if (!tableNumber) {
                BonApp.showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ù„Ù„Ø¯ÙØ¹ Ù„Ø§Ø­Ù‚Ø§Ù‹', 'error');
                document.getElementById('cashier-table-number')?.focus();
                return;
            }

            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¯Ù‚ÙŠÙ‚
            const calc = PC.calculateOrder(items, currentDiscount);

            const orderData = {
                items: items.map(item => ({
                    id: item.id,
                    name: item.name,
                    price: PC.round(parseFloat(item.price)),
                    quantity: item.quantity,
                    itemTotal: PC.multiply(item.price, item.quantity)
                })),
                subtotal: calc.subtotal,
                discount: {
                    percent: currentDiscount,
                    amount: calc.discountAmount
                },
                total: calc.total,
                paymentMethod: 'later',
                paymentStatus: 'pending',
                status: 'pending',
                createdAt: new Date().toISOString(),
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                workerId: localStorage.getItem('worker_id') || null,
                workerName: localStorage.getItem('worker_name') || null,
                tableNumber: tableNumber,
                tableId: tableNumber.match(/(\d+)/)?.[1] || tableNumber,
                itemsCount: items.reduce((sum, item) => sum + item.quantity, 0),
                source: 'cashier',
                restaurantId: RESTAURANT_ID
            };

            const orderRef = firebase.database().ref(ORDERS_PATH).push();
            orderRef.set(orderData)
                .then(() => {
                    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø¥Ù„Ù‰ Ù…Ø´ØºÙˆÙ„Ø©
                    updateTableStatus(orderData.tableId || tableNumber, 'occupied');
                    
                    BonApp.showToast(`âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ù„Ù‰ Ø·Ø§ÙˆÙ„Ø© ${tableNumber} - Ø§Ù„Ø¯ÙØ¹ Ù„Ø§Ø­Ù‚Ø§Ù‹`, 'success');
                    
                    BonApp.clearCart();
                    currentDiscount = 0;
                    document.getElementById('cashier-table-number').value = '';
                    renderReceipt();
                })
                .catch(error => {
                    console.error('Error saving order:', error);
                    BonApp.showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨', 'error');
                });
        }
        
        // ===== Print Receipt - Notepad Style =====
        function printReceipt(order) {
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US');
            const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            const paymentText = order.paymentMethod === 'Ù†Ù‚Ø¯Ø§Ù‹' ? 'Cash' : order.paymentMethod === 'Ø¨Ø·Ø§Ù‚Ø©' ? 'Card' : order.paymentMethod;
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨ØªÙ†Ø³ÙŠÙ‚ Ù†ØµÙŠ (Notepad Style)
            let receipt = '';
            receipt += '================================\n';
            receipt += '         SHAM COFFEE\n';
            receipt += '================================\n';
            receipt += '\n';
            receipt += `Table:    ${order.tableNumber || 'N/A'}\n`;
            receipt += `Date:     ${dateStr}\n`;
            receipt += `Time:     ${timeStr}\n`;
            receipt += `Order #:  ${order.orderId}\n`;
            receipt += '\n';
            receipt += '--------------------------------\n';
            receipt += 'Item                 Qty   Price\n';
            receipt += '--------------------------------\n';
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†Ø§ØµØ±
            order.items.forEach(item => {
                const name = (item.nameEn || item.name).substring(0, 18).padEnd(18);
                const qty = item.quantity.toString().padStart(3);
                const price = (item.price * item.quantity).toFixed(3).padStart(8);
                receipt += `${name} ${qty} ${price}\n`;
            });
            
            receipt += '--------------------------------\n';
            
            // Ø§Ù„Ø®ØµÙ… Ø¥Ø°Ø§ ÙˆØ¬Ø¯
            if (order.discount && order.discount.percent > 0) {
                const discountText = `Discount (${order.discount.percent}%)`.padEnd(22);
                const discountAmt = `-${order.discount.amount.toFixed(3)}`.padStart(8);
                receipt += `${discountText} ${discountAmt}\n`;
                receipt += '--------------------------------\n';
            }
            
            // Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
            receipt += '\n';
            receipt += `TOTAL:              ${order.total.toFixed(3)} OMR\n`;
            receipt += '\n';
            receipt += `Payment:            ${paymentText}\n`;
            receipt += '\n';
            receipt += '================================\n';
            receipt += '    Thank you for your visit!\n';
            receipt += '     We hope to see you again\n';
            receipt += '================================\n';
            receipt += '\n\n\n';
            
            // Ø·Ø¨Ø§Ø¹Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
            printTextReceipt(receipt);
        }
        
        // ===== Ø¯Ø§Ù„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†ØµÙŠØ© (Notepad Style) =====
        function printTextReceipt(text) {
            // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ø·Ø¨Ø§Ø¹Ø© Ø¨ØªÙ†Ø³ÙŠÙ‚ Ù†ØµÙŠ
            const printWindow = window.open('', '_blank', 'width=400,height=600');
            
            if (!printWindow) {
                BonApp.showToast('ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©', 'error');
                return;
            }
            
            const htmlContent = '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Receipt - SHAM COFFEE</title>' +
                '<style>' +
                '@page { size: 80mm auto; margin: 0; }' +
                '@media print { body { margin: 0; padding: 0; } .no-print { display: none !important; } }' +
                'body { font-family: Courier New, Courier, monospace; font-size: 12px; line-height: 1.4; padding: 10px; margin: 0; background: white; color: black; }' +
                'pre { margin: 0; white-space: pre-wrap; word-wrap: break-word; }' +
                '.print-btn { display: block; width: 100%; padding: 15px; margin-top: 20px; background: #4CAF50; color: white; border: none; font-size: 16px; cursor: pointer; border-radius: 5px; }' +
                '</style></head><body>' +
                '<pre>' + text + '</pre>' +
                '<button class="print-btn no-print" onclick="window.print();">Print Receipt</button>' +
                '</body></html>';
            
            printWindow.document.write(htmlContent);
            printWindow.document.close();
            
            // Ø·Ø¨Ø§Ø¹Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
            setTimeout(function() {
                try {
                    printWindow.focus();
                    printWindow.print();
                } catch(e) {
                    console.error('Print error:', e);
                }
            }, 300);
            
            BonApp.showToast('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©... ğŸ–¨ï¸', 'success');
        }

        // Barcode input for POS
        document.getElementById('pos-barcode').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const code = e.target.value.trim();
                if (code) BonApp.scanBarcode(code);
                e.target.value = '';
                renderReceipt();
            }
        });

        renderProducts();
        renderReceipt();
        initPendingOrdersListener();
        initOpenTablesListener();

        // ===== Ù†Ø¸Ø§Ù… Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© =====
        let pendingOrders = [];
        let notificationSound = null;
        
        function initPendingOrdersListener() {
            const ordersRef = firebase.database().ref(ORDERS_PATH);
            
            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØªØµÙÙŠØ© Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© ÙˆØ§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            ordersRef.on('value', (snapshot) => {
                const data = snapshot.val();
                const allOrders = data ? Object.entries(data).map(([id, order]) => ({ id, ...order })) : [];
                
                // ØªØµÙÙŠØ© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„Ù…Ø¹Ù„Ù‚Ø© ÙÙ‚Ø·
                const newPendingOrders = allOrders.filter(order => 
                    order.status === 'pending' || order.status === 'new'
                );
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
                if (newPendingOrders.length > pendingOrders.length && pendingOrders.length > 0) {
                    playNotificationSound();
                }
                
                pendingOrders = newPendingOrders;
                updatePendingBadge();
            });
        }
        
        function updatePendingBadge() {
            const badge = document.getElementById('new-orders-badge');
            const countEl = document.getElementById('pending-count');
            
            if (pendingOrders.length > 0) {
                badge.classList.add('show');
                countEl.textContent = pendingOrders.length;
                // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ø·Ù„Ø¨
                if (pendingOrders.length === 1) {
                    playNotificationSound();
                }
            } else {
                badge.classList.remove('show');
            }
        }
        
        function playNotificationSound() {
            // Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØª ØªÙ†Ø¨ÙŠÙ‡
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            gainNode.gain.value = 0.3;
            
            oscillator.start();
            setTimeout(() => {
                oscillator.frequency.value = 1000;
            }, 150);
            setTimeout(() => {
                oscillator.frequency.value = 1200;
            }, 300);
            setTimeout(() => {
                oscillator.stop();
            }, 450);
        }
        
        function openPendingOrders() {
            renderPendingOrders();
            document.getElementById('orders-modal').classList.add('show');
        }
        
        function closePendingOrders() {
            document.getElementById('orders-modal').classList.remove('show');
        }
        
        function renderPendingOrders() {
            const container = document.getElementById('pending-orders-list');
            
            if (pendingOrders.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-check-circle" style="font-size: 3rem; color: var(--success); margin-bottom: 15px;"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = pendingOrders.map(order => {
                const itemsHtml = order.items ? order.items.map(item => `
                    <div class="pending-order-item">
                        <span>${item.emoji || 'ğŸ“¦'} ${item.name} Ã— ${item.quantity}</span>
                        <span>${(item.price * item.quantity).toFixed(3)} Ø±.Ø¹</span>
                    </div>
                `).join('') : '';
                
                const orderTime = order.createdAt ? new Date(order.createdAt).toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' }) : '';
                const orderDate = order.createdAt ? new Date(order.createdAt).toLocaleDateString('ar-SA') : '';
                
                // Ù…ØµØ¯Ø± Ø§Ù„Ø·Ù„Ø¨
                let sourceIcon = 'ğŸ’°';
                let sourceText = 'Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„ÙƒØ§Ø´ÙŠØ±';
                let sourceColor = '#3b82f6';
                
                if (order.source === 'menu') {
                    sourceIcon = 'ğŸ“±';
                    sourceText = 'Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù…Ù†ÙŠÙˆ (QR)';
                    sourceColor = '#10b981';
                } else if (order.source === 'staff-menu' || order.source === 'worker-app') {
                    sourceIcon = 'ğŸ‘¨â€ğŸ’¼';
                    sourceText = order.workerName ? `Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù…ÙˆØ¸Ù: ${order.workerName}` : 'Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù…ÙˆØ¸Ù';
                    sourceColor = '#8b5cf6';
                }
                
                return `
                    <div class="pending-order-card" style="border-right: 4px solid ${sourceColor};">
                        <div class="pending-order-header">
                            <div>
                                <span class="pending-order-id">#${order.id.slice(-6).toUpperCase()}</span>
                                <small style="color: var(--text-secondary); margin-right: 10px;">${orderTime}</small>
                            </div>
                            <span class="pending-order-table">
                                <i class="fas fa-chair"></i> ${order.customerName || order.tableNumber || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                            </span>
                        </div>
                        
                        <!-- Ù…ØµØ¯Ø± Ø§Ù„Ø·Ù„Ø¨ -->
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px; padding: 10px; background: ${sourceColor}15; border-radius: 10px;">
                            <span style="font-size: 1.3rem;">${sourceIcon}</span>
                            <span style="color: ${sourceColor}; font-weight: 600;">${sourceText}</span>
                        </div>
                        
                        <!-- Ø§Ù„Ø£ØµÙ†Ø§Ù -->
                        <div style="margin-bottom: 10px; font-weight: 600; color: var(--gold);">
                            <i class="fas fa-list"></i> Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:
                        </div>
                        <div class="pending-order-items">
                            ${itemsHtml}
                        </div>
                        
                        <!-- Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ -->
                        <div class="pending-order-total">
                            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                            <span style="color: var(--gold); font-size: 1.3rem;">${(order.total || 0).toFixed(3)} Ø±.Ø¹</span>
                        </div>
                        
                        <!-- Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù -->
                        <div style="display: flex; justify-content: space-between; margin-top: 10px; padding-top: 10px; border-top: 1px dashed var(--border); color: var(--text-secondary); font-size: 0.9rem;">
                            <span><i class="fas fa-box"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù: ${order.itemsCount || order.items?.length || 0}</span>
                            <span><i class="fas fa-calendar"></i> ${orderDate}</span>
                        </div>
                        
                        <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
                        <div class="pending-order-actions">
                            <button class="btn-preparing" onclick="updateOrderStatus('${order.id}', 'preparing')">
                                <i class="fas fa-fire"></i> Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±
                            </button>
                            <button class="btn-complete" onclick="updateOrderStatus('${order.id}', 'ready')">
                                <i class="fas fa-check"></i> Ø¬Ø§Ù‡Ø²
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function updateOrderStatus(orderId, newStatus) {
            firebase.database().ref(`${ORDERS_PATH}/${orderId}`).update({
                status: newStatus,
                updatedAt: new Date().toISOString()
            }).then(() => {
                BonApp.showToast(newStatus === 'preparing' ? 'Ø§Ù„Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ± ğŸ”¥' : 'Ø§Ù„Ø·Ù„Ø¨ Ø¬Ø§Ù‡Ø² âœ…', 'success');
                renderPendingOrders();
            }).catch(err => {
                console.error('Error updating order:', err);
                BonApp.showToast('Ø­Ø¯Ø« Ø®Ø·Ø£', 'error');
            });
        }
        
        // ===== Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø© =====
        let openTables = {};
        
        function initOpenTablesListener() {
            const ordersRef = firebase.database().ref(ORDERS_PATH);
            
            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©
            ordersRef.on('value', (snapshot) => {
                const data = snapshot.val();
                openTables = {};
                
                if (data) {
                    Object.entries(data).forEach(([id, order]) => {
                        // ÙÙ‚Ø· Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©
                        if (order.status !== 'paid' && order.status !== 'cancelled' && order.status !== 'completed') {
                            // Ø§Ø³ØªØ®Ø¯Ø§Ù… tableId Ø£Ùˆ tableNumber
                            const tableId = order.tableId || order.tableNumber;
                            
                            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø¹Ø±Ù Ø§Ù„Ø·Ø§ÙˆÙ„Ø© ÙˆØ£Ù†Ù‡ Ù„ÙŠØ³ "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"
                            if (tableId && tableId !== 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' && tableId !== 'undefined' && tableId !== 'null') {
                                const tableKey = String(tableId);
                                
                                if (!openTables[tableKey]) {
                                    openTables[tableKey] = {
                                        tableNumber: tableKey,
                                        orders: [],
                                        total: 0,
                                        itemsCount: 0,
                                        workers: new Set()
                                    };
                                }
                                
                                openTables[tableKey].orders.push({ id, ...order });
                                openTables[tableKey].total += parseFloat(order.total || 0);
                                openTables[tableKey].itemsCount += parseInt(order.itemsCount || order.items?.length || 0);
                                
                                // Ø¥Ø¶Ø§ÙØ© Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ Ø¥Ø°Ø§ ÙˆØ¬Ø¯
                                if (order.workerName) {
                                    openTables[tableKey].workers.add(order.workerName);
                                }
                            }
                        }
                    });
                }
                
                renderOpenTables();
            });
        }
        
        function renderOpenTables() {
            const grid = document.getElementById('open-tables-grid');
            const countEl = document.getElementById('open-tables-count');
            const tableKeys = Object.keys(openTables);
            
            countEl.textContent = `${tableKeys.length} Ø·Ø§ÙˆÙ„Ø©`;
            
            if (tableKeys.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 30px; color: var(--text-secondary);">
                        <i class="fas fa-check-circle" style="font-size: 2rem; color: var(--success); margin-bottom: 10px;"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ø§ÙˆÙ„Ø§Øª Ù…ÙØªÙˆØ­Ø©</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = tableKeys.map(key => {
                const table = openTables[key];
                const workersArray = table.workers ? Array.from(table.workers) : [];
                const workersHtml = workersArray.length > 0 ? 
                    `<div style="font-size: 0.85rem; color: #A78BFA; margin: 5px 0;">
                        <i class="fas fa-user-tie"></i> ${workersArray.join('ØŒ ')}
                    </div>` : '';
                
                return `
                    <div class="table-card occupied">
                        <div class="table-card-header">
                            <span class="table-number"><i class="fas fa-chair"></i> Ø·Ø§ÙˆÙ„Ø© ${table.tableNumber}</span>
                            <span class="table-status occupied">Ù…Ø´ØºÙˆÙ„Ø©</span>
                        </div>
                        ${workersHtml}
                        <div class="table-orders-count">
                            <i class="fas fa-receipt"></i> ${table.orders.length} Ø·Ù„Ø¨ - ${table.itemsCount} ØµÙ†Ù
                        </div>
                        <div class="table-total">
                            <i class="fas fa-coins"></i> ${table.total.toFixed(3)} Ø±.Ø¹
                        </div>
                        <div class="table-card-actions">
                            <button class="btn-view-orders" onclick="viewTableOrders('${key}')">
                                <i class="fas fa-eye"></i> Ø¹Ø±Ø¶
                            </button>
                            <button class="btn-close-table" onclick="closeTableBill('${key}')">
                                <i class="fas fa-cash-register"></i> Ø¯ÙØ¹
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function viewTableOrders(tableKey) {
            const table = openTables[tableKey];
            if (!table) return;
            
            let ordersHtml = table.orders.map(order => {
                const itemsHtml = order.items ? order.items.map(item => 
                    `<div style="display: flex; justify-content: space-between; padding: 5px 0;">
                        <span>${item.emoji || 'ğŸ“¦'} ${item.name} Ã— ${item.quantity}</span>
                        <span>${(item.price * item.quantity).toFixed(3)}</span>
                    </div>`
                ).join('') : '';
                
                const statusText = order.status === 'pending' ? 'Ø¬Ø¯ÙŠØ¯' : order.status === 'preparing' ? 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±' : order.status === 'ready' ? 'Ø¬Ø§Ù‡Ø²' : order.status;
                const statusColor = order.status === 'pending' ? '#ef4444' : order.status === 'preparing' ? '#f59e0b' : '#10b981';
                
                // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ù„
                const workerInfo = order.workerName ? 
                    `<div style="font-size: 0.85rem; color: #A78BFA; margin-bottom: 10px; display: flex; align-items: center; gap: 5px;">
                        <i class="fas fa-user-tie"></i> Ø§Ù„Ø¹Ø§Ù…Ù„: <strong>${order.workerName}</strong>
                        ${order.source === 'worker-app' ? '<span style="background: #8B5CF6; color: white; padding: 2px 6px; border-radius: 8px; font-size: 0.7rem; margin-right: 5px;">ğŸ“± ØªØ·Ø¨ÙŠÙ‚</span>' : ''}
                    </div>` : '';
                
                return `
                    <div style="background: var(--bg-secondary); border-radius: 10px; padding: 15px; margin-bottom: 10px; ${order.source === 'worker-app' ? 'border-right: 3px solid #8B5CF6;' : ''}">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="font-weight: 700;">#${order.id.slice(-6).toUpperCase()}</span>
                            <span style="background: ${statusColor}; color: white; padding: 3px 10px; border-radius: 20px; font-size: 0.8rem;">${statusText}</span>
                        </div>
                        ${workerInfo}
                        ${itemsHtml}
                        <div style="display: flex; justify-content: space-between; margin-top: 10px; padding-top: 10px; border-top: 1px dashed var(--border); font-weight: 700;">
                            <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span>
                            <span>${(order.total || 0).toFixed(3)} Ø±.Ø¹</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            const modal = document.createElement('div');
            modal.className = 'orders-modal show';
            modal.id = 'table-orders-modal';
            modal.innerHTML = `
                <div class="orders-modal-content">
                    <div class="orders-modal-header" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        <h3><i class="fas fa-chair"></i> Ø·Ø§ÙˆÙ„Ø© ${table.tableNumber}</h3>
                        <button onclick="document.getElementById('table-orders-modal').remove()" style="background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;">&times;</button>
                    </div>
                    <div class="orders-modal-body">
                        ${ordersHtml}
                        <div style="background: var(--primary); color: white; padding: 15px; border-radius: 10px; text-align: center; margin-top: 15px;">
                            <div style="font-size: 0.9rem; margin-bottom: 5px;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</div>
                            <div style="font-size: 1.5rem; font-weight: 800;">${table.total.toFixed(3)} Ø±.Ø¹</div>
                        </div>
                        <button onclick="closeTableBill('${tableKey}'); document.getElementById('table-orders-modal').remove();" style="width: 100%; margin-top: 15px; padding: 15px; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 10px; font-family: inherit; font-size: 1.1rem; font-weight: 700; cursor: pointer;">
                            <i class="fas fa-cash-register"></i> Ø¯ÙØ¹ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function closeTableBill(tableKey) {
            const table = openTables[tableKey];
            if (!table) return;
            
            if (!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥ØºÙ„Ø§Ù‚ ÙØ§ØªÙˆØ±Ø© Ø·Ø§ÙˆÙ„Ø© ${table.tableNumber}ØŸ\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${table.total.toFixed(3)} Ø±.Ø¹`)) return;
            
            // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø¥Ù„Ù‰ "Ù…Ø¯ÙÙˆØ¹"
            const updates = {};
            table.orders.forEach(order => {
                updates[`${order.id}/status`] = 'paid';
                updates[`${order.id}/paidAt`] = new Date().toISOString();
            });
            
            firebase.database().ref(ORDERS_PATH).update(updates)
                .then(() => {
                    // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                    printTableReceipt(table);
                    BonApp.showToast(`ØªÙ… Ø¥ØºÙ„Ø§Ù‚ ÙØ§ØªÙˆØ±Ø© Ø·Ø§ÙˆÙ„Ø© ${table.tableNumber} âœ…`, 'success');
                })
                .catch(err => {
                    console.error('Error closing table:', err);
                    BonApp.showToast('Ø­Ø¯Ø« Ø®Ø·Ø£', 'error');
                });
        }
        
        function printTableReceipt(table) {
            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
            let allItems = [];
            table.orders.forEach(order => {
                if (order.items) {
                    order.items.forEach(item => {
                        const existing = allItems.find(i => i.name === item.name);
                        if (existing) {
                            existing.quantity += item.quantity;
                        } else {
                            allItems.push({ ...item });
                        }
                    });
                }
            });
            
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US');
            const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨ØªÙ†Ø³ÙŠÙ‚ Ù†ØµÙŠ (Notepad Style)
            let receipt = '';
            receipt += '================================\n';
            receipt += '         SHAM COFFEE\n';
            receipt += '================================\n';
            receipt += '\n';
            receipt += `Table:    ${table.tableNumber}\n`;
            receipt += `Date:     ${dateStr}\n`;
            receipt += `Time:     ${timeStr}\n`;
            receipt += `Orders:   ${table.orders.length}\n`;
            receipt += '\n';
            receipt += '--------------------------------\n';
            receipt += 'Item                 Qty   Price\n';
            receipt += '--------------------------------\n';
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†Ø§ØµØ±
            allItems.forEach(item => {
                const name = (item.nameEn || item.name).substring(0, 18).padEnd(18);
                const qty = item.quantity.toString().padStart(3);
                const price = (item.price * item.quantity).toFixed(3).padStart(8);
                receipt += `${name} ${qty} ${price}\n`;
            });
            
            receipt += '--------------------------------\n';
            receipt += '\n';
            receipt += `TOTAL:              ${table.total.toFixed(3)} OMR\n`;
            receipt += '\n';
            receipt += '================================\n';
            receipt += '    Thank you for your visit!\n';
            receipt += '     We hope to see you again\n';
            receipt += '================================\n';
            receipt += '\n\n\n';
            
            // Ø·Ø¨Ø§Ø¹Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
            printTextReceipt(receipt);
        }

        // ===== Ù†Ø¸Ø§Ù… Ø§Ù„ØºØ±Ù Ø§Ù„Ù…ÙØªÙˆØ­Ø© =====
        let openRooms = {};
        
        function initOpenRoomsListener() {
            const ordersRef = firebase.database().ref(ORDERS_PATH);
            
            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø© Ù„Ù„ØºØ±Ù
            ordersRef.on('value', (snapshot) => {
                const data = snapshot.val();
                openRooms = {};
                
                console.log('ğŸšª ÙØ­Øµ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„Ù„ØºØ±Ù...', data ? Object.keys(data).length : 0, 'Ø·Ù„Ø¨');
                
                if (data) {
                    Object.entries(data).forEach(([id, order]) => {
                        // ÙÙ‚Ø· Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø© ÙˆØ§Ù„Ù…Ù„ØºØ§Ø©
                        if (order.status !== 'paid' && order.status !== 'cancelled') {
                            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„ØºØ±ÙØ© Ø¨Ø¹Ø¯Ø© Ø·Ø±Ù‚
                            const isRoom = order.locationType === 'room' || 
                                           (order.roomNumber && order.roomNumber !== null) || 
                                           (order.roomId && order.roomId !== null) ||
                                           (order.customerName && typeof order.customerName === 'string' && order.customerName.includes('ØºØ±ÙØ©'));
                            
                            // ØªØ£ÙƒØ¯ Ø£Ù†Ù‡ Ù„ÙŠØ³ Ø·Ø§ÙˆÙ„Ø©
                            const isTable = order.locationType === 'table' || 
                                           (order.tableNumber && order.tableNumber !== null && order.tableNumber !== 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' && !order.tableNumber.includes('ØºØ±ÙØ©'));
                            
                            if (isRoom && !isTable) {
                                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©
                                let roomKey = order.roomId || order.locationNumber;
                                let roomDisplay = order.roomNumber || order.customerName || '';
                                
                                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ roomIdØŒ Ø§Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ø±Ù‚Ù… Ù…Ù† Ø§Ù„Ù†Øµ
                                if (!roomKey && order.customerName) {
                                    const match = order.customerName.match(/(\d+)/);
                                    if (match) roomKey = match[1];
                                }
                                if (!roomKey && order.roomNumber) {
                                    const match = order.roomNumber.match(/(\d+)/);
                                    if (match) roomKey = match[1];
                                }
                                
                                // Ø§Ø³ØªØ®Ø¯Ù… Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ø±Ù‚Ù…
                                if (!roomKey) roomKey = 'room_' + id.slice(-6);
                                if (!roomDisplay) roomDisplay = `ØºØ±ÙØ© ${roomKey}`;
                                
                                console.log('âœ… ØºØ±ÙØ© Ù…ÙƒØªØ´ÙØ©:', roomKey, roomDisplay, order);
                                
                                if (!openRooms[roomKey]) {
                                    openRooms[roomKey] = {
                                        roomNumber: roomKey,
                                        roomDisplay: roomDisplay,
                                        orders: [],
                                        total: 0,
                                        itemsCount: 0,
                                        workers: new Set(),
                                        startTime: null
                                    };
                                }
                                
                                openRooms[roomKey].orders.push({ id, ...order });
                                openRooms[roomKey].total += parseFloat(order.total || 0);
                                openRooms[roomKey].itemsCount += parseInt(order.itemsCount || order.items?.length || 0);
                                
                                // Ø¥Ø¶Ø§ÙØ© Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ Ø¥Ø°Ø§ ÙˆØ¬Ø¯
                                if (order.workerName) {
                                    openRooms[roomKey].workers.add(order.workerName);
                                }
                                
                                // ØªØ­Ø¯ÙŠØ¯ ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø¡ (Ø£Ù‚Ø¯Ù… Ø·Ù„Ø¨)
                                const orderTime = new Date(order.createdAt || order.timestamp || 0).getTime();
                                if (!openRooms[roomKey].startTime || orderTime < openRooms[roomKey].startTime) {
                                    openRooms[roomKey].startTime = orderTime;
                                }
                            }
                        }
                    });
                }
                
                console.log('ğŸšª Ø§Ù„ØºØ±Ù Ø§Ù„Ù…ÙØªÙˆØ­Ø©:', Object.keys(openRooms).length, openRooms);
                renderOpenRooms();
            });
        }
        
        function renderOpenRooms() {
            const grid = document.getElementById('open-rooms-grid');
            const countEl = document.getElementById('open-rooms-count');
            const roomKeys = Object.keys(openRooms);
            
            countEl.textContent = `${roomKeys.length} ØºØ±ÙØ©`;
            
            if (roomKeys.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 30px; color: var(--text-secondary);">
                        <i class="fas fa-check-circle" style="font-size: 2rem; color: var(--success); margin-bottom: 10px;"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØºØ±Ù Ù…ÙØªÙˆØ­Ø©</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = roomKeys.map(key => {
                const room = openRooms[key];
                const workersArray = room.workers ? Array.from(room.workers) : [];
                const workersHtml = workersArray.length > 0 ? 
                    `<div style="font-size: 0.85rem; color: #A78BFA; margin: 5px 0;">
                        <i class="fas fa-user-tie"></i> ${workersArray.join('ØŒ ')}
                    </div>` : '';
                
                // Ø­Ø³Ø§Ø¨ Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©
                let durationHtml = '';
                if (room.startTime) {
                    const duration = Math.floor((Date.now() - room.startTime) / 60000); // Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚
                    const hours = Math.floor(duration / 60);
                    const mins = duration % 60;
                    durationHtml = hours > 0 ? `${hours} Ø³Ø§Ø¹Ø© ${mins} Ø¯Ù‚ÙŠÙ‚Ø©` : `${mins} Ø¯Ù‚ÙŠÙ‚Ø©`;
                }
                
                return `
                    <div class="room-card occupied">
                        <div class="room-card-header">
                            <span class="room-number"><i class="fas fa-door-open"></i> ${room.roomDisplay}</span>
                            <span class="room-status">Ù…Ø´ØºÙˆÙ„Ø©</span>
                        </div>
                        ${workersHtml}
                        <div class="room-info">
                            <div><i class="fas fa-receipt"></i> ${room.orders.length} Ø·Ù„Ø¨ - ${room.itemsCount} ØµÙ†Ù</div>
                            ${durationHtml ? `<div><i class="fas fa-clock"></i> ${durationHtml}</div>` : ''}
                        </div>
                        <div class="room-total">
                            <i class="fas fa-coins"></i> ${room.total.toFixed(3)} Ø±.Ø¹
                        </div>
                        <div class="room-actions">
                            <button class="view-btn" onclick="viewRoomOrders('${key}')">
                                <i class="fas fa-eye"></i> Ø¹Ø±Ø¶
                            </button>
                            <button class="pay-btn" onclick="closeRoomBill('${key}')">
                                <i class="fas fa-cash-register"></i> Ø¯ÙØ¹
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function viewRoomOrders(roomKey) {
            const room = openRooms[roomKey];
            if (!room) return;
            
            let ordersHtml = room.orders.map(order => {
                const itemsHtml = order.items ? order.items.map(item => 
                    `<div style="display: flex; justify-content: space-between; padding: 5px 0;">
                        <span>${item.emoji || 'ğŸ“¦'} ${item.name} Ã— ${item.quantity}</span>
                        <span>${(item.price * item.quantity).toFixed(3)}</span>
                    </div>`
                ).join('') : '';
                
                const statusText = order.status === 'pending' ? 'Ø¬Ø¯ÙŠØ¯' : order.status === 'preparing' ? 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±' : order.status === 'ready' ? 'Ø¬Ø§Ù‡Ø²' : order.status;
                const orderDate = order.createdAt ? new Date(order.createdAt).toLocaleString('ar-EG') : '';
                
                return `
                    <div style="background: var(--bg-secondary); border-radius: 10px; padding: 15px; margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: var(--gold); font-weight: 700;">#${order.id.slice(-6)}</span>
                            <span style="background: ${order.status === 'pending' ? '#f59e0b' : order.status === 'ready' ? '#10b981' : '#8b5cf6'}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem;">${statusText}</span>
                        </div>
                        ${order.workerName ? `<div style="font-size: 0.85rem; color: #A78BFA; margin-bottom: 8px;"><i class="fas fa-user-tie"></i> ${order.workerName}</div>` : ''}
                        ${itemsHtml}
                        <div style="border-top: 1px dashed var(--border); margin-top: 10px; padding-top: 10px; display: flex; justify-content: space-between;">
                            <span style="font-size: 0.85rem; color: var(--text-secondary);">${orderDate}</span>
                            <span style="font-weight: 700; color: var(--gold);">${(order.total || 0).toFixed(3)} Ø±.Ø¹</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            const modal = document.createElement('div');
            modal.id = 'room-orders-modal';
            modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:10000;display:flex;align-items:center;justify-content:center;padding:20px;';
            modal.onclick = function(e) { if (e.target === modal) modal.remove(); };
            
            modal.innerHTML = `
                <div style="background:var(--card-bg);border-radius:20px;width:100%;max-width:500px;max-height:80vh;overflow:hidden;">
                    <div style="padding:20px;background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:white;display:flex;justify-content:space-between;align-items:center;">
                        <h3 style="font-size:1.2rem;"><i class="fas fa-door-open"></i> ${room.roomDisplay}</h3>
                        <button onclick="this.closest('#room-orders-modal').remove()" style="background:rgba(255,255,255,0.2);border:none;width:35px;height:35px;border-radius:50%;color:white;cursor:pointer;font-size:1.2rem;">Ã—</button>
                    </div>
                    <div style="padding:20px;max-height:50vh;overflow-y:auto;">
                        ${ordersHtml}
                    </div>
                    <div style="padding:20px;border-top:1px solid var(--border);background:var(--bg-secondary);">
                        <div style="display:flex;justify-content:space-between;font-size:1.3rem;font-weight:700;margin-bottom:15px;">
                            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ:</span>
                            <span style="color:var(--gold);">${room.total.toFixed(3)} Ø±.Ø¹</span>
                        </div>
                        <button onclick="closeRoomBill('${roomKey}'); document.getElementById('room-orders-modal').remove();" style="width: 100%; margin-top: 15px; padding: 15px; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 10px; font-family: inherit; font-size: 1.1rem; font-weight: 700; cursor: pointer;">
                            <i class="fas fa-cash-register"></i> Ø¯ÙØ¹ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function closeRoomBill(roomKey) {
            const room = openRooms[roomKey];
            if (!room) return;
            
            if (!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥ØºÙ„Ø§Ù‚ ÙØ§ØªÙˆØ±Ø© ${room.roomDisplay}ØŸ\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${room.total.toFixed(3)} Ø±.Ø¹`)) return;
            
            // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØºØ±ÙØ© Ø¥Ù„Ù‰ "Ù…Ø¯ÙÙˆØ¹"
            const updates = {};
            room.orders.forEach(order => {
                updates[`${order.id}/status`] = 'paid';
                updates[`${order.id}/paidAt`] = new Date().toISOString();
            });
            
            firebase.database().ref(ORDERS_PATH).update(updates)
                .then(() => {
                    // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                    printRoomReceipt(room);
                    BonApp.showToast(`ØªÙ… Ø¥ØºÙ„Ø§Ù‚ ÙØ§ØªÙˆØ±Ø© ${room.roomDisplay} âœ…`, 'success');
                })
                .catch(err => {
                    console.error('Error closing room:', err);
                    BonApp.showToast('Ø­Ø¯Ø« Ø®Ø·Ø£', 'error');
                });
        }
        
        function printRoomReceipt(room) {
            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
            let allItems = [];
            room.orders.forEach(order => {
                if (order.items) {
                    order.items.forEach(item => {
                        const existing = allItems.find(i => i.name === item.name);
                        if (existing) {
                            existing.quantity += item.quantity;
                        } else {
                            allItems.push({ ...item });
                        }
                    });
                }
            });
            
            // Ø­Ø³Ø§Ø¨ Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©
            let durationText = 'N/A';
            if (room.startTime) {
                const duration = Math.floor((Date.now() - room.startTime) / 60000);
                const hours = Math.floor(duration / 60);
                const mins = duration % 60;
                durationText = hours > 0 ? `${hours}h ${mins}m` : `${mins}m`;
            }
            
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US');
            const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨ØªÙ†Ø³ÙŠÙ‚ Ù†ØµÙŠ (Notepad Style)
            let receipt = '';
            receipt += '================================\n';
            receipt += '         SHAM COFFEE\n';
            receipt += '================================\n';
            receipt += '\n';
            receipt += `Room:     ${room.roomDisplay}\n`;
            receipt += `Date:     ${dateStr}\n`;
            receipt += `Time:     ${timeStr}\n`;
            receipt += `Duration: ${durationText}\n`;
            receipt += `Orders:   ${room.orders.length}\n`;
            receipt += '\n';
            receipt += '--------------------------------\n';
            receipt += 'Item                 Qty   Price\n';
            receipt += '--------------------------------\n';
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†Ø§ØµØ±
            allItems.forEach(item => {
                const name = (item.nameEn || item.name).substring(0, 18).padEnd(18);
                const qty = item.quantity.toString().padStart(3);
                const price = (item.price * item.quantity).toFixed(3).padStart(8);
                receipt += `${name} ${qty} ${price}\n`;
            });
            
            receipt += '--------------------------------\n';
            receipt += '\n';
            receipt += `TOTAL:              ${room.total.toFixed(3)} OMR\n`;
            receipt += '\n';
            receipt += '================================\n';
            receipt += '    Thank you for your visit!\n';
            receipt += '     We hope to see you again\n';
            receipt += '================================\n';
            receipt += '\n\n\n';
            
            // Ø·Ø¨Ø§Ø¹Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
            printTextReceipt(receipt);
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØºØ±Ù
        initOpenRoomsListener();

        // ===== Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠ =====
        let dailyClosingData = {
            orders: [],
            totalSales: 0,
            cashTotal: 0,
            cardTotal: 0,
            pendingCount: 0,
            pendingTotal: 0,
            totalDiscounts: 0
        };

        function openDailyClosing() {
            // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ…
            loadDailyData();
            document.getElementById('daily-closing-modal').classList.add('show');
        }

        function closeDailyClosing() {
            document.getElementById('daily-closing-modal').classList.remove('show');
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('actual-cash').value = '';
            document.getElementById('closing-notes').value = '';
            document.getElementById('cash-difference-section').style.display = 'none';
        }

        function loadDailyData() {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
            const now = new Date();
            document.getElementById('closing-date').textContent = now.toLocaleDateString('ar-EG', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('closing-time').textContent = now.toLocaleTimeString('ar-EG', {
                hour: '2-digit',
                minute: '2-digit'
            });

            // Ø¬Ù„Ø¨ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ù…Ù† Firebase
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const todayStart = today.getTime();

            const ordersRef = firebase.database().ref(ORDERS_PATH);
            ordersRef.once('value', (snapshot) => {
                const data = snapshot.val();
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                dailyClosingData = {
                    orders: [],
                    totalSales: 0,
                    cashTotal: 0,
                    cardTotal: 0,
                    pendingCount: 0,
                    pendingTotal: 0,
                    totalDiscounts: 0
                };

                if (data) {
                    Object.entries(data).forEach(([id, order]) => {
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„ÙŠÙˆÙ…
                        const orderTime = order.timestamp || new Date(order.createdAt).getTime();
                        if (orderTime >= todayStart) {
                            dailyClosingData.orders.push({ id, ...order });

                            const total = PC.round(parseFloat(order.total || 0));

                            if (order.status === 'paid' || order.status === 'completed') {
                                dailyClosingData.totalSales = PC.add(dailyClosingData.totalSales, total);

                                if (order.paymentMethod === 'cash') {
                                    dailyClosingData.cashTotal = PC.add(dailyClosingData.cashTotal, total);
                                } else if (order.paymentMethod === 'card') {
                                    dailyClosingData.cardTotal = PC.add(dailyClosingData.cardTotal, total);
                                }
                            } else if (order.status === 'pending' || order.paymentStatus === 'pending') {
                                dailyClosingData.pendingCount++;
                                dailyClosingData.pendingTotal = PC.add(dailyClosingData.pendingTotal, total);
                            }

                            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª
                            if (order.discount && order.discount.amount) {
                                dailyClosingData.totalDiscounts = PC.add(
                                    dailyClosingData.totalDiscounts, 
                                    PC.round(parseFloat(order.discount.amount))
                                );
                            }
                        }
                    });
                }

                // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                updateClosingUI();
            });
        }

        function updateClosingUI() {
            document.getElementById('closing-orders-count').textContent = dailyClosingData.orders.length;
            document.getElementById('closing-total-sales').textContent = PC.format(dailyClosingData.totalSales) + ' Ø±.Ø¹';
            document.getElementById('closing-cash-total').textContent = PC.format(dailyClosingData.cashTotal) + ' Ø±.Ø¹';
            document.getElementById('closing-card-total').textContent = PC.format(dailyClosingData.cardTotal) + ' Ø±.Ø¹';
            document.getElementById('closing-pending-count').textContent = dailyClosingData.pendingCount;
            document.getElementById('closing-pending-total').textContent = PC.format(dailyClosingData.pendingTotal) + ' Ø±.Ø¹';
            document.getElementById('closing-discounts').textContent = PC.format(dailyClosingData.totalDiscounts) + ' Ø±.Ø¹';
            document.getElementById('expected-cash').textContent = PC.format(dailyClosingData.cashTotal) + ' Ø±.Ø¹';
        }

        function calculateDifference() {
            const actualCash = parseFloat(document.getElementById('actual-cash').value) || 0;
            const expectedCash = dailyClosingData.cashTotal;
            const difference = PC.subtract(actualCash, expectedCash);

            document.getElementById('cash-difference-section').style.display = 'block';
            
            const diffElement = document.getElementById('cash-difference');
            diffElement.textContent = PC.format(difference) + ' Ø±.Ø¹';
            
            // ØªÙ„ÙˆÙŠÙ† Ø§Ù„ÙØ±Ù‚
            diffElement.classList.remove('positive', 'negative', 'zero');
            if (difference > 0.001) {
                diffElement.classList.add('positive');
                diffElement.textContent = '+' + PC.format(difference) + ' Ø±.Ø¹ (Ø²ÙŠØ§Ø¯Ø©)';
            } else if (difference < -0.001) {
                diffElement.classList.add('negative');
                diffElement.textContent = PC.format(difference) + ' Ø±.Ø¹ (Ù†Ù‚Øµ)';
            } else {
                diffElement.classList.add('zero');
                diffElement.textContent = 'âœ“ Ù…ØªØ·Ø§Ø¨Ù‚';
            }
        }

        function confirmDailyClosing() {
            const actualCash = parseFloat(document.getElementById('actual-cash').value) || 0;
            const notes = document.getElementById('closing-notes').value.trim();
            const workerName = localStorage.getItem('worker_name') || localStorage.getItem('admin_name') || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const workerId = localStorage.getItem('worker_id') || localStorage.getItem('admin_username') || '';

            // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ØºÙ„Ø§Ù‚ Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…ØŸ\n\nØ³ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙˆÙ„Ù† ØªØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„ÙŠÙ‡.')) {
                return;
            }

            // Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
            const closingRecord = {
                date: new Date().toISOString().split('T')[0],
                closedAt: new Date().toISOString(),
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                closedBy: {
                    name: workerName,
                    id: workerId
                },
                summary: {
                    ordersCount: dailyClosingData.orders.length,
                    totalSales: dailyClosingData.totalSales,
                    cashTotal: dailyClosingData.cashTotal,
                    cardTotal: dailyClosingData.cardTotal,
                    pendingCount: dailyClosingData.pendingCount,
                    pendingTotal: dailyClosingData.pendingTotal,
                    totalDiscounts: dailyClosingData.totalDiscounts
                },
                cashCount: {
                    expected: dailyClosingData.cashTotal,
                    actual: actualCash,
                    difference: PC.subtract(actualCash, dailyClosingData.cashTotal)
                },
                notes: notes || null
            };

            // Ø­ÙØ¸ ÙÙŠ Firebase
            const closingPath = `restaurant-system/restaurants/mirmaia-1/daily-closings`;
            firebase.database().ref(closingPath).push(closingRecord)
                .then(() => {
                    BonApp.showToast('ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ø¨Ù†Ø¬Ø§Ø­! âœ…', 'success');
                    closeDailyClosing();
                    
                    // Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø·Ø¨Ø§Ø¹Ø© ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ØŸ')) {
                        printDailyReport();
                    }
                })
                .catch(err => {
                    console.error('Error saving closing:', err);
                    BonApp.showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚', 'error');
                });
        }

        function printDailyReport() {
            const workerName = localStorage.getItem('worker_name') || localStorage.getItem('admin_name') || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const now = new Date();
            
            const reportHtml = `
                <div style="font-family: Arial, sans-serif; width: 300px; padding: 15px; text-align: center; font-size: 14px; direction: ltr;">
                    <div style="font-size: 20px; font-weight: bold; margin-bottom: 5px;">â˜• SHAM COFFEE</div>
                    <div style="font-size: 12px; margin-bottom: 15px;">DAILY CLOSING REPORT</div>
                    <div style="border-top: 2px dashed #000; margin: 10px 0;"></div>
                    
                    <div style="text-align: left; font-size: 12px;">
                        <div><strong>Date:</strong> ${now.toLocaleDateString('en-US')}</div>
                        <div><strong>Time:</strong> ${now.toLocaleTimeString('en-US')}</div>
                        <div><strong>Cashier:</strong> ${workerName}</div>
                    </div>
                    
                    <div style="border-top: 1px dashed #000; margin: 15px 0;"></div>
                    
                    <div style="font-size: 14px; font-weight: bold; margin-bottom: 10px;">SALES SUMMARY</div>
                    
                    <table style="width: 100%; font-size: 13px; text-align: left;">
                        <tr><td>Total Orders:</td><td style="text-align: right;">${dailyClosingData.orders.length}</td></tr>
                        <tr><td>Total Sales:</td><td style="text-align: right;">${PC.format(dailyClosingData.totalSales)} OMR</td></tr>
                        <tr><td>Cash Sales:</td><td style="text-align: right;">${PC.format(dailyClosingData.cashTotal)} OMR</td></tr>
                        <tr><td>Card Sales:</td><td style="text-align: right;">${PC.format(dailyClosingData.cardTotal)} OMR</td></tr>
                        <tr><td>Total Discounts:</td><td style="text-align: right;">-${PC.format(dailyClosingData.totalDiscounts)} OMR</td></tr>
                    </table>
                    
                    <div style="border-top: 1px dashed #000; margin: 15px 0;"></div>
                    
                    <div style="font-size: 14px; font-weight: bold; margin-bottom: 10px;">PENDING ORDERS</div>
                    <table style="width: 100%; font-size: 13px; text-align: left;">
                        <tr><td>Count:</td><td style="text-align: right;">${dailyClosingData.pendingCount}</td></tr>
                        <tr><td>Amount:</td><td style="text-align: right;">${PC.format(dailyClosingData.pendingTotal)} OMR</td></tr>
                    </table>
                    
                    <div style="border-top: 1px dashed #000; margin: 15px 0;"></div>
                    
                    <div style="font-size: 14px; font-weight: bold; margin-bottom: 10px;">CASH COUNT</div>
                    <table style="width: 100%; font-size: 13px; text-align: left;">
                        <tr><td>Expected:</td><td style="text-align: right;">${PC.format(dailyClosingData.cashTotal)} OMR</td></tr>
                        <tr><td>Actual:</td><td style="text-align: right;">${PC.format(parseFloat(document.getElementById('actual-cash').value) || 0)} OMR</td></tr>
                        <tr style="font-weight: bold;"><td>Difference:</td><td style="text-align: right;">${PC.format(PC.subtract(parseFloat(document.getElementById('actual-cash').value) || 0, dailyClosingData.cashTotal))} OMR</td></tr>
                    </table>
                    
                    <div style="border-top: 2px dashed #000; margin: 15px 0;"></div>
                    
                    <div style="font-size: 11px; color: #666;">
                        Sham Coffee - Daily Report<br>
                        ${now.toLocaleString('en-US')}
                    </div>
                </div>
            `;

            // Ø·Ø¨Ø§Ø¹Ø©
            if (window.electronAPI) {
                window.electronAPI.printReceipt(reportHtml);
                BonApp.showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© âœ…', 'success');
            } else {
                // Ø·Ø¨Ø§Ø¹Ø© Ø¹Ø¨Ø± Ø§Ù„Ù…ØªØµÙØ­
                let printFrame = document.getElementById('print-frame');
                if (!printFrame) {
                    printFrame = document.createElement('iframe');
                    printFrame.id = 'print-frame';
                    printFrame.style.cssText = 'position:fixed;right:0;bottom:0;width:0;height:0;border:0;';
                    document.body.appendChild(printFrame);
                }

                const frameDoc = printFrame.contentWindow || printFrame.contentDocument;
                const doc = frameDoc.document || frameDoc;
                
                doc.open();
                doc.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚</title></head><body>${reportHtml}</body></html>`);
                doc.close();

                setTimeout(() => {
                    try {
                        printFrame.contentWindow.focus();
                        printFrame.contentWindow.print();
                    } catch(e) {
                        console.error('Print error:', e);
                    }
                }, 300);
            }
        }

        // Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        function logout() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                localStorage.removeItem('admin_logged_in');
                localStorage.removeItem('admin_username');
                localStorage.removeItem('admin_name');
                localStorage.removeItem('admin_role');
                localStorage.removeItem('worker_logged_in');
                localStorage.removeItem('worker_username');
                localStorage.removeItem('worker_name');
                localStorage.removeItem('worker_role');
                localStorage.removeItem('worker_position');
                localStorage.removeItem('worker_id');
                localStorage.removeItem('restaurant_id');
                window.location.href = 'login-worker.html';
            }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Ù„Ù„Ø£Ø¯Ù…Ù† Ø£Ùˆ Ø§Ù„Ø¹Ø§Ù…Ù„
        const isAdmin = localStorage.getItem('admin_logged_in') === 'true';
        const isWorker = localStorage.getItem('worker_logged_in') === 'true';
        
        if (!isAdmin && !isWorker) {
            window.location.href = 'login-admin.html';
        }
    </script>
</body>
</html>
